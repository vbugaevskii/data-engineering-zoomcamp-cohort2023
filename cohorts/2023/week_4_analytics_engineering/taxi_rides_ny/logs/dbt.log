

============================== 2023-02-19 20:20:20.506373 | 2b93a9a1-1417-48c6-9c9c-0fce9b00dc3b ==============================
[0m20:20:20.506373 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:20:20.509561 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'project_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'parse_only': False, 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m20:20:20.509962 [debug] [MainThread]: Tracking: tracking
[0m20:20:20.545247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea97da2f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea97eab5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea97eab340>]}
[0m20:20:20.547973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea97da2f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea97eab5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fea97eab340>]}
[0m20:20:20.548412 [debug] [MainThread]: Flushing usage events
[0m20:20:21.209899 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.


============================== 2023-02-19 20:21:53.336250 | 28fdc877-f1e0-4bc9-b4d2-18d12cd1fde2 ==============================
[0m20:21:53.336250 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:21:53.337943 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'project_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'which': 'deps', 'rpc_method': 'deps', 'indirect_selection': 'eager'}
[0m20:21:53.338234 [debug] [MainThread]: Tracking: tracking
[0m20:21:53.367044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7e05aab20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7e055fc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7e055f0d0>]}
[0m20:21:53.371350 [debug] [MainThread]: Set downloads directory='/var/folders/kb/40bs5mxn3yz55kv3_1ppflwr0000gn/T/dbt-downloads-tdzwkyfp'
[0m20:21:53.372442 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m20:21:53.588812 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m20:21:53.589311 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m20:21:53.675752 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m20:21:53.722035 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m20:21:54.232503 [info ] [MainThread]:   Installed from version 0.8.0
[0m20:21:54.232888 [info ] [MainThread]:   Updated version available: 1.0.0
[0m20:21:54.233277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '28fdc877-f1e0-4bc9-b4d2-18d12cd1fde2', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7e055fd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7e055f0d0>]}
[0m20:21:54.233594 [info ] [MainThread]: 
[0m20:21:54.233940 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m20:21:54.235989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7e07125e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7e0541310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc7e055fd00>]}
[0m20:21:54.236406 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:22:10.605334 | a5a9ab37-0d3a-4bbb-900c-682965c157fb ==============================
[0m20:22:10.605334 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:22:10.608143 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'project_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'parse_only': False, 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m20:22:10.608470 [debug] [MainThread]: Tracking: tracking
[0m20:22:10.719651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f947868b070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f947868b640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f947868b3d0>]}
[0m20:22:10.751814 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:22:10.752231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a5a9ab37-0d3a-4bbb-900c-682965c157fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f947864c6a0>]}
[0m20:22:12.080594 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m20:22:12.111501 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m20:22:12.113257 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:22:12.121604 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:22:12.124740 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m20:22:12.128310 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m20:22:12.133406 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m20:22:12.341563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f94789ab250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f94788d2730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f94788d2a00>]}
[0m20:22:12.341970 [debug] [MainThread]: Flushing usage events
[0m20:22:12.935333 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.stg_yellow_tripdata' (models/staging/stg_yellow_tripdata.sql) depends on a source named 'staging.yellow_tripdata' which was not found


============================== 2023-02-19 20:24:10.325462 | 4e444061-9fa4-40b7-be75-e92467b57cdb ==============================
[0m20:24:10.325462 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:24:10.329368 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'project_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'parse_only': False, 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m20:24:10.329928 [debug] [MainThread]: Tracking: tracking
[0m20:24:10.357138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe04fe9fb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe04fe954c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe04fe95250>]}
[0m20:24:10.385417 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:24:10.385862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4e444061-9fa4-40b7-be75-e92467b57cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe04fe36880>]}
[0m20:24:11.640321 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m20:24:11.674616 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m20:24:11.676265 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:24:11.683204 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:24:11.685916 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m20:24:11.689187 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m20:24:11.692038 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m20:24:11.906230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe0500d1f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe05008c9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe05008c9d0>]}
[0m20:24:11.906702 [debug] [MainThread]: Flushing usage events
[0m20:24:12.502913 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 20:32:30.546803 | d39686e6-8e93-4416-b0a5-7b69f36af179 ==============================
[0m20:32:30.546803 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:32:30.550591 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'full_refresh': True, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m20:32:30.550918 [debug] [MainThread]: Tracking: tracking
[0m20:32:30.582243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92c058db20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92c061b580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92c061b310>]}
[0m20:32:30.615022 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:32:30.615477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd39686e6-8e93-4416-b0a5-7b69f36af179', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92c06769a0>]}
[0m20:32:32.061612 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m20:32:32.106106 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m20:32:32.108215 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:32:32.117098 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:32:32.119763 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m20:32:32.124047 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m20:32:32.127800 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m20:32:32.338826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92c07c1fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92c07cfe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92c07cf850>]}
[0m20:32:32.339199 [debug] [MainThread]: Flushing usage events
[0m20:32:33.198544 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 20:33:05.232880 | db6132c9-2a15-41df-b077-222518fb0f6a ==============================
[0m20:33:05.232880 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:33:05.235655 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m20:33:05.235996 [debug] [MainThread]: Tracking: tracking
[0m20:33:05.268981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6a465b100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6a465b670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6a465b400>]}
[0m20:33:05.295745 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:33:05.296143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'db6132c9-2a15-41df-b077-222518fb0f6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6a45c98e0>]}
[0m20:33:06.370709 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m20:33:06.399854 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m20:33:06.401486 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:33:06.407960 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:33:06.410172 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m20:33:06.413106 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m20:33:06.415592 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m20:33:06.593384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6a486a280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6a4784880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6a47847f0>]}
[0m20:33:06.593914 [debug] [MainThread]: Flushing usage events
[0m20:33:07.716975 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 20:34:13.929312 | c3069979-8db1-45a1-96b1-7c9424038599 ==============================
[0m20:34:13.929312 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:34:13.932705 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m20:34:13.933093 [debug] [MainThread]: Tracking: tracking
[0m20:34:14.029706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7a0d69fb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7a0d698490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7a0d698220>]}
[0m20:34:14.058583 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:34:14.058999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c3069979-8db1-45a1-96b1-7c9424038599', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7a0d637910>]}
[0m20:34:15.179419 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m20:34:15.209421 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m20:34:15.210945 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:34:15.217944 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:34:15.220398 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m20:34:15.223460 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m20:34:15.225959 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m20:34:15.393276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7a0d9a90a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7a0d8c4dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7a0d8d1310>]}
[0m20:34:15.393725 [debug] [MainThread]: Flushing usage events
[0m20:34:15.970954 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 20:34:42.464197 | ce004156-c3c5-4b25-8ad8-3bbf286e94fb ==============================
[0m20:34:42.464197 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:34:42.467430 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m20:34:42.467780 [debug] [MainThread]: Tracking: tracking
[0m20:34:42.503859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf63d45040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf63d45610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf63d453a0>]}
[0m20:34:42.531728 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:34:42.532129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ce004156-c3c5-4b25-8ad8-3bbf286e94fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf63cf4ac0>]}
[0m20:34:43.624652 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m20:34:43.658385 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m20:34:43.660072 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:34:43.666959 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:34:43.669148 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m20:34:43.672829 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m20:34:43.675650 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m20:34:43.866620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf64268220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf63f9dfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcf63f9d8e0>]}
[0m20:34:43.867027 [debug] [MainThread]: Flushing usage events
[0m20:34:45.077173 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 20:37:14.250661 | 1533cf8e-2aeb-4382-9672-b86e9cfa2ba4 ==============================
[0m20:37:14.250661 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:37:14.254082 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m20:37:14.254437 [debug] [MainThread]: Tracking: tracking
[0m20:37:14.288841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff454d8cf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff454e975b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff454e97340>]}
[0m20:37:14.317629 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:37:14.318067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1533cf8e-2aeb-4382-9672-b86e9cfa2ba4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff454df3910>]}
[0m20:37:15.414196 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m20:37:15.449884 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m20:37:15.451749 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:37:15.459103 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:37:15.626832 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:37:15.627553 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:37:15.628150 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:37:15.628700 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:37:15.666452 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:37:15.672525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1533cf8e-2aeb-4382-9672-b86e9cfa2ba4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff455148760>]}
[0m20:37:15.686198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1533cf8e-2aeb-4382-9672-b86e9cfa2ba4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff455128e50>]}
[0m20:37:15.686718 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:37:15.687116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1533cf8e-2aeb-4382-9672-b86e9cfa2ba4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff455183f40>]}
[0m20:37:15.688574 [info ] [MainThread]: 
[0m20:37:15.689114 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m20:37:15.689519 [debug] [MainThread]: Command end result
[0m20:37:15.712502 [info ] [MainThread]: 
[0m20:37:15.712880 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:37:15.716273 [info ] [MainThread]: 
[0m20:37:15.716633 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=0 SKIP=0 TOTAL=0
[0m20:37:15.716989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff454d7a820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff454df3670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff454df3fa0>]}
[0m20:37:15.717280 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:37:29.657142 | 12842f81-bdf3-42f3-8237-995f27409fb0 ==============================
[0m20:37:29.657142 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:37:29.659918 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'full_refresh': True, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m20:37:29.660284 [debug] [MainThread]: Tracking: tracking
[0m20:37:29.685799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89fbd8c910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89fbe99550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89fbe99340>]}
[0m20:37:29.826661 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 4 files added, 0 files changed.
[0m20:37:29.827195 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/dim_zones.sql
[0m20:37:29.827522 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/schema.yml
[0m20:37:29.827744 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/dm_monthly_zone_revenue.sql
[0m20:37:29.827937 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/fact_trips.sql
[0m20:37:29.844910 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m20:37:29.859917 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m20:37:29.863236 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m20:37:29.892842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89fc130640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89fc1300a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89fc130e50>]}
[0m20:37:29.893285 [debug] [MainThread]: Flushing usage events
[0m20:37:30.454177 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 20:38:45.940506 | d5e189cc-f749-4758-a52d-bb21520ed73d ==============================
[0m20:38:45.940506 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:38:45.944379 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'full_refresh': True, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m20:38:45.944836 [debug] [MainThread]: Tracking: tracking
[0m20:38:45.982810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33ce4e070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33ce4e640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33ce4e3d0>]}
[0m20:38:46.130024 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:38:46.130333 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:38:46.131101 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:38:46.140459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd5e189cc-f749-4758-a52d-bb21520ed73d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33d1869d0>]}
[0m20:38:46.153940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd5e189cc-f749-4758-a52d-bb21520ed73d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33d0913a0>]}
[0m20:38:46.154588 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:38:46.155192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5e189cc-f749-4758-a52d-bb21520ed73d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33d091160>]}
[0m20:38:46.156796 [info ] [MainThread]: 
[0m20:38:46.157327 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m20:38:46.157684 [debug] [MainThread]: Command end result
[0m20:38:46.166774 [info ] [MainThread]: 
[0m20:38:46.167250 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:38:46.167556 [info ] [MainThread]: 
[0m20:38:46.167837 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=0 SKIP=0 TOTAL=0
[0m20:38:46.168199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33ce0a910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33ce0ac10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa33d0911c0>]}
[0m20:38:46.168562 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:39:11.996762 | 2d8d8467-f4a9-48d1-9d02-afefe9fa027a ==============================
[0m20:39:11.996762 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:39:11.999913 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'parse_only': False, 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m20:39:12.000568 [debug] [MainThread]: Tracking: tracking
[0m20:39:12.034281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79ba6a2f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79ba7ad5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79ba7ad340>]}
[0m20:39:12.200393 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 4 files added, 0 files changed.
[0m20:39:12.202850 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/dm_monthly_zone_revenue.sql
[0m20:39:12.203283 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/fact_trips.sql
[0m20:39:12.221713 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/dim_zones.sql
[0m20:39:12.222148 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/schema.yml
[0m20:39:12.243726 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m20:39:12.259999 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m20:39:12.263099 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m20:39:12.289150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79ba9b0070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79baa46a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79baa46f10>]}
[0m20:39:12.289576 [debug] [MainThread]: Flushing usage events
[0m20:39:12.849418 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 20:45:46.542448 | 1e63cf43-a7a9-426e-b112-5f1d6824e5a7 ==============================
[0m20:45:46.542448 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:45:46.545965 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:45:46.546351 [debug] [MainThread]: Tracking: tracking
[0m20:45:46.577543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe11645ff40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe11654f5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe11654f370>]}
[0m20:45:46.731696 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 4 files added, 0 files changed.
[0m20:45:46.732206 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/dm_monthly_zone_revenue.sql
[0m20:45:46.732513 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/schema.yml
[0m20:45:46.732721 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/fact_trips.sql
[0m20:45:46.732912 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/dim_zones.sql
[0m20:45:46.750691 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m20:45:46.764992 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m20:45:46.767859 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m20:45:46.790743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe11686e070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe116903040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe116903ee0>]}
[0m20:45:46.791143 [debug] [MainThread]: Flushing usage events
[0m20:45:47.413760 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 20:48:02.492472 | 2100e759-f88e-45d6-809d-70811dc2d6a6 ==============================
[0m20:48:02.492472 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:48:02.497207 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:48:02.497584 [debug] [MainThread]: Tracking: tracking
[0m20:48:02.539152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffdda2910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffdeac580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffdeac2e0>]}
[0m20:48:02.698113 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:48:02.698471 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:48:02.699414 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:48:02.709856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2100e759-f88e-45d6-809d-70811dc2d6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffe2048e0>]}
[0m20:48:02.754241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2100e759-f88e-45d6-809d-70811dc2d6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffe10a2b0>]}
[0m20:48:02.754758 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:48:02.755267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2100e759-f88e-45d6-809d-70811dc2d6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffe10a070>]}
[0m20:48:02.757600 [info ] [MainThread]: 
[0m20:48:02.759340 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:48:02.760712 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m20:48:02.773897 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:48:03.357908 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m20:48:03.378709 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:48:03.385137 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m20:48:03.385725 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m20:48:03.395984 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m20:48:03.413727 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:48:03.416016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2100e759-f88e-45d6-809d-70811dc2d6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffe2315b0>]}
[0m20:48:03.417087 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:48:03.417525 [info ] [MainThread]: 
[0m20:48:03.425650 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m20:48:03.426303 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m20:48:03.427235 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m20:48:03.427515 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m20:48:03.427784 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m20:48:03.454452 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:48:03.456426 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 20:48:03.427970 => 2023-02-19 20:48:03.456160
[0m20:48:03.456919 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m20:48:03.484183 [debug] [Thread-1  ]: Creating new relation stg_green_tripdata
[0m20:48:03.493578 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:48:03.494581 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by vendorid, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where vendorid is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(vendorid as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(vendorid as integer) as vendorid,
    cast(ratecodeid as integer) as ratecodeid,
    cast(pulocationid as integer) as  pickup_locationid,
    cast(dolocationid as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m20:48:03.520905 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by vendorid, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where vendorid is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(vendorid as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(vendorid as integer) as vendorid,
    cast(ratecodeid as integer) as ratecodeid,
    cast(pulocationid as integer) as  pickup_locationid,
    cast(dolocationid as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m20:48:03.521544 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 20:48:03.457145 => 2023-02-19 20:48:03.521418
[0m20:48:03.539587 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 47. DB::Exception: Missing columns: 'vendorid' while processing query: 'SELECT VendorID, lpep_pickup_datetime, lpep_dropoff_datetime, store_and_fwd_flag, RatecodeID, PULocationID, DOLocationID, passenger_count, trip_distance, fare_amo
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:48:03.540120 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2100e759-f88e-45d6-809d-70811dc2d6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffeab8070>]}
[0m20:48:03.540777 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.11s]
[0m20:48:03.542280 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m20:48:03.543928 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:48:03.544535 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:48:03.544767 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m20:48:03.544977 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m20:48:03.547017 [info ] [MainThread]: 
[0m20:48:03.547380 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m20:48:03.547738 [debug] [MainThread]: Command end result
[0m20:48:03.558388 [info ] [MainThread]: 
[0m20:48:03.558844 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:48:03.559156 [info ] [MainThread]: 
[0m20:48:03.559443 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m20:48:03.559787 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m20:48:03.560193 [error] [MainThread]:    Code: 47. DB::Exception: Missing columns: 'vendorid' while processing query: 'SELECT VendorID, lpep_pickup_datetime, lpep_dropoff_datetime, store_and_fwd_flag, RatecodeID, PULocationID, DOLocationID, passenger_count, trip_distance, fare_amo
[0m20:48:03.560456 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:48:03.560717 [info ] [MainThread]: 
[0m20:48:03.560980 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:48:03.561298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffde495e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffe23c220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbffe23c3a0>]}
[0m20:48:03.561623 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:50:24.406440 | fc9f8d4f-a9f2-4539-9714-54735c3f88c0 ==============================
[0m20:50:24.406440 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:50:24.409546 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:50:24.409878 [debug] [MainThread]: Tracking: tracking
[0m20:50:24.439188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc88569b040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc88569b610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc88569b3a0>]}
[0m20:50:24.598903 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:50:24.599543 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m20:50:24.616067 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:50:24.647141 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:50:24.707846 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:50:24.708583 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:50:24.722464 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:50:24.733037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fc9f8d4f-a9f2-4539-9714-54735c3f88c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc885ab46a0>]}
[0m20:50:24.775389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fc9f8d4f-a9f2-4539-9714-54735c3f88c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc88565ef40>]}
[0m20:50:24.775886 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:50:24.776447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc9f8d4f-a9f2-4539-9714-54735c3f88c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc8859bcd60>]}
[0m20:50:24.778064 [info ] [MainThread]: 
[0m20:50:24.779818 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:50:24.781974 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m20:50:24.794288 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:50:25.443816 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m20:50:25.456776 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:50:25.460161 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m20:50:25.460573 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m20:50:25.466091 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m20:50:25.484196 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:50:25.485971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc9f8d4f-a9f2-4539-9714-54735c3f88c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc88565e220>]}
[0m20:50:25.486700 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:50:25.486976 [info ] [MainThread]: 
[0m20:50:25.494241 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m20:50:25.495049 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m20:50:25.495835 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m20:50:25.496120 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m20:50:25.496422 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m20:50:25.504633 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:50:25.506560 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 20:50:25.496740 => 2023-02-19 20:50:25.506458
[0m20:50:25.506927 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m20:50:25.531135 [debug] [Thread-1  ]: Creating new relation stg_green_tripdata
[0m20:50:25.541093 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:50:25.543220 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by vendorid, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where vendorid is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(vendorid as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorId` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m20:50:25.561841 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by vendorid, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where vendorid is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(vendorid as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorId` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m20:50:25.562219 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 20:50:25.507077 => 2023-02-19 20:50:25.562138
[0m20:50:25.578257 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 47. DB::Exception: Missing columns: 'vendorid' while processing query: 'SELECT VendorID, lpep_pickup_datetime, lpep_dropoff_datetime, store_and_fwd_flag, RatecodeID, PULocationID, DOLocationID, passenger_count, trip_distance, fare_amo
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:50:25.578690 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc9f8d4f-a9f2-4539-9714-54735c3f88c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc8831c8fd0>]}
[0m20:50:25.579102 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.08s]
[0m20:50:25.580334 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m20:50:25.581786 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:50:25.582375 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:50:25.582592 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m20:50:25.582804 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m20:50:25.584605 [info ] [MainThread]: 
[0m20:50:25.585060 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.81 seconds (0.81s).
[0m20:50:25.585425 [debug] [MainThread]: Command end result
[0m20:50:25.597253 [info ] [MainThread]: 
[0m20:50:25.598038 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:50:25.598788 [info ] [MainThread]: 
[0m20:50:25.599130 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m20:50:25.599544 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m20:50:25.599791 [error] [MainThread]:    Code: 47. DB::Exception: Missing columns: 'vendorid' while processing query: 'SELECT VendorID, lpep_pickup_datetime, lpep_dropoff_datetime, store_and_fwd_flag, RatecodeID, PULocationID, DOLocationID, passenger_count, trip_distance, fare_amo
[0m20:50:25.600156 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:50:25.601268 [info ] [MainThread]: 
[0m20:50:25.601774 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:50:25.602700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc88594f040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc88565ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc88569b580>]}
[0m20:50:25.603095 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:51:04.549365 | 6ffbbd41-f62b-4c3c-a9f0-11270e1f7e4e ==============================
[0m20:51:04.549365 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:51:04.552455 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:51:04.552832 [debug] [MainThread]: Tracking: tracking
[0m20:51:04.583199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff2147b5b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff2147ae490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff2147ae220>]}
[0m20:51:04.728853 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:51:04.729530 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m20:51:04.746745 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:51:04.775952 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:51:04.836382 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:51:04.836983 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:51:04.846471 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:51:04.853950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6ffbbd41-f62b-4c3c-a9f0-11270e1f7e4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff214a77550>]}
[0m20:51:04.867718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6ffbbd41-f62b-4c3c-a9f0-11270e1f7e4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff214911400>]}
[0m20:51:04.868195 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:51:04.868587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ffbbd41-f62b-4c3c-a9f0-11270e1f7e4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff21499f820>]}
[0m20:51:04.870698 [info ] [MainThread]: 
[0m20:51:04.872469 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:51:04.873825 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m20:51:04.887180 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:51:05.954769 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m20:51:05.970740 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:51:05.974633 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m20:51:05.975135 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m20:51:05.983377 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m20:51:05.998921 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:51:06.000557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ffbbd41-f62b-4c3c-a9f0-11270e1f7e4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff214911310>]}
[0m20:51:06.001314 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:51:06.001657 [info ] [MainThread]: 
[0m20:51:06.008514 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m20:51:06.009108 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m20:51:06.010359 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m20:51:06.010667 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m20:51:06.010963 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m20:51:06.017258 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:51:06.018100 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 20:51:06.011173 => 2023-02-19 20:51:06.017998
[0m20:51:06.018403 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m20:51:06.046963 [debug] [Thread-1  ]: Creating new relation stg_green_tripdata
[0m20:51:06.059857 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:51:06.061940 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorId`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorId` is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(VendorId as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorId` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m20:51:06.079799 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorId`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorId` is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(VendorId as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorId` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m20:51:06.080236 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 20:51:06.018575 => 2023-02-19 20:51:06.080129
[0m20:51:06.097400 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 47. DB::Exception: Missing columns: 'VendorId' while processing query: 'SELECT VendorID, lpep_pickup_datetime, lpep_dropoff_datetime, store_and_fwd_flag, RatecodeID, PULocationID, DOLocationID, passenger_count, trip_distance, fare_amo
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:51:06.097944 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ffbbd41-f62b-4c3c-a9f0-11270e1f7e4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff215340e20>]}
[0m20:51:06.098402 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.09s]
[0m20:51:06.099821 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m20:51:06.101452 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:51:06.102159 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:51:06.102425 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m20:51:06.102655 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m20:51:06.104969 [info ] [MainThread]: 
[0m20:51:06.105427 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.23 seconds (1.23s).
[0m20:51:06.106333 [debug] [MainThread]: Command end result
[0m20:51:06.165459 [info ] [MainThread]: 
[0m20:51:06.166109 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:51:06.166430 [info ] [MainThread]: 
[0m20:51:06.166686 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m20:51:06.166904 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m20:51:06.167107 [error] [MainThread]:    Code: 47. DB::Exception: Missing columns: 'VendorId' while processing query: 'SELECT VendorID, lpep_pickup_datetime, lpep_dropoff_datetime, store_and_fwd_flag, RatecodeID, PULocationID, DOLocationID, passenger_count, trip_distance, fare_amo
[0m20:51:06.167300 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:51:06.167501 [info ] [MainThread]: 
[0m20:51:06.167725 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:51:06.168030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff21497e7c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff214911250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff21475d4c0>]}
[0m20:51:06.168314 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:53:07.096534 | 7c12596d-e240-4e54-9c77-d970611d5f33 ==============================
[0m20:53:07.096534 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:53:07.100063 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:53:07.100395 [debug] [MainThread]: Tracking: tracking
[0m20:53:07.134299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4cf5c040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4cf5c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4cf5c3a0>]}
[0m20:53:07.288142 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:53:07.288757 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m20:53:07.305736 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:53:07.335296 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:53:07.392366 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:53:07.393039 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:53:07.402998 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:53:07.410273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7c12596d-e240-4e54-9c77-d970611d5f33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4d2366d0>]}
[0m20:53:07.423404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7c12596d-e240-4e54-9c77-d970611d5f33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4d0cf5b0>]}
[0m20:53:07.423905 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:53:07.424297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c12596d-e240-4e54-9c77-d970611d5f33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4d15e9a0>]}
[0m20:53:07.426254 [info ] [MainThread]: 
[0m20:53:07.428751 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:53:07.431930 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m20:53:07.442236 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:53:08.115001 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m20:53:08.127945 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:53:08.131068 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m20:53:08.131439 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m20:53:08.136922 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m20:53:08.152262 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:53:08.153964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c12596d-e240-4e54-9c77-d970611d5f33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4d0cf070>]}
[0m20:53:08.154635 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:53:08.154910 [info ] [MainThread]: 
[0m20:53:08.163673 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m20:53:08.164304 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m20:53:08.165043 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m20:53:08.165534 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m20:53:08.165819 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m20:53:08.171605 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:53:08.173273 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 20:53:08.165983 => 2023-02-19 20:53:08.173100
[0m20:53:08.173704 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m20:53:08.210820 [debug] [Thread-1  ]: Creating new relation stg_green_tripdata
[0m20:53:08.223806 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:53:08.242097 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(VendorId as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorId` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m20:53:08.268598 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(VendorId as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorId` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m20:53:08.269022 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 20:53:08.173982 => 2023-02-19 20:53:08.268934
[0m20:53:08.288238 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 47. DB::Exception: Missing columns: 'VendorId' while processing query: 'WITH tripdata AS (SELECT *, row_number() OVER (PARTITION BY VendorID, lpep_pickup_datetime) AS rn FROM default.green_taxi_data WHERE VendorID IS NOT NULL) SELECT
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:53:08.288649 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c12596d-e240-4e54-9c77-d970611d5f33', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4db99f70>]}
[0m20:53:08.289131 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.12s]
[0m20:53:08.290612 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m20:53:08.292255 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:53:08.292829 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:53:08.293024 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m20:53:08.293219 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m20:53:08.295058 [info ] [MainThread]: 
[0m20:53:08.295456 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m20:53:08.295984 [debug] [MainThread]: Command end result
[0m20:53:08.314606 [info ] [MainThread]: 
[0m20:53:08.315253 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:53:08.316726 [info ] [MainThread]: 
[0m20:53:08.317595 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m20:53:08.318109 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m20:53:08.318670 [error] [MainThread]:    Code: 47. DB::Exception: Missing columns: 'VendorId' while processing query: 'WITH tripdata AS (SELECT *, row_number() OVER (PARTITION BY VendorID, lpep_pickup_datetime) AS rn FROM default.green_taxi_data WHERE VendorID IS NOT NULL) SELECT
[0m20:53:08.319063 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:53:08.319512 [info ] [MainThread]: 
[0m20:53:08.319822 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:53:08.320456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4d165940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4db8cca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbf4db8cfa0>]}
[0m20:53:08.320825 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:53:23.815849 | b0f6213b-16a6-4248-aff8-492c2234b209 ==============================
[0m20:53:23.815849 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:53:23.818689 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:53:23.819006 [debug] [MainThread]: Tracking: tracking
[0m20:53:23.851002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a96b6b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a96ad4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a96ad250>]}
[0m20:53:23.996443 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:53:23.997123 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m20:53:24.013619 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:53:24.044176 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:53:24.102090 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:53:24.102641 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:53:24.112154 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:53:24.119923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b0f6213b-16a6-4248-aff8-492c2234b209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a9976580>]}
[0m20:53:24.167274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b0f6213b-16a6-4248-aff8-492c2234b209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a9811430>]}
[0m20:53:24.167734 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:53:24.168053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0f6213b-16a6-4248-aff8-492c2234b209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a989f850>]}
[0m20:53:24.169540 [info ] [MainThread]: 
[0m20:53:24.171162 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:53:24.174341 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m20:53:24.188590 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:53:24.938228 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m20:53:24.951802 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:53:24.954640 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m20:53:24.955020 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m20:53:24.960444 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m20:53:24.973453 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:53:24.975269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0f6213b-16a6-4248-aff8-492c2234b209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a98111c0>]}
[0m20:53:24.975906 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:53:24.976184 [info ] [MainThread]: 
[0m20:53:24.985129 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m20:53:24.985605 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m20:53:24.986494 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m20:53:24.986832 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m20:53:24.987086 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m20:53:24.992703 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:53:24.994272 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 20:53:24.987242 => 2023-02-19 20:53:24.994136
[0m20:53:24.994608 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m20:53:25.019370 [debug] [Thread-1  ]: Creating new relation stg_green_tripdata
[0m20:53:25.029031 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:53:25.030466 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(VendorID as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorID` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m20:53:25.050203 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(VendorID as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorID` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m20:53:25.050600 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 20:53:24.994762 => 2023-02-19 20:53:25.050519
[0m20:53:25.066925 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 46. DB::Exception: Unknown function md5. Maybe you meant: ['MD5','MD4']: While processing md5(CAST(concat(coalesce(CAST(VendorID, 'string'), ''), '-', coalesce(CAST(lpep_pickup_datetime, 'string'), '')), 'string')) AS tripid, CAST(Ven
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:53:25.067680 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0f6213b-16a6-4248-aff8-492c2234b209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9aa5207c0>]}
[0m20:53:25.068160 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.08s]
[0m20:53:25.069765 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m20:53:25.071489 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:53:25.072044 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:53:25.072291 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m20:53:25.072475 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m20:53:25.074568 [info ] [MainThread]: 
[0m20:53:25.074901 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.90 seconds (0.90s).
[0m20:53:25.075233 [debug] [MainThread]: Command end result
[0m20:53:25.086488 [info ] [MainThread]: 
[0m20:53:25.087058 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:53:25.087445 [info ] [MainThread]: 
[0m20:53:25.088017 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m20:53:25.088319 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m20:53:25.088567 [error] [MainThread]:    Code: 46. DB::Exception: Unknown function md5. Maybe you meant: ['MD5','MD4']: While processing md5(CAST(concat(coalesce(CAST(VendorID, 'string'), ''), '-', coalesce(CAST(lpep_pickup_datetime, 'string'), '')), 'string')) AS tripid, CAST(Ven
[0m20:53:25.088960 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:53:25.089399 [info ] [MainThread]: 
[0m20:53:25.089772 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:53:25.090139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a96b6b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a965c4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9a9811280>]}
[0m20:53:25.090467 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:58:33.466532 | 878dc470-e21b-4200-9211-a394fdd695ee ==============================
[0m20:58:33.466532 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:58:33.469937 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:58:33.470284 [debug] [MainThread]: Tracking: tracking
[0m20:58:33.498710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25b562f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25b6595e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25b659370>]}
[0m20:58:33.644828 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:58:33.645419 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m20:58:33.661135 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:58:33.696858 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:58:33.756460 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:58:33.757180 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:58:33.767980 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:58:33.775948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '878dc470-e21b-4200-9211-a394fdd695ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25ba756a0>]}
[0m20:58:33.820664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '878dc470-e21b-4200-9211-a394fdd695ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25b910580>]}
[0m20:58:33.821347 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:58:33.821885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '878dc470-e21b-4200-9211-a394fdd695ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25b99d970>]}
[0m20:58:33.823831 [info ] [MainThread]: 
[0m20:58:33.825526 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:58:33.827852 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m20:58:33.840928 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:58:34.832852 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m20:58:34.844894 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:58:34.847773 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m20:58:34.848191 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m20:58:34.853718 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m20:58:34.867616 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:58:34.869444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '878dc470-e21b-4200-9211-a394fdd695ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25b910310>]}
[0m20:58:34.870130 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:58:34.870410 [info ] [MainThread]: 
[0m20:58:34.877315 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m20:58:34.877957 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m20:58:34.878852 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m20:58:34.879202 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m20:58:34.879525 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m20:58:34.886067 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:58:34.888462 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 20:58:34.879699 => 2023-02-19 20:58:34.888307
[0m20:58:34.888793 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m20:58:34.915082 [debug] [Thread-1  ]: Creating new relation stg_green_tripdata
[0m20:58:34.925993 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:58:34.927660 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- md5(cast(coalesce(cast(VendorID as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorID` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m20:58:34.939624 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- md5(cast(coalesce(cast(VendorID as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorID` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m20:58:34.940071 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 20:58:34.889087 => 2023-02-19 20:58:34.939985
[0m20:58:34.953314 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
   Code: 62. DB::Exception: Syntax error: failed at position 481 (')') (line 20, col 6): ) || '-' || coalesce(cast(lpep_pickup_datetime as 
      string
  ), '') as 
      string
  )) as tripid,
      cast(`VendorID` as integer) as vendorid,
      cast(`R
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:58:34.953804 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '878dc470-e21b-4200-9211-a394fdd695ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25c39cf40>]}
[0m20:58:34.954504 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.08s]
[0m20:58:34.955936 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m20:58:34.957465 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:58:34.958181 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:58:34.958443 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m20:58:34.958660 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m20:58:34.960689 [info ] [MainThread]: 
[0m20:58:34.961112 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.14 seconds (1.14s).
[0m20:58:34.961573 [debug] [MainThread]: Command end result
[0m20:58:34.972753 [info ] [MainThread]: 
[0m20:58:34.973277 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:58:34.973601 [info ] [MainThread]: 
[0m20:58:34.973908 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m20:58:34.974202 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
[0m20:58:34.974508 [error] [MainThread]:    Code: 62. DB::Exception: Syntax error: failed at position 481 (')') (line 20, col 6): ) || '-' || coalesce(cast(lpep_pickup_datetime as 
[0m20:58:34.974828 [error] [MainThread]:       string
[0m20:58:34.975083 [error] [MainThread]:   ), '') as 
[0m20:58:34.975308 [error] [MainThread]:       string
[0m20:58:34.975509 [error] [MainThread]:   )) as tripid,
[0m20:58:34.975705 [error] [MainThread]:       cast(`VendorID` as integer) as vendorid,
[0m20:58:34.975908 [error] [MainThread]:       cast(`R
[0m20:58:34.976100 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:58:34.976311 [info ] [MainThread]: 
[0m20:58:34.976543 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:58:34.976880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25c358160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25bae0d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff25bae0b20>]}
[0m20:58:34.977209 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:59:16.804063 | 942e1ba9-892b-4dce-bf71-34ae78cd2063 ==============================
[0m20:59:16.804063 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:59:16.807177 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:59:16.807526 [debug] [MainThread]: Tracking: tracking
[0m20:59:16.840844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0dd62f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0de6d5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0de6d340>]}
[0m20:59:16.999218 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:59:16.999570 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:59:17.000517 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:59:17.009613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '942e1ba9-892b-4dce-bf71-34ae78cd2063', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0e1c7940>]}
[0m20:59:17.021383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '942e1ba9-892b-4dce-bf71-34ae78cd2063', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0df833d0>]}
[0m20:59:17.021977 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:59:17.022660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '942e1ba9-892b-4dce-bf71-34ae78cd2063', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0df83310>]}
[0m20:59:17.024394 [info ] [MainThread]: 
[0m20:59:17.026274 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:59:17.027646 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m20:59:17.040348 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:59:18.827687 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m20:59:18.848323 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:59:18.851145 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m20:59:18.851460 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m20:59:18.857493 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m20:59:18.880693 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:59:18.883291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '942e1ba9-892b-4dce-bf71-34ae78cd2063', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0e1f5790>]}
[0m20:59:18.884441 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:59:18.884970 [info ] [MainThread]: 
[0m20:59:18.894886 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m20:59:18.895482 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m20:59:18.896424 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m20:59:18.896780 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m20:59:18.897151 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m20:59:18.966178 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:59:18.967423 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 20:59:18.897471 => 2023-02-19 20:59:18.967295
[0m20:59:18.967819 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m20:59:18.999899 [debug] [Thread-1  ]: Creating new relation stg_green_tripdata
[0m20:59:19.008470 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:59:19.009741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- md5(cast(coalesce(cast(VendorID as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorID` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m20:59:19.022601 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- md5(cast(coalesce(cast(VendorID as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    cast(`VendorID` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m20:59:19.023210 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 20:59:18.968034 => 2023-02-19 20:59:19.023091
[0m20:59:19.045465 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
   Code: 62. DB::Exception: Syntax error: failed at position 481 (')') (line 20, col 6): ) || '-' || coalesce(cast(lpep_pickup_datetime as 
      string
  ), '') as 
      string
  )) as tripid,
      cast(`VendorID` as integer) as vendorid,
      cast(`R
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:59:19.046017 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '942e1ba9-892b-4dce-bf71-34ae78cd2063', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0ea06f40>]}
[0m20:59:19.046747 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.15s]
[0m20:59:19.048563 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m20:59:19.051124 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:59:19.051668 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:59:19.051946 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m20:59:19.052145 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m20:59:19.055100 [info ] [MainThread]: 
[0m20:59:19.055546 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.03 seconds (2.03s).
[0m20:59:19.055979 [debug] [MainThread]: Command end result
[0m20:59:19.067091 [info ] [MainThread]: 
[0m20:59:19.067579 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:59:19.067999 [info ] [MainThread]: 
[0m20:59:19.068377 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m20:59:19.068704 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
[0m20:59:19.069155 [error] [MainThread]:    Code: 62. DB::Exception: Syntax error: failed at position 481 (')') (line 20, col 6): ) || '-' || coalesce(cast(lpep_pickup_datetime as 
[0m20:59:19.069486 [error] [MainThread]:       string
[0m20:59:19.069769 [error] [MainThread]:   ), '') as 
[0m20:59:19.070082 [error] [MainThread]:       string
[0m20:59:19.070368 [error] [MainThread]:   )) as tripid,
[0m20:59:19.070734 [error] [MainThread]:       cast(`VendorID` as integer) as vendorid,
[0m20:59:19.070986 [error] [MainThread]:       cast(`R
[0m20:59:19.071227 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:59:19.071579 [info ] [MainThread]: 
[0m20:59:19.071953 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:59:19.072340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0e1a4f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0df830d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde0de081c0>]}
[0m20:59:19.072722 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 20:59:43.266654 | 4cb3affc-c71c-48fb-a7de-5d89336f2501 ==============================
[0m20:59:43.266654 [info ] [MainThread]: Running with dbt=1.4.1
[0m20:59:43.269395 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m20:59:43.269732 [debug] [MainThread]: Tracking: tracking
[0m20:59:43.306295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd2ea0b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd2e994c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd2e99250>]}
[0m20:59:43.473030 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:59:43.473676 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m20:59:43.493132 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m20:59:43.509739 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m20:59:43.564271 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:59:43.564876 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m20:59:43.574927 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m20:59:43.582072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4cb3affc-c71c-48fb-a7de-5d89336f2501', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd3161c40>]}
[0m20:59:43.595762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4cb3affc-c71c-48fb-a7de-5d89336f2501', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd2ffb430>]}
[0m20:59:43.596228 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m20:59:43.596580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cb3affc-c71c-48fb-a7de-5d89336f2501', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd308a850>]}
[0m20:59:43.598104 [info ] [MainThread]: 
[0m20:59:43.600235 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:59:43.601503 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m20:59:43.612998 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:59:44.354444 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m20:59:44.378328 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:59:44.381098 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m20:59:44.381506 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m20:59:44.387700 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m20:59:44.405518 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:59:44.407473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cb3affc-c71c-48fb-a7de-5d89336f2501', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd2ffb1c0>]}
[0m20:59:44.408177 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:59:44.408457 [info ] [MainThread]: 
[0m20:59:44.416956 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m20:59:44.417598 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m20:59:44.418394 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m20:59:44.418669 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m20:59:44.418941 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m20:59:44.423458 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:59:44.425521 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 20:59:44.419125 => 2023-02-19 20:59:44.425292
[0m20:59:44.425931 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m20:59:44.452855 [debug] [Thread-1  ]: Creating new relation stg_green_tripdata
[0m20:59:44.462624 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m20:59:44.464879 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    cast(`VendorID` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m20:59:44.487579 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    cast(`VendorID` as integer) as vendorid,
    cast(`RatecodeID` as integer) as ratecodeid,
    cast(`PULocationID` as integer) as  pickup_locationid,
    cast(`PULocationID` as integer) as dropoff_locationid,
    
    -- timestamps
    cast(lpep_pickup_datetime as timestamp) as pickup_datetime,
    cast(lpep_dropoff_datetime as timestamp) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    cast(passenger_count as integer) as passenger_count,
    cast(trip_distance as numeric) as trip_distance,
    cast(trip_type as integer) as trip_type,
    
    -- payment info
    cast(fare_amount as numeric) as fare_amount,
    cast(extra as numeric) as extra,
    cast(mta_tax as numeric) as mta_tax,
    cast(tip_amount as numeric) as tip_amount,
    cast(tolls_amount as numeric) as tolls_amount,
    cast(ehail_fee as numeric) as ehail_fee,
    cast(improvement_surcharge as numeric) as improvement_surcharge,
    cast(total_amount as numeric) as total_amount,
    cast(payment_type as integer) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    cast(congestion_surcharge as numeric) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m20:59:44.488107 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 20:59:44.426134 => 2023-02-19 20:59:44.487922
[0m20:59:44.545425 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 42. DB::Exception: Decimal data type family must have exactly two arguments: precision and scale: While processing CAST(VendorID, 'integer') AS vendorid, CAST(RatecodeID, 'integer') AS ratecodeid, CAST(PULocationID, 'integer') AS pick
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:59:44.545886 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cb3affc-c71c-48fb-a7de-5d89336f2501', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd39beb80>]}
[0m20:59:44.546340 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.13s]
[0m20:59:44.547678 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m20:59:44.549301 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:59:44.549961 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:59:44.550231 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m20:59:44.550459 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m20:59:44.552378 [info ] [MainThread]: 
[0m20:59:44.552776 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.95 seconds (0.95s).
[0m20:59:44.553183 [debug] [MainThread]: Command end result
[0m20:59:44.563984 [info ] [MainThread]: 
[0m20:59:44.564398 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:59:44.565169 [info ] [MainThread]: 
[0m20:59:44.565525 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m20:59:44.565906 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m20:59:44.566281 [error] [MainThread]:    Code: 42. DB::Exception: Decimal data type family must have exactly two arguments: precision and scale: While processing CAST(VendorID, 'integer') AS vendorid, CAST(RatecodeID, 'integer') AS ratecodeid, CAST(PULocationID, 'integer') AS pick
[0m20:59:44.566626 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m20:59:44.567225 [info ] [MainThread]: 
[0m20:59:44.567662 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m20:59:44.568158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd30697f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd2ffb280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fadd308a850>]}
[0m20:59:44.568504 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:03:39.225695 | 15dc5cdc-52ea-4ff3-9b8e-9c28fa800536 ==============================
[0m21:03:39.225695 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:03:39.229307 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:03:39.229705 [debug] [MainThread]: Tracking: tracking
[0m21:03:39.329822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87ac5f910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87ad6c550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87ad6c2e0>]}
[0m21:03:39.481156 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:03:39.481805 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:03:39.499226 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:03:39.515764 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:03:39.571845 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:03:39.572447 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:03:39.581856 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:03:39.588848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '15dc5cdc-52ea-4ff3-9b8e-9c28fa800536', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87b034cd0>]}
[0m21:03:39.602314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '15dc5cdc-52ea-4ff3-9b8e-9c28fa800536', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87aecc4f0>]}
[0m21:03:39.602757 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:03:39.603041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15dc5cdc-52ea-4ff3-9b8e-9c28fa800536', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87af5c8e0>]}
[0m21:03:39.604571 [info ] [MainThread]: 
[0m21:03:39.606294 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:03:39.607384 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:03:39.619158 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:03:40.360687 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:03:40.373796 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:03:40.376870 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:03:40.377309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:03:40.382757 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:03:40.396313 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:03:40.398097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15dc5cdc-52ea-4ff3-9b8e-9c28fa800536', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87aecc280>]}
[0m21:03:40.398939 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:03:40.399288 [info ] [MainThread]: 
[0m21:03:40.406416 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:03:40.407297 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:03:40.408338 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:03:40.408698 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:03:40.408997 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:03:40.413861 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:03:40.416080 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:03:40.409233 => 2023-02-19 21:03:40.415974
[0m21:03:40.416457 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:03:40.448400 [debug] [Thread-1  ]: Creating new relation stg_green_tripdata
[0m21:03:40.470189 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:03:40.487039 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:03:40.506033 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:03:40.521948 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:03:40.416614 => 2023-02-19 21:03:40.521895
[0m21:03:40.522765 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15dc5cdc-52ea-4ff3-9b8e-9c28fa800536', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87bb54520>]}
[0m21:03:40.523183 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.11s]
[0m21:03:40.524590 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:03:40.526283 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:03:40.526794 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:03:40.526975 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:03:40.527148 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:03:40.528951 [info ] [MainThread]: 
[0m21:03:40.529272 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.92 seconds (0.92s).
[0m21:03:40.529614 [debug] [MainThread]: Command end result
[0m21:03:40.538843 [info ] [MainThread]: 
[0m21:03:40.539303 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:03:40.539796 [info ] [MainThread]: 
[0m21:03:40.540098 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:03:40.540423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87aecc1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87bb8d6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe87af398e0>]}
[0m21:03:40.540687 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:05:51.656534 | f61ffa64-10d3-44ba-92a7-df8b58e99cf9 ==============================
[0m21:05:51.656534 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:05:51.659978 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_yellow_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:05:51.660420 [debug] [MainThread]: Tracking: tracking
[0m21:05:51.698231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd0fd62f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd0ff605e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd0ff60370>]}
[0m21:05:51.856740 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:05:51.857629 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_yellow_tripdata.sql
[0m21:05:51.876790 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m21:05:51.894111 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m21:05:51.953104 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:05:51.953775 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:05:51.963381 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:05:51.971183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f61ffa64-10d3-44ba-92a7-df8b58e99cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd10237f10>]}
[0m21:05:51.984708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f61ffa64-10d3-44ba-92a7-df8b58e99cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd0ff60850>]}
[0m21:05:51.985582 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:05:51.986086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f61ffa64-10d3-44ba-92a7-df8b58e99cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd1015e970>]}
[0m21:05:51.987689 [info ] [MainThread]: 
[0m21:05:51.989324 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:05:51.990410 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:05:52.003132 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:05:52.794602 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:05:52.807053 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:05:52.809832 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:05:52.810234 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:05:52.815782 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:05:52.829575 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:05:52.832513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f61ffa64-10d3-44ba-92a7-df8b58e99cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd10259c10>]}
[0m21:05:52.833290 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:05:52.833594 [info ] [MainThread]: 
[0m21:05:52.841981 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:05:52.842450 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m21:05:52.843059 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m21:05:52.843299 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_yellow_tripdata)
[0m21:05:52.843534 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:05:52.847645 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:05:52.848553 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 21:05:52.843677 => 2023-02-19 21:05:52.848372
[0m21:05:52.848920 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:05:52.877347 [debug] [Thread-1  ]: Creating new relation stg_yellow_tripdata
[0m21:05:52.887998 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:05:52.888685 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata 
  
  as (
    
 
with tripdata as 
(
  select *,
    row_number() over(partition by vendorid, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where vendorid is not null 
)
select
   -- identifiers
    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(tpep_pickup_datetime) as pickup_datetime,
    toDateTime(tpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:05:52.902893 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata 
  
  as (
    
 
with tripdata as 
(
  select *,
    row_number() over(partition by vendorid, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where vendorid is not null 
)
select
   -- identifiers
    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(tpep_pickup_datetime) as pickup_datetime,
    toDateTime(tpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m21:05:52.903300 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 21:05:52.849099 => 2023-02-19 21:05:52.903209
[0m21:05:52.920949 [debug] [Thread-1  ]: Database Error in model stg_yellow_tripdata (models/staging/stg_yellow_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 47. DB::Exception: Missing columns: 'vendorid' while processing query: 'SELECT VendorID, tpep_pickup_datetime, tpep_dropoff_datetime, passenger_count, trip_distance, RatecodeID, store_and_fwd_flag, PULocationID, DOLocationID, payment_
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_yellow_tripdata.sql
[0m21:05:52.921390 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f61ffa64-10d3-44ba-92a7-df8b58e99cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd10c12ee0>]}
[0m21:05:52.922053 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_yellow_tripdata ............... [[31mERROR[0m in 0.08s]
[0m21:05:52.923839 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:05:52.925889 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:05:52.926515 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:05:52.926777 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m21:05:52.927307 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m21:05:52.929685 [info ] [MainThread]: 
[0m21:05:52.930078 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.94 seconds (0.94s).
[0m21:05:52.930465 [debug] [MainThread]: Command end result
[0m21:05:52.941759 [info ] [MainThread]: 
[0m21:05:52.942306 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:05:52.942616 [info ] [MainThread]: 
[0m21:05:52.942909 [error] [MainThread]: [33mDatabase Error in model stg_yellow_tripdata (models/staging/stg_yellow_tripdata.sql)[0m
[0m21:05:52.943158 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m21:05:52.943386 [error] [MainThread]:    Code: 47. DB::Exception: Missing columns: 'vendorid' while processing query: 'SELECT VendorID, tpep_pickup_datetime, tpep_dropoff_datetime, passenger_count, trip_distance, RatecodeID, store_and_fwd_flag, PULocationID, DOLocationID, payment_
[0m21:05:52.943603 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_yellow_tripdata.sql
[0m21:05:52.943861 [info ] [MainThread]: 
[0m21:05:52.944299 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:05:52.944760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd1013d8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd0ff60c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd1026d820>]}
[0m21:05:52.945236 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:06:13.499776 | 5b41b27d-6340-44aa-b901-665499678d64 ==============================
[0m21:06:13.499776 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:06:13.504234 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_yellow_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:06:13.505840 [debug] [MainThread]: Tracking: tracking
[0m21:06:13.540377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1a685100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1a685670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1a685400>]}
[0m21:06:13.788949 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:06:13.789666 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_yellow_tripdata.sql
[0m21:06:13.816945 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m21:06:13.838783 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m21:06:13.914357 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:06:13.915022 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:06:13.926821 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:06:13.933208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5b41b27d-6340-44aa-b901-665499678d64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1a965430>]}
[0m21:06:13.947252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5b41b27d-6340-44aa-b901-665499678d64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1a7ff610>]}
[0m21:06:13.947700 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:06:13.948005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b41b27d-6340-44aa-b901-665499678d64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1a88da00>]}
[0m21:06:13.949458 [info ] [MainThread]: 
[0m21:06:13.951153 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:06:13.952666 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:06:13.965052 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:06:15.127969 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:06:15.140854 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:06:15.147600 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:06:15.148139 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:06:15.158076 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:06:15.173511 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:06:15.178250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b41b27d-6340-44aa-b901-665499678d64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1a7ff0d0>]}
[0m21:06:15.179099 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:06:15.179489 [info ] [MainThread]: 
[0m21:06:15.194465 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:06:15.195158 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m21:06:15.198273 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m21:06:15.198738 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_yellow_tripdata)
[0m21:06:15.199131 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:06:15.206231 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:06:15.209292 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 21:06:15.199369 => 2023-02-19 21:06:15.209061
[0m21:06:15.209800 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:06:15.243125 [debug] [Thread-1  ]: Creating new relation stg_yellow_tripdata
[0m21:06:15.253259 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:06:15.254237 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata 
  
  as (
    
 
with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(tpep_pickup_datetime) as pickup_datetime,
    toDateTime(tpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:06:15.271684 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata 
  
  as (
    
 
with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(tpep_pickup_datetime) as pickup_datetime,
    toDateTime(tpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m21:06:15.272106 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 21:06:15.210312 => 2023-02-19 21:06:15.272010
[0m21:06:15.287502 [debug] [Thread-1  ]: Database Error in model stg_yellow_tripdata (models/staging/stg_yellow_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 47. DB::Exception: Missing columns: 'ehail_fee' while processing query: 'WITH tripdata AS (SELECT *, row_number() OVER (PARTITION BY VendorID, tpep_pickup_datetime) AS rn FROM default.yellow_taxi_data WHERE VendorID IS NOT NULL) SELEC
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_yellow_tripdata.sql
[0m21:06:15.288081 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b41b27d-6340-44aa-b901-665499678d64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1b1c5fa0>]}
[0m21:06:15.289312 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_yellow_tripdata ............... [[31mERROR[0m in 0.09s]
[0m21:06:15.291162 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:06:15.292960 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:06:15.293724 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:06:15.294038 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m21:06:15.294334 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m21:06:15.296669 [info ] [MainThread]: 
[0m21:06:15.297155 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.35 seconds (1.35s).
[0m21:06:15.297652 [debug] [MainThread]: Command end result
[0m21:06:15.309510 [info ] [MainThread]: 
[0m21:06:15.310227 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:06:15.310805 [info ] [MainThread]: 
[0m21:06:15.311203 [error] [MainThread]: [33mDatabase Error in model stg_yellow_tripdata (models/staging/stg_yellow_tripdata.sql)[0m
[0m21:06:15.311758 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m21:06:15.312248 [error] [MainThread]:    Code: 47. DB::Exception: Missing columns: 'ehail_fee' while processing query: 'WITH tripdata AS (SELECT *, row_number() OVER (PARTITION BY VendorID, tpep_pickup_datetime) AS rn FROM default.yellow_taxi_data WHERE VendorID IS NOT NULL) SELEC
[0m21:06:15.312758 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_yellow_tripdata.sql
[0m21:06:15.313694 [info ] [MainThread]: 
[0m21:06:15.314133 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:06:15.314901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1a7ff400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1b169fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8c1b169be0>]}
[0m21:06:15.315344 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:08:07.189795 | 7770ab5e-f2fd-4e20-bbf0-2f681fe4aa35 ==============================
[0m21:08:07.189795 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:08:07.193109 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_yellow_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:08:07.193435 [debug] [MainThread]: Tracking: tracking
[0m21:08:07.229973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa490658070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa490658640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4906583d0>]}
[0m21:08:07.392630 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:08:07.393300 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_yellow_tripdata.sql
[0m21:08:07.410180 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m21:08:07.426153 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m21:08:07.485649 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:08:07.486267 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:08:07.498586 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:08:07.504927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7770ab5e-f2fd-4e20-bbf0-2f681fe4aa35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa490a37400>]}
[0m21:08:07.517770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7770ab5e-f2fd-4e20-bbf0-2f681fe4aa35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4908d25e0>]}
[0m21:08:07.518399 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:08:07.519076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7770ab5e-f2fd-4e20-bbf0-2f681fe4aa35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4909619d0>]}
[0m21:08:07.521562 [info ] [MainThread]: 
[0m21:08:07.523397 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:08:07.524494 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:08:07.538113 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:08:08.911946 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:08:08.924728 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:08:08.927684 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:08:08.927974 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:08:08.933489 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:08:08.947871 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:08:08.950458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7770ab5e-f2fd-4e20-bbf0-2f681fe4aa35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4908d2040>]}
[0m21:08:08.951210 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:08:08.951526 [info ] [MainThread]: 
[0m21:08:08.958808 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:08:08.959272 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m21:08:08.959897 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m21:08:08.960094 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_yellow_tripdata)
[0m21:08:08.960297 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:08:08.966727 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:08:08.969593 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 21:08:08.960448 => 2023-02-19 21:08:08.969432
[0m21:08:08.970030 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:08:08.998008 [debug] [Thread-1  ]: Creating new relation stg_yellow_tripdata
[0m21:08:09.006221 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:08:09.007942 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata 
  
  as (
    
 
with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(tpep_pickup_datetime) as pickup_datetime,
    toDateTime(tpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:08:09.027474 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:08:09.044930 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 21:08:08.970277 => 2023-02-19 21:08:09.044863
[0m21:08:09.045639 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7770ab5e-f2fd-4e20-bbf0-2f681fe4aa35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa491252e20>]}
[0m21:08:09.046133 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.09s]
[0m21:08:09.047569 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:08:09.049211 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:08:09.049907 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:08:09.050206 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m21:08:09.050477 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m21:08:09.052414 [info ] [MainThread]: 
[0m21:08:09.052842 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.53 seconds (1.53s).
[0m21:08:09.053244 [debug] [MainThread]: Command end result
[0m21:08:09.065938 [info ] [MainThread]: 
[0m21:08:09.066486 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:08:09.066852 [info ] [MainThread]: 
[0m21:08:09.067219 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:08:09.067691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa490a78a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa491290fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa491236fa0>]}
[0m21:08:09.068103 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:20:35.479245 | 556f6ab0-5b49-46ed-810c-321c43024465 ==============================
[0m21:20:35.479245 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:20:35.482310 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:20:35.482677 [debug] [MainThread]: Tracking: tracking
[0m21:20:35.515553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde96683040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde96683610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde966833a0>]}
[0m21:20:35.674533 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m21:20:35.675113 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://macros/generate_surrogate_key.sql
[0m21:20:35.675485 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:20:35.700029 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:20:35.729871 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:20:35.789845 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:20:35.790616 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:20:35.801993 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:20:35.809494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '556f6ab0-5b49-46ed-810c-321c43024465', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde96963a60>]}
[0m21:20:35.823432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '556f6ab0-5b49-46ed-810c-321c43024465', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde96881970>]}
[0m21:20:35.824058 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 505 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:20:35.824508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '556f6ab0-5b49-46ed-810c-321c43024465', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde968a39a0>]}
[0m21:20:35.826445 [info ] [MainThread]: 
[0m21:20:35.828493 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:20:35.834996 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:20:35.852393 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:20:36.508320 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:20:36.520377 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:20:36.523157 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:20:36.523567 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:20:36.529263 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:20:36.541683 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:20:36.544542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '556f6ab0-5b49-46ed-810c-321c43024465', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde96b0f130>]}
[0m21:20:36.545210 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:20:36.545509 [info ] [MainThread]: 
[0m21:20:36.553681 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:20:36.554265 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:20:36.555140 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:20:36.555428 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:20:36.555770 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:20:36.562074 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:20:36.564448 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:20:36.555946 => 2023-02-19 21:20:36.564286
[0m21:20:36.564844 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:20:36.609981 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:20:36.611720 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(VendorID as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:20:36.627015 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    md5(cast(coalesce(cast(VendorID as 
    string
), '') || '-' || coalesce(cast(lpep_pickup_datetime as 
    string
), '') as 
    string
)) as tripid,
    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m21:20:36.627373 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:20:36.565022 => 2023-02-19 21:20:36.627298
[0m21:20:36.645567 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 46. DB::Exception: Unknown function md5. Maybe you meant: ['MD5','MD4']: While processing md5(CAST(concat(coalesce(CAST(VendorID, 'string'), ''), '-', coalesce(CAST(lpep_pickup_datetime, 'string'), '')), 'string')) AS tripid, toUInt32
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:20:36.646005 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '556f6ab0-5b49-46ed-810c-321c43024465', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde967c74c0>]}
[0m21:20:36.646498 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.09s]
[0m21:20:36.647916 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:20:36.649472 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:20:36.650083 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:20:36.650340 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:20:36.650559 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:20:36.652350 [info ] [MainThread]: 
[0m21:20:36.652767 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.83 seconds (0.83s).
[0m21:20:36.653140 [debug] [MainThread]: Command end result
[0m21:20:36.665723 [info ] [MainThread]: 
[0m21:20:36.666175 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:20:36.666459 [info ] [MainThread]: 
[0m21:20:36.666708 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m21:20:36.667066 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m21:20:36.667353 [error] [MainThread]:    Code: 46. DB::Exception: Unknown function md5. Maybe you meant: ['MD5','MD4']: While processing md5(CAST(concat(coalesce(CAST(VendorID, 'string'), ''), '-', coalesce(CAST(lpep_pickup_datetime, 'string'), '')), 'string')) AS tripid, toUInt32
[0m21:20:36.667591 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:20:36.667825 [info ] [MainThread]: 
[0m21:20:36.668090 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:20:36.668454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde97496ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde968ab760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fde968aba90>]}
[0m21:20:36.668808 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:21:09.994279 | f2e40a56-dbe4-4106-85c4-3cac6926039c ==============================
[0m21:21:09.994279 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:21:09.997227 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:21:09.997737 [debug] [MainThread]: Tracking: tracking
[0m21:21:10.021759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab865fbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab8656550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab86560d0>]}
[0m21:21:10.268640 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:21:10.269360 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:21:10.290721 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:21:10.314306 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:21:10.390770 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:21:10.391431 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:21:10.406795 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:21:10.421573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2e40a56-dbe4-4106-85c4-3cac6926039c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab8923f10>]}
[0m21:21:10.440258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2e40a56-dbe4-4106-85c4-3cac6926039c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab87c3370>]}
[0m21:21:10.440806 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 505 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:21:10.441441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2e40a56-dbe4-4106-85c4-3cac6926039c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab8851b50>]}
[0m21:21:10.443702 [info ] [MainThread]: 
[0m21:21:10.447427 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:21:10.448955 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:21:10.463706 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:21:11.417745 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:21:11.430065 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:21:11.433099 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:21:11.433497 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:21:11.439052 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:21:11.452661 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:21:11.455427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2e40a56-dbe4-4106-85c4-3cac6926039c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab897bb50>]}
[0m21:21:11.456135 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:21:11.456437 [info ] [MainThread]: 
[0m21:21:11.461529 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:21:11.462026 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:21:11.462796 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:21:11.463080 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:21:11.463365 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:21:11.470473 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:21:11.463550 => 2023-02-19 21:21:11.470379
[0m21:21:11.481814 [debug] [Thread-1  ]: Compilation Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  'surrogate_key' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m21:21:11.482278 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2e40a56-dbe4-4106-85c4-3cac6926039c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab92a0520>]}
[0m21:21:11.482874 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.02s]
[0m21:21:11.485066 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:21:11.486637 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:21:11.487201 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:21:11.487401 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:21:11.487597 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:21:11.489615 [info ] [MainThread]: 
[0m21:21:11.490038 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.05 seconds (1.05s).
[0m21:21:11.490558 [debug] [MainThread]: Command end result
[0m21:21:11.502461 [info ] [MainThread]: 
[0m21:21:11.502909 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:21:11.503207 [info ] [MainThread]: 
[0m21:21:11.503554 [error] [MainThread]: [33mCompilation Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m21:21:11.504006 [error] [MainThread]:   'surrogate_key' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m21:21:11.504299 [info ] [MainThread]: 
[0m21:21:11.504587 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:21:11.504953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab888bfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab898d280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8ab898d400>]}
[0m21:21:11.505286 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:25:19.301954 | d6196218-b5cd-4924-ab1c-a3553392de07 ==============================
[0m21:25:19.301954 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:25:19.305336 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:25:19.305703 [debug] [MainThread]: Tracking: tracking
[0m21:25:19.334439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb671d8cb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb671e98580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb671e98310>]}
[0m21:25:19.501944 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 1 files changed.
[0m21:25:19.503049 [debug] [MainThread]: Partial parsing: deleted file: taxi_rides_ny://macros/generate_surrogate_key.sql
[0m21:25:19.503766 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:25:19.521627 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:25:19.540311 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:25:19.604816 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:25:19.605415 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:25:19.616181 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:25:19.621988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd6196218-b5cd-4924-ab1c-a3553392de07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb6720b9b20>]}
[0m21:25:19.637438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd6196218-b5cd-4924-ab1c-a3553392de07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb672070b20>]}
[0m21:25:19.637962 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:25:19.638362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6196218-b5cd-4924-ab1c-a3553392de07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb672091a60>]}
[0m21:25:19.640524 [info ] [MainThread]: 
[0m21:25:19.642335 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:25:19.648602 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:25:19.665381 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:25:20.504095 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:25:20.516674 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:25:20.519896 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:25:20.520394 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:25:20.526438 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:25:20.542858 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:25:20.545780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6196218-b5cd-4924-ab1c-a3553392de07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb672272460>]}
[0m21:25:20.546574 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:25:20.546946 [info ] [MainThread]: 
[0m21:25:20.555482 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:25:20.555908 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:25:20.556592 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:25:20.556845 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:25:20.557082 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:25:20.562885 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:25:20.567054 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:25:20.557239 => 2023-02-19 21:25:20.566903
[0m21:25:20.567432 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:25:20.617672 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:25:20.619073 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    concatWithSeparator(
      '-',
      ifNull(toSting(VendorID), ''),
      ifNull(toSting(lpep_pickup_datetime), ''),
    ) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:25:20.632049 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    concatWithSeparator(
      '-',
      ifNull(toSting(VendorID), ''),
      ifNull(toSting(lpep_pickup_datetime), ''),
    ) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m21:25:20.632505 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:25:20.567638 => 2023-02-19 21:25:20.632394
[0m21:25:20.657329 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
   Code: 62. DB::Exception: Syntax error: failed at position 557 (')') (line 22, col 5): ) as tripid,
  
      toUInt32(`VendorID`) as vendorid,
      toUInt32(`RatecodeID`) as ratecodeid,
      toUInt32(`PULocationID`) as  pickup_locationid,
      toUI
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:25:20.657964 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6196218-b5cd-4924-ab1c-a3553392de07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb672b38970>]}
[0m21:25:20.658538 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.10s]
[0m21:25:20.659934 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:25:20.663362 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:25:20.664258 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:25:20.664683 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:25:20.664982 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:25:20.667551 [info ] [MainThread]: 
[0m21:25:20.667953 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.03 seconds (1.03s).
[0m21:25:20.668554 [debug] [MainThread]: Command end result
[0m21:25:20.682114 [info ] [MainThread]: 
[0m21:25:20.682569 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:25:20.683044 [info ] [MainThread]: 
[0m21:25:20.683610 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m21:25:20.683929 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
[0m21:25:20.684183 [error] [MainThread]:    Code: 62. DB::Exception: Syntax error: failed at position 557 (')') (line 22, col 5): ) as tripid,
[0m21:25:20.684404 [error] [MainThread]:   
[0m21:25:20.684661 [error] [MainThread]:       toUInt32(`VendorID`) as vendorid,
[0m21:25:20.684861 [error] [MainThread]:       toUInt32(`RatecodeID`) as ratecodeid,
[0m21:25:20.685060 [error] [MainThread]:       toUInt32(`PULocationID`) as  pickup_locationid,
[0m21:25:20.685269 [error] [MainThread]:       toUI
[0m21:25:20.685463 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:25:20.685696 [info ] [MainThread]: 
[0m21:25:20.685948 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:25:20.686282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb671e369a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb672afa250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb672b56a00>]}
[0m21:25:20.686595 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:25:49.633893 | e14e0ba6-98bc-472f-aadd-b7a165fd3357 ==============================
[0m21:25:49.633893 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:25:49.636831 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:25:49.637195 [debug] [MainThread]: Tracking: tracking
[0m21:25:49.677018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc388e73bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc388e6c4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc388e6c280>]}
[0m21:25:49.820002 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:25:49.820697 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:25:49.837676 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:25:49.854071 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:25:49.911464 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:25:49.912039 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:25:49.922593 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:25:49.929623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e14e0ba6-98bc-472f-aadd-b7a165fd3357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc3891378b0>]}
[0m21:25:49.942373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e14e0ba6-98bc-472f-aadd-b7a165fd3357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc388fd4490>]}
[0m21:25:49.942913 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:25:49.943407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e14e0ba6-98bc-472f-aadd-b7a165fd3357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc389062880>]}
[0m21:25:49.944901 [info ] [MainThread]: 
[0m21:25:49.946707 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:25:49.948359 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:25:49.959151 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:25:50.772694 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:25:50.787005 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:25:50.789913 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:25:50.790294 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:25:50.795841 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:25:50.811018 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:25:50.813795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e14e0ba6-98bc-472f-aadd-b7a165fd3357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc388fd4190>]}
[0m21:25:50.814482 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:25:50.814780 [info ] [MainThread]: 
[0m21:25:50.827192 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:25:50.827853 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:25:50.828653 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:25:50.828978 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:25:50.829444 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:25:50.834003 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:25:50.835368 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:25:50.829666 => 2023-02-19 21:25:50.835259
[0m21:25:50.835730 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:25:50.876385 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:25:50.877809 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    concatWithSeparator(
      '-',
      ifNull(toSting(VendorID), ''),
      ifNull(toSting(lpep_pickup_datetime), '')
    ) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:25:50.896290 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    concatWithSeparator(
      '-',
      ifNull(toSting(VendorID), ''),
      ifNull(toSting(lpep_pickup_datetime), '')
    ) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m21:25:50.896702 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:25:50.835888 => 2023-02-19 21:25:50.896612
[0m21:25:50.912208 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 46. DB::Exception: Unknown function concatWithSeparator: While processing concatWithSeparator('-', ifNull(toSting(VendorID), ''), ifNull(toSting(lpep_pickup_datetime), '')) AS tripid, toUInt32(VendorID) AS vendorid, toUInt32(RatecodeI
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:25:50.913014 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e14e0ba6-98bc-472f-aadd-b7a165fd3357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc389ba0100>]}
[0m21:25:50.913699 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.08s]
[0m21:25:50.915257 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:25:50.916694 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:25:50.917293 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:25:50.917592 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:25:50.917820 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:25:50.920028 [info ] [MainThread]: 
[0m21:25:50.920440 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m21:25:50.920801 [debug] [MainThread]: Command end result
[0m21:25:50.933545 [info ] [MainThread]: 
[0m21:25:50.934013 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:25:50.934391 [info ] [MainThread]: 
[0m21:25:50.934959 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m21:25:50.935287 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m21:25:50.935758 [error] [MainThread]:    Code: 46. DB::Exception: Unknown function concatWithSeparator: While processing concatWithSeparator('-', ifNull(toSting(VendorID), ''), ifNull(toSting(lpep_pickup_datetime), '')) AS tripid, toUInt32(VendorID) AS vendorid, toUInt32(RatecodeI
[0m21:25:50.936080 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:25:50.936360 [info ] [MainThread]: 
[0m21:25:50.936653 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:25:50.937039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc388e73bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc389c17730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc389c179d0>]}
[0m21:25:50.937431 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:26:33.391263 | 1c54c771-129a-4186-be16-7361621a58a9 ==============================
[0m21:26:33.391263 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:26:33.394430 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:26:33.395013 [debug] [MainThread]: Tracking: tracking
[0m21:26:33.467529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98b9c8d910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98b9ead580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98b9ead2e0>]}
[0m21:26:33.609994 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:26:33.610654 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:26:33.628222 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:26:33.645665 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:26:33.699991 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:26:33.700578 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:26:33.710890 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:26:33.717984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1c54c771-129a-4186-be16-7361621a58a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98ba2b6910>]}
[0m21:26:33.731402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1c54c771-129a-4186-be16-7361621a58a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98ba154460>]}
[0m21:26:33.731917 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:26:33.732400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c54c771-129a-4186-be16-7361621a58a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98ba1e18e0>]}
[0m21:26:33.734693 [info ] [MainThread]: 
[0m21:26:33.736408 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:26:33.737618 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:26:33.748934 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:26:34.476308 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:26:34.491046 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:26:34.495584 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:26:34.496079 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:26:34.505611 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:26:34.521524 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:26:34.527374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c54c771-129a-4186-be16-7361621a58a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98ba30f310>]}
[0m21:26:34.528630 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:26:34.529227 [info ] [MainThread]: 
[0m21:26:34.538709 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:26:34.539422 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:26:34.540462 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:26:34.540903 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:26:34.541233 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:26:34.547396 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:26:34.548889 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:26:34.541445 => 2023-02-19 21:26:34.548757
[0m21:26:34.549277 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:26:34.594445 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:26:34.596910 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    MD5(concat(
      ifNull(toSting(VendorID), ''),
      '-',
      ifNull(toSting(lpep_pickup_datetime), '')
    )) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:26:34.616597 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    MD5(concat(
      ifNull(toSting(VendorID), ''),
      '-',
      ifNull(toSting(lpep_pickup_datetime), '')
    )) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m21:26:34.617202 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:26:34.549479 => 2023-02-19 21:26:34.617071
[0m21:26:34.636184 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 46. DB::Exception: Unknown function toSting. Maybe you meant: ['toString','toTime']: Or unknown aggregate function toSting. Maybe you meant: ['nothing']: While processing MD5(concat(ifNull(toSting(VendorID), ''), '-', ifNull(toSting(l
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:26:34.636736 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c54c771-129a-4186-be16-7361621a58a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98bac78820>]}
[0m21:26:34.637289 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.10s]
[0m21:26:34.638827 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:26:34.640514 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:26:34.641099 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:26:34.641323 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:26:34.641550 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:26:34.643738 [info ] [MainThread]: 
[0m21:26:34.644116 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.91 seconds (0.91s).
[0m21:26:34.644485 [debug] [MainThread]: Command end result
[0m21:26:34.674470 [info ] [MainThread]: 
[0m21:26:34.674936 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:26:34.675231 [info ] [MainThread]: 
[0m21:26:34.675482 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m21:26:34.675721 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m21:26:34.675945 [error] [MainThread]:    Code: 46. DB::Exception: Unknown function toSting. Maybe you meant: ['toString','toTime']: Or unknown aggregate function toSting. Maybe you meant: ['nothing']: While processing MD5(concat(ifNull(toSting(VendorID), ''), '-', ifNull(toSting(l
[0m21:26:34.676150 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:26:34.676357 [info ] [MainThread]: 
[0m21:26:34.676577 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:26:34.676927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98ba21ab80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98b931f3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f98b931f130>]}
[0m21:26:34.677310 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:27:05.116151 | aac2413f-31b6-4f78-bdd3-79e81749b533 ==============================
[0m21:27:05.116151 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:27:05.118748 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:27:05.119090 [debug] [MainThread]: Tracking: tracking
[0m21:27:05.140088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8a58c910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8a695550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8a6952e0>]}
[0m21:27:05.248890 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:27:05.249519 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:27:05.265766 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:27:05.287316 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:27:05.342442 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:27:05.343187 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:27:05.352480 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:27:05.359122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aac2413f-31b6-4f78-bdd3-79e81749b533', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8aa76910>]}
[0m21:27:05.372123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aac2413f-31b6-4f78-bdd3-79e81749b533', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8a915460>]}
[0m21:27:05.372538 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:27:05.372817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aac2413f-31b6-4f78-bdd3-79e81749b533', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8a9a18e0>]}
[0m21:27:05.374291 [info ] [MainThread]: 
[0m21:27:05.376038 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:27:05.377305 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:27:05.389259 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:27:06.160420 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:27:06.174370 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:27:06.180996 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:27:06.181716 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:27:06.192335 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:27:06.208089 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:27:06.211922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aac2413f-31b6-4f78-bdd3-79e81749b533', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8a9151f0>]}
[0m21:27:06.213002 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:27:06.213505 [info ] [MainThread]: 
[0m21:27:06.222834 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:27:06.223538 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:27:06.224748 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:27:06.225206 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:27:06.225611 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:27:06.230954 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:27:06.232348 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:27:06.225932 => 2023-02-19 21:27:06.232249
[0m21:27:06.232699 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:27:06.275618 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:27:06.277225 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:27:06.301723 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:27:06.314632 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m21:27:06.327412 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:27:06.329247 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m21:27:06.341796 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:27:06.347997 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m21:27:06.360468 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:27:06.362344 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m21:27:06.374012 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:27:06.402119 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m21:27:06.515893 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m21:27:06.519430 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:27:06.232904 => 2023-02-19 21:27:06.519306
[0m21:27:06.521106 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aac2413f-31b6-4f78-bdd3-79e81749b533', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8b414eb0>]}
[0m21:27:06.522372 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.30s]
[0m21:27:06.525822 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:27:06.528974 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:27:06.530094 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:27:06.530445 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:27:06.530785 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:27:06.534040 [info ] [MainThread]: 
[0m21:27:06.534727 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m21:27:06.535479 [debug] [MainThread]: Command end result
[0m21:27:06.552231 [info ] [MainThread]: 
[0m21:27:06.552695 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:27:06.553081 [info ] [MainThread]: 
[0m21:27:06.553447 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:27:06.553988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8a9d9850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8a981880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fac8a915310>]}
[0m21:27:06.554345 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:27:24.569023 | b08dcfd1-fb75-49b7-ac9c-490315fa4970 ==============================
[0m21:27:24.569023 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:27:24.571826 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:27:24.572339 [debug] [MainThread]: Tracking: tracking
[0m21:27:24.595727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc969d63910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc969f6b550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc969f6b2e0>]}
[0m21:27:24.699278 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:27:24.699897 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:27:24.713918 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:27:24.728497 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:27:24.781201 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:27:24.781826 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:27:24.790991 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:27:24.797242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b08dcfd1-fb75-49b7-ac9c-490315fa4970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc96a239910>]}
[0m21:27:24.820497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b08dcfd1-fb75-49b7-ac9c-490315fa4970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc96a0d8460>]}
[0m21:27:24.820978 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:27:24.821360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b08dcfd1-fb75-49b7-ac9c-490315fa4970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc96a1658e0>]}
[0m21:27:24.822874 [info ] [MainThread]: 
[0m21:27:24.824457 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:27:24.830303 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:27:24.843603 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:27:25.440251 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:27:25.454713 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:27:25.461332 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:27:25.462094 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:27:25.473560 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:27:25.488349 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:27:25.492599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b08dcfd1-fb75-49b7-ac9c-490315fa4970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc966f84730>]}
[0m21:27:25.493682 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:27:25.494092 [info ] [MainThread]: 
[0m21:27:25.500406 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:27:25.501052 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:27:25.502051 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:27:25.502408 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:27:25.502783 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:27:25.508437 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:27:25.509650 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:27:25.503152 => 2023-02-19 21:27:25.509529
[0m21:27:25.510080 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:27:25.550904 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:27:25.552386 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    MD5(concatWithSeparator(
      '-',
      ifNull(toString(vendorid), ''),
      ifNull(toString(pickup_datetime), '')
    )) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:27:25.569080 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    MD5(concatWithSeparator(
      '-',
      ifNull(toString(vendorid), ''),
      ifNull(toString(pickup_datetime), '')
    )) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m21:27:25.569744 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:27:25.510258 => 2023-02-19 21:27:25.569558
[0m21:27:25.578482 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 46. DB::Exception: Unknown function concatWithSeparator: While processing MD5(concatWithSeparator('-', ifNull(toString(toUInt32(VendorID) AS vendorid), ''), ifNull(toString(toDateTime(lpep_pickup_datetime) AS pickup_datetime), ''))) A
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:27:25.579033 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b08dcfd1-fb75-49b7-ac9c-490315fa4970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc96aaa3280>]}
[0m21:27:25.579626 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.08s]
[0m21:27:25.581527 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:27:25.585391 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:27:25.586278 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:27:25.586655 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:27:25.586960 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:27:25.589223 [info ] [MainThread]: 
[0m21:27:25.589924 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.77 seconds (0.77s).
[0m21:27:25.590585 [debug] [MainThread]: Command end result
[0m21:27:25.603944 [info ] [MainThread]: 
[0m21:27:25.604436 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:27:25.604877 [info ] [MainThread]: 
[0m21:27:25.605235 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m21:27:25.605549 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m21:27:25.605868 [error] [MainThread]:    Code: 46. DB::Exception: Unknown function concatWithSeparator: While processing MD5(concatWithSeparator('-', ifNull(toString(toUInt32(VendorID) AS vendorid), ''), ifNull(toString(toDateTime(lpep_pickup_datetime) AS pickup_datetime), ''))) A
[0m21:27:25.606337 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:27:25.606833 [info ] [MainThread]: 
[0m21:27:25.607159 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:27:25.607569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc96a0d8340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc96a1448e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc9690d9220>]}
[0m21:27:25.607957 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:28:25.575607 | af66117e-b38f-4762-8cc1-63e4ff48b3a7 ==============================
[0m21:28:25.575607 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:28:25.578501 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:28:25.578806 [debug] [MainThread]: Tracking: tracking
[0m21:28:25.595183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8e48cb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8e598580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8e598310>]}
[0m21:28:25.703842 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:28:25.704442 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:28:25.704769 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_yellow_tripdata.sql
[0m21:28:25.719918 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:28:25.737236 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:28:25.738564 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m21:28:25.743496 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m21:28:25.827382 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:28:25.828026 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:28:25.828483 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:28:25.828959 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:28:25.838459 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:28:25.846334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'af66117e-b38f-4762-8cc1-63e4ff48b3a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8e9fa8b0>]}
[0m21:28:25.873458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'af66117e-b38f-4762-8cc1-63e4ff48b3a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8e884970>]}
[0m21:28:25.873911 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:28:25.874221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af66117e-b38f-4762-8cc1-63e4ff48b3a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8e8a5910>]}
[0m21:28:25.875732 [info ] [MainThread]: 
[0m21:28:25.877395 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:28:25.879551 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:28:25.894912 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:26.517328 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:28:26.531188 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:28:26.535193 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:28:26.535630 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:28:26.543715 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:28:26.558940 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:28:26.564370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af66117e-b38f-4762-8cc1-63e4ff48b3a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8e9ceaf0>]}
[0m21:28:26.565618 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:28:26.566167 [info ] [MainThread]: 
[0m21:28:26.574567 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:28:26.575628 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:28:26.576831 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:28:26.577305 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:28:26.577676 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:28:26.583504 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:28:26.584855 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:28:26.577940 => 2023-02-19 21:28:26.584740
[0m21:28:26.585221 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:28:26.627984 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:28:26.629306 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    MD5(concatWithSeparator(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:28:26.647515 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    MD5(concatWithSeparator(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m21:28:26.648109 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:28:26.585419 => 2023-02-19 21:28:26.647985
[0m21:28:26.657288 [debug] [Thread-1  ]: Database Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 46. DB::Exception: Unknown function concatWithSeparator: While processing MD5(concatWithSeparator(ifNull(toString(toUInt32(VendorID) AS vendorid), ''), '-', ifNull(toString(toDateTime(lpep_pickup_datetime) AS pickup_datetime), ''))) A
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:28:26.658079 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af66117e-b38f-4762-8cc1-63e4ff48b3a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8f4bbcd0>]}
[0m21:28:26.658869 [error] [Thread-1  ]: 1 of 1 ERROR creating sql view model sandbox.stg_green_tripdata ................ [[31mERROR[0m in 0.08s]
[0m21:28:26.660731 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:28:26.662673 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:28:26.663544 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:28:26.663851 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:28:26.664113 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:28:26.666428 [info ] [MainThread]: 
[0m21:28:26.666819 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m21:28:26.667207 [debug] [MainThread]: Command end result
[0m21:28:26.678727 [info ] [MainThread]: 
[0m21:28:26.679206 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:28:26.679626 [info ] [MainThread]: 
[0m21:28:26.680092 [error] [MainThread]: [33mDatabase Error in model stg_green_tripdata (models/staging/stg_green_tripdata.sql)[0m
[0m21:28:26.680440 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m21:28:26.680877 [error] [MainThread]:    Code: 46. DB::Exception: Unknown function concatWithSeparator: While processing MD5(concatWithSeparator(ifNull(toString(toUInt32(VendorID) AS vendorid), ''), '-', ifNull(toString(toDateTime(lpep_pickup_datetime) AS pickup_datetime), ''))) A
[0m21:28:26.681294 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_green_tripdata.sql
[0m21:28:26.681590 [info ] [MainThread]: 
[0m21:28:26.681906 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:28:26.682527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8f289f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8f481be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a8f481910>]}
[0m21:28:26.682881 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:28:54.043746 | 7a00bd80-0a95-4310-8a33-c9a9b068bd87 ==============================
[0m21:28:54.043746 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:28:54.046434 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:28:54.046847 [debug] [MainThread]: Tracking: tracking
[0m21:28:54.073753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8780546070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8780546640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87805463d0>]}
[0m21:28:54.191816 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:28:54.192494 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_yellow_tripdata.sql
[0m21:28:54.192813 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:28:54.208549 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m21:28:54.226471 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m21:28:54.228370 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:28:54.233516 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:28:54.339293 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:28:54.340214 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:28:54.341028 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:28:54.341604 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:28:54.354413 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:28:54.361604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a00bd80-0a95-4310-8a33-c9a9b068bd87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8780aa5d60>]}
[0m21:28:54.402109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a00bd80-0a95-4310-8a33-c9a9b068bd87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8780943d90>]}
[0m21:28:54.402654 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:28:54.403046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a00bd80-0a95-4310-8a33-c9a9b068bd87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8780943d00>]}
[0m21:28:54.404733 [info ] [MainThread]: 
[0m21:28:54.406467 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:28:54.412598 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:28:54.433098 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:54.966874 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:28:54.981560 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:28:54.987145 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:28:54.987578 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:28:54.996768 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:28:55.012269 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:28:55.017832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a00bd80-0a95-4310-8a33-c9a9b068bd87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8780508eb0>]}
[0m21:28:55.018893 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:28:55.019963 [info ] [MainThread]: 
[0m21:28:55.027195 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:28:55.027802 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:28:55.028921 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:28:55.029400 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:28:55.029737 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:28:55.034137 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:28:55.035931 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:28:55.029918 => 2023-02-19 21:28:55.035701
[0m21:28:55.036515 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:28:55.088928 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:28:55.090499 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:28:55.111336 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:28:55.119818 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m21:28:55.132019 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:28:55.133507 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m21:28:55.145616 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:28:55.149050 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m21:28:55.161541 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:28:55.163039 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m21:28:55.175569 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:28:55.208383 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m21:28:55.321737 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m21:28:55.324823 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:28:55.036890 => 2023-02-19 21:28:55.324716
[0m21:28:55.326063 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a00bd80-0a95-4310-8a33-c9a9b068bd87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f878135c910>]}
[0m21:28:55.326989 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.30s]
[0m21:28:55.330024 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:28:55.332359 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:28:55.333327 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:28:55.333707 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:28:55.334228 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:28:55.337395 [info ] [MainThread]: 
[0m21:28:55.337884 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.93 seconds (0.93s).
[0m21:28:55.338487 [debug] [MainThread]: Command end result
[0m21:28:55.351901 [info ] [MainThread]: 
[0m21:28:55.352373 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:28:55.352696 [info ] [MainThread]: 
[0m21:28:55.353014 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:28:55.353385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8780a85760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87809a3040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8780a96af0>]}
[0m21:28:55.353704 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:29:28.574889 | baf6da99-2b5d-4860-8e28-94217a34cb24 ==============================
[0m21:29:28.574889 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:29:28.577564 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_yellow_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:29:28.578102 [debug] [MainThread]: Tracking: tracking
[0m21:29:28.605035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a7d77b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a7e82580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a7e82310>]}
[0m21:29:28.730789 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:29:28.731119 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:29:28.731895 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:29:28.741703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'baf6da99-2b5d-4860-8e28-94217a34cb24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a80af490>]}
[0m21:29:28.776051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'baf6da99-2b5d-4860-8e28-94217a34cb24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a7fcfe20>]}
[0m21:29:28.776581 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:29:28.776969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'baf6da99-2b5d-4860-8e28-94217a34cb24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a7fcfbe0>]}
[0m21:29:28.778663 [info ] [MainThread]: 
[0m21:29:28.780270 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:29:28.786131 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:29:28.815971 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:29:29.486248 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:29:29.499169 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:29:29.505210 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:29:29.505809 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:29:29.515599 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:29:29.530722 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:29:29.535521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'baf6da99-2b5d-4860-8e28-94217a34cb24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a80de160>]}
[0m21:29:29.536528 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:29:29.536974 [info ] [MainThread]: 
[0m21:29:29.545316 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:29:29.545929 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m21:29:29.546808 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m21:29:29.547104 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_yellow_tripdata)
[0m21:29:29.547354 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:29:29.556494 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:29:29.562118 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 21:29:29.547521 => 2023-02-19 21:29:29.561986
[0m21:29:29.562474 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:29:29.609729 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:29:29.611276 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    
 
with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(tpep_pickup_datetime) as pickup_datetime,
    toDateTime(tpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:29:29.634834 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:29:29.641906 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m21:29:29.653062 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:29:29.654289 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m21:29:29.667584 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:29:29.670662 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m21:29:29.684084 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:29:29.685303 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m21:29:29.723565 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m21:29:29.765345 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m21:29:29.777989 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:29:29.779342 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 21:29:29.562717 => 2023-02-19 21:29:29.779284
[0m21:29:29.780002 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'baf6da99-2b5d-4860-8e28-94217a34cb24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a89a4dc0>]}
[0m21:29:29.780478 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.23s]
[0m21:29:29.781867 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:29:29.783377 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:29:29.784049 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:29:29.784299 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m21:29:29.784519 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m21:29:29.786611 [info ] [MainThread]: 
[0m21:29:29.787014 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.01 seconds (1.01s).
[0m21:29:29.787513 [debug] [MainThread]: Command end result
[0m21:29:29.918202 [info ] [MainThread]: 
[0m21:29:29.919327 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:29:29.927447 [info ] [MainThread]: 
[0m21:29:29.931298 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:29:29.933285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a7193f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a7085a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f99a705d460>]}
[0m21:29:29.933884 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:33:41.193891 | 7c0cf19f-b744-499b-bb39-b346b961c458 ==============================
[0m21:33:41.193891 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:33:41.197390 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_yellow_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:33:41.197745 [debug] [MainThread]: Tracking: tracking
[0m21:33:41.243778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec562910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec667550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec6672e0>]}
[0m21:33:41.548754 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:33:41.549668 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:33:41.550039 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_yellow_tripdata.sql
[0m21:33:41.572190 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:33:41.598281 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:33:41.600283 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m21:33:41.606665 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m21:33:41.706353 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:33:41.707042 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:33:41.707580 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:33:41.708064 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:33:41.718855 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:33:41.724753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7c0cf19f-b744-499b-bb39-b346b961c458', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec9bbc10>]}
[0m21:33:41.737440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7c0cf19f-b744-499b-bb39-b346b961c458', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec849bb0>]}
[0m21:33:41.737905 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:33:41.738204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c0cf19f-b744-499b-bb39-b346b961c458', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec849d00>]}
[0m21:33:41.739691 [info ] [MainThread]: 
[0m21:33:41.741500 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:33:41.742669 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:33:41.755556 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:33:42.570269 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:33:42.582433 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:33:42.585090 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:33:42.585470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:33:42.592266 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:33:42.605420 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:33:42.608166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c0cf19f-b744-499b-bb39-b346b961c458', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec7db250>]}
[0m21:33:42.608876 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:33:42.609155 [info ] [MainThread]: 
[0m21:33:42.617319 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:33:42.617787 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m21:33:42.618357 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m21:33:42.618588 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_yellow_tripdata)
[0m21:33:42.618822 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:33:42.623544 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:33:42.627230 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 21:33:42.618999 => 2023-02-19 21:33:42.627107
[0m21:33:42.627602 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:33:42.668781 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:33:42.670733 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    
 
with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(tpep_pickup_datetime) as pickup_datetime,
    toDateTime(tpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:33:42.690665 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:33:42.698147 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m21:33:42.708738 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:33:42.709941 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m21:33:42.721034 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:33:42.723978 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m21:33:42.734274 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:33:42.735500 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m21:33:42.746160 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:33:42.775162 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m21:33:42.886591 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m21:33:42.888002 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 21:33:42.627821 => 2023-02-19 21:33:42.887950
[0m21:33:42.888703 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c0cf19f-b744-499b-bb39-b346b961c458', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ed35d820>]}
[0m21:33:42.889115 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.27s]
[0m21:33:42.890367 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:33:42.892989 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:33:42.893599 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:33:42.893847 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m21:33:42.894233 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m21:33:42.896295 [info ] [MainThread]: 
[0m21:33:42.896882 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m21:33:42.897294 [debug] [MainThread]: Command end result
[0m21:33:42.907648 [info ] [MainThread]: 
[0m21:33:42.908105 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:33:42.908381 [info ] [MainThread]: 
[0m21:33:42.908655 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:33:42.909036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec6754f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec529be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff0ec7db370>]}
[0m21:33:42.909384 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:34:07.391843 | 0812e1c9-5750-455e-8e80-e1dd31fae4b2 ==============================
[0m21:34:07.391843 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:34:07.395927 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:34:07.396321 [debug] [MainThread]: Tracking: tracking
[0m21:34:07.420214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd7d5fb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd7f6b580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd7f6b310>]}
[0m21:34:07.605697 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:34:07.606326 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:34:07.607553 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:34:07.619843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0812e1c9-5750-455e-8e80-e1dd31fae4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd8199490>]}
[0m21:34:07.634205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0812e1c9-5750-455e-8e80-e1dd31fae4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd80bfe20>]}
[0m21:34:07.634713 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:34:07.635012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0812e1c9-5750-455e-8e80-e1dd31fae4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd80bfbe0>]}
[0m21:34:07.636439 [info ] [MainThread]: 
[0m21:34:07.639133 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:34:07.640517 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:34:07.652713 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:34:08.422452 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:34:08.434771 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:34:08.440144 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:34:08.440455 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:34:08.448669 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:34:08.462965 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:34:08.465569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0812e1c9-5750-455e-8e80-e1dd31fae4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd81ca160>]}
[0m21:34:08.466383 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:34:08.466861 [info ] [MainThread]: 
[0m21:34:08.477542 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m21:34:08.477994 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m21:34:08.478701 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m21:34:08.478960 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m21:34:08.479216 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m21:34:08.487320 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:34:08.489434 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 21:34:08.479478 => 2023-02-19 21:34:08.489310
[0m21:34:08.489773 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m21:34:08.533387 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m21:34:08.534786 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    toDateTime(lpep_pickup_datetime) as pickup_datetime,
    toDateTime(lpep_dropoff_datetime) as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:34:08.561508 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m21:34:08.568619 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m21:34:08.580886 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:34:08.582044 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m21:34:08.592696 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:34:08.595658 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m21:34:08.606307 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:34:08.607800 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m21:34:08.618752 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:34:08.641367 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m21:34:08.652388 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:34:08.653809 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 21:34:08.489944 => 2023-02-19 21:34:08.653753
[0m21:34:08.654452 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0812e1c9-5750-455e-8e80-e1dd31fae4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd892bd90>]}
[0m21:34:08.654920 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.18s]
[0m21:34:08.656212 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m21:34:08.657813 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:34:08.658343 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:34:08.658556 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m21:34:08.658765 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m21:34:08.660716 [info ] [MainThread]: 
[0m21:34:08.661025 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.02 seconds (1.02s).
[0m21:34:08.661383 [debug] [MainThread]: Command end result
[0m21:34:08.717207 [info ] [MainThread]: 
[0m21:34:08.717652 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:34:08.717915 [info ] [MainThread]: 
[0m21:34:08.718195 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:34:08.718561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd88a4760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd75e9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9fd7025070>]}
[0m21:34:08.718880 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 21:36:08.520892 | b228d700-75ab-44da-92c7-abcfcacd2e96 ==============================
[0m21:36:08.520892 [info ] [MainThread]: Running with dbt=1.4.1
[0m21:36:08.524740 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_yellow_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m21:36:08.525262 [debug] [MainThread]: Tracking: tracking
[0m21:36:08.556599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa293d8d910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa293e94550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa293e942e0>]}
[0m21:36:08.717781 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:36:08.731007 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m21:36:08.731594 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_yellow_tripdata.sql
[0m21:36:08.752063 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m21:36:08.772883 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m21:36:08.774636 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m21:36:08.780310 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m21:36:08.877026 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:36:08.877656 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:36:08.878107 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:36:08.878682 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m21:36:08.890371 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m21:36:08.896657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b228d700-75ab-44da-92c7-abcfcacd2e96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2941e5c10>]}
[0m21:36:08.910508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b228d700-75ab-44da-92c7-abcfcacd2e96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa294073bb0>]}
[0m21:36:08.911118 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m21:36:08.911426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b228d700-75ab-44da-92c7-abcfcacd2e96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa294073d00>]}
[0m21:36:08.913435 [info ] [MainThread]: 
[0m21:36:08.915205 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:36:08.916241 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m21:36:08.927785 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:36:09.740074 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m21:36:09.754611 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:36:09.758303 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m21:36:09.758667 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m21:36:09.765590 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m21:36:09.784357 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:36:09.788496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b228d700-75ab-44da-92c7-abcfcacd2e96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa29409acd0>]}
[0m21:36:09.789243 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:36:09.789650 [info ] [MainThread]: 
[0m21:36:09.798106 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:36:09.798650 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m21:36:09.799307 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m21:36:09.799539 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_yellow_tripdata)
[0m21:36:09.799795 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:36:09.804914 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:36:09.807900 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 21:36:09.799941 => 2023-02-19 21:36:09.807726
[0m21:36:09.808242 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:36:09.849089 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m21:36:09.850493 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    
 
with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m21:36:09.880646 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m21:36:09.892075 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m21:36:09.906274 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:36:09.907626 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m21:36:09.921693 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:36:09.924980 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m21:36:09.938631 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:36:09.939928 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m21:36:09.955441 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:36:09.985485 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m21:36:10.101286 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.12 seconds
[0m21:36:10.104660 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 21:36:09.808412 => 2023-02-19 21:36:10.104556
[0m21:36:10.105771 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b228d700-75ab-44da-92c7-abcfcacd2e96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa294a9b7f0>]}
[0m21:36:10.106468 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.31s]
[0m21:36:10.108570 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m21:36:10.111640 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:36:10.112452 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:36:10.112752 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m21:36:10.113034 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m21:36:10.116432 [info ] [MainThread]: 
[0m21:36:10.116972 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.20 seconds (1.20s).
[0m21:36:10.117625 [debug] [MainThread]: Command end result
[0m21:36:10.133272 [info ] [MainThread]: 
[0m21:36:10.133755 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:36:10.134083 [info ] [MainThread]: 
[0m21:36:10.134564 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:36:10.135208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa294073b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa2941b8760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa294a5e790>]}
[0m21:36:10.135748 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 22:17:15.078789 | a4577b37-f3ba-447a-958c-60ec860af3e3 ==============================
[0m22:17:15.078789 [info ] [MainThread]: Running with dbt=1.4.1
[0m22:17:15.082237 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m22:17:15.082628 [debug] [MainThread]: Tracking: tracking
[0m22:17:15.106266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd4485b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd458f5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd458f160>]}
[0m22:17:15.253046 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:17:15.253706 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m22:17:15.270620 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m22:17:15.286630 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m22:17:15.342007 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m22:17:15.342720 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m22:17:15.356282 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m22:17:15.362631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a4577b37-f3ba-447a-958c-60ec860af3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd497be80>]}
[0m22:17:15.375275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a4577b37-f3ba-447a-958c-60ec860af3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd4542f40>]}
[0m22:17:15.375747 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m22:17:15.376034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4577b37-f3ba-447a-958c-60ec860af3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd4889ca0>]}
[0m22:17:15.377766 [info ] [MainThread]: 
[0m22:17:15.379536 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:17:15.381139 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m22:17:15.391480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:17:16.019827 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m22:17:16.032622 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:17:16.037355 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m22:17:16.037878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m22:17:16.048081 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m22:17:16.064994 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:17:16.068781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4577b37-f3ba-447a-958c-60ec860af3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd45420d0>]}
[0m22:17:16.069759 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:17:16.070190 [info ] [MainThread]: 
[0m22:17:16.077896 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m22:17:16.078599 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m22:17:16.079569 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m22:17:16.079852 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m22:17:16.080132 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m22:17:16.085383 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m22:17:16.087801 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 22:17:16.080338 => 2023-02-19 22:17:16.087591
[0m22:17:16.088289 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m22:17:16.125936 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m22:17:16.127447 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m22:17:16.147191 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:17:16.155526 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m22:17:16.168977 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:17:16.171206 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m22:17:16.193431 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:17:16.201209 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m22:17:16.213448 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:17:16.215900 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m22:17:16.228613 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:17:16.264831 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m22:17:16.276886 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:17:16.278472 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 22:17:16.088551 => 2023-02-19 22:17:16.278406
[0m22:17:16.279178 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4577b37-f3ba-447a-958c-60ec860af3e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd52e0670>]}
[0m22:17:16.279678 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.20s]
[0m22:17:16.281402 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m22:17:16.283501 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:17:16.284116 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:17:16.284337 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m22:17:16.284559 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m22:17:16.286518 [info ] [MainThread]: 
[0m22:17:16.286831 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.91 seconds (0.91s).
[0m22:17:16.287217 [debug] [MainThread]: Command end result
[0m22:17:16.299492 [info ] [MainThread]: 
[0m22:17:16.299955 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:17:16.300270 [info ] [MainThread]: 
[0m22:17:16.300558 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:17:16.300964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd4b373a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd4542370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8cd54e1ca0>]}
[0m22:17:16.301298 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 22:28:07.210502 | c09a199a-8a85-4aef-bc1f-a922b276f0e1 ==============================
[0m22:28:07.210502 [info ] [MainThread]: Running with dbt=1.4.1
[0m22:28:07.213198 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m22:28:07.213530 [debug] [MainThread]: Tracking: tracking
[0m22:28:07.247799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc78eb5c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc78eab520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc78eab2b0>]}
[0m22:28:07.400003 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:28:07.400611 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m22:28:07.418800 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m22:28:07.436241 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m22:28:07.491977 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m22:28:07.492604 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m22:28:07.505453 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m22:28:07.512795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c09a199a-8a85-4aef-bc1f-a922b276f0e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc7927bee0>]}
[0m22:28:07.524728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c09a199a-8a85-4aef-bc1f-a922b276f0e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc7911c1c0>]}
[0m22:28:07.525186 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m22:28:07.525540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c09a199a-8a85-4aef-bc1f-a922b276f0e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc791a98b0>]}
[0m22:28:07.527105 [info ] [MainThread]: 
[0m22:28:07.528866 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:28:07.530087 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m22:28:07.558308 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:28:08.309353 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m22:28:08.324904 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:28:08.328499 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m22:28:08.328877 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m22:28:08.334414 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m22:28:08.352834 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:28:08.355974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c09a199a-8a85-4aef-bc1f-a922b276f0e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc78e5cd30>]}
[0m22:28:08.356634 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:28:08.356929 [info ] [MainThread]: 
[0m22:28:08.363749 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m22:28:08.364306 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m22:28:08.365146 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m22:28:08.365464 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m22:28:08.365765 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m22:28:08.370818 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m22:28:08.374624 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 22:28:08.365968 => 2023-02-19 22:28:08.374482
[0m22:28:08.374990 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m22:28:08.414322 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m22:28:08.416484 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m22:28:08.453749 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m22:28:08.460575 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m22:28:08.474422 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:28:08.475704 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m22:28:08.489564 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:28:08.492805 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m22:28:08.506611 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:28:08.507932 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m22:28:08.521986 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:28:08.543567 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m22:28:08.659822 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.12 seconds
[0m22:28:08.661367 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 22:28:08.375190 => 2023-02-19 22:28:08.661307
[0m22:28:08.662023 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c09a199a-8a85-4aef-bc1f-a922b276f0e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc79ba1610>]}
[0m22:28:08.662523 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.30s]
[0m22:28:08.663866 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m22:28:08.665641 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:28:08.666335 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:28:08.666621 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m22:28:08.666853 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m22:28:08.668979 [info ] [MainThread]: 
[0m22:28:08.669403 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.14 seconds (1.14s).
[0m22:28:08.669764 [debug] [MainThread]: Command end result
[0m22:28:08.681540 [info ] [MainThread]: 
[0m22:28:08.682007 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:28:08.682343 [info ] [MainThread]: 
[0m22:28:08.682645 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:28:08.683063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc78eb5c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc79cba2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdc79cbaee0>]}
[0m22:28:08.683468 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 22:40:27.831576 | c187c33b-afa9-4e5e-9f85-6ba13820836c ==============================
[0m22:40:27.831576 [info ] [MainThread]: Running with dbt=1.4.1
[0m22:40:27.835169 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'vars': 'is_test_run: false', 'select': ['stg_green_tripdata'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m22:40:27.835566 [debug] [MainThread]: Tracking: tracking
[0m22:40:27.865368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd06758040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd06758610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd067583a0>]}
[0m22:40:27.921457 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m22:40:27.922103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c187c33b-afa9-4e5e-9f85-6ba13820836c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd06710820>]}
[0m22:40:29.323672 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m22:40:29.344037 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m22:40:29.347062 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m22:40:29.354083 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m22:40:29.511146 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m22:40:29.511841 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m22:40:29.512940 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m22:40:29.513990 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' (models/staging/schema.yml) depends on a node named 'taxi_zone_lookup' in package '' which was not found
[0m22:40:29.600597 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.taxi_rides_ny.core
- seeds.taxi_rides_ny.taxi_zone_lookup
[0m22:40:29.608670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c187c33b-afa9-4e5e-9f85-6ba13820836c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd06a7b520>]}
[0m22:40:29.645841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c187c33b-afa9-4e5e-9f85-6ba13820836c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd06a1b8b0>]}
[0m22:40:29.646465 [info ] [MainThread]: Found 2 models, 6 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 0 seed files, 2 sources, 0 exposures, 0 metrics
[0m22:40:29.647482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c187c33b-afa9-4e5e-9f85-6ba13820836c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd0699b730>]}
[0m22:40:29.649154 [info ] [MainThread]: 
[0m22:40:29.650981 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:40:29.652504 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m22:40:29.666074 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:40:30.452909 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m22:40:30.465392 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:40:30.468402 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m22:40:30.468770 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m22:40:30.475750 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m22:40:30.489526 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:40:30.492572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c187c33b-afa9-4e5e-9f85-6ba13820836c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd06ab38b0>]}
[0m22:40:30.493385 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:40:30.493721 [info ] [MainThread]: 
[0m22:40:30.502339 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m22:40:30.502871 [info ] [Thread-1  ]: 1 of 1 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m22:40:30.503806 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m22:40:30.504114 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m22:40:30.504388 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m22:40:30.510122 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m22:40:30.512608 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 22:40:30.504567 => 2023-02-19 22:40:30.512471
[0m22:40:30.512969 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m22:40:30.562670 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m22:40:30.565390 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'

  )...
[0m22:40:30.593609 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m22:40:30.601825 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m22:40:30.613425 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:40:30.614839 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m22:40:30.625802 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:40:30.629272 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m22:40:30.641664 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:40:30.642983 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m22:40:30.654296 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:40:30.682650 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m22:40:30.794747 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m22:40:30.796277 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 22:40:30.513159 => 2023-02-19 22:40:30.796217
[0m22:40:30.796985 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c187c33b-afa9-4e5e-9f85-6ba13820836c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd0748bd90>]}
[0m22:40:30.797449 [info ] [Thread-1  ]: 1 of 1 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.29s]
[0m22:40:30.798858 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m22:40:30.800453 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:40:30.801157 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:40:30.801408 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m22:40:30.801641 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m22:40:30.804035 [info ] [MainThread]: 
[0m22:40:30.804465 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.15 seconds (1.15s).
[0m22:40:30.804898 [debug] [MainThread]: Command end result
[0m22:40:30.819169 [info ] [MainThread]: 
[0m22:40:30.819741 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:40:30.820109 [info ] [MainThread]: 
[0m22:40:30.820436 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:40:30.820849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd06a1bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd075889d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd07588190>]}
[0m22:40:30.821199 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 23:03:16.111941 | a6953e62-2451-4ae9-b248-e105b24b0af1 ==============================
[0m23:03:16.111941 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:03:16.115012 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'parse_only': False, 'select': ['dim_zones'], 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m23:03:16.115382 [debug] [MainThread]: Tracking: tracking
[0m23:03:16.150143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb97089c040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb97089c610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb97089c3a0>]}
[0m23:03:16.191962 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m23:03:16.192510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a6953e62-2451-4ae9-b248-e105b24b0af1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb970849820>]}
[0m23:03:17.309069 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m23:03:17.324901 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m23:03:17.326772 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m23:03:17.332708 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m23:03:17.336175 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m23:03:17.455968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb970b09e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb970af2850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb970af26d0>]}
[0m23:03:17.456329 [debug] [MainThread]: Flushing usage events
[0m23:03:18.098521 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 23:03:35.215620 | 850eec1a-7a41-493d-9bf2-22009f7bf3c3 ==============================
[0m23:03:35.215620 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:03:35.225694 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'full_refresh': True, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m23:03:35.226763 [debug] [MainThread]: Tracking: tracking
[0m23:03:35.272076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9288e4cf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9288f435e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9288f43370>]}
[0m23:03:35.370571 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m23:03:35.371091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '850eec1a-7a41-493d-9bf2-22009f7bf3c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9288eb4850>]}
[0m23:03:36.619341 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m23:03:36.635651 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m23:03:36.637292 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m23:03:36.642622 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m23:03:36.646334 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m23:03:36.775393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92891b1a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92891cea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92891ce940>]}
[0m23:03:36.775791 [debug] [MainThread]: Flushing usage events
[0m23:03:38.512847 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.taxi_rides_ny.dim_zones' (models/core/dim_zones.sql) depends on a node named 'taxi_zone_lookup' which was not found


============================== 2023-02-19 23:05:03.344536 | 4e338272-6503-4426-9060-bf1efc8d9baa ==============================
[0m23:05:03.344536 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:05:03.347376 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'full_refresh': True, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m23:05:03.347690 [debug] [MainThread]: Tracking: tracking
[0m23:05:03.374894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f6ea2f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f6f9c5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f6f9c370>]}
[0m23:05:03.415537 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m23:05:03.416000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4e338272-6503-4426-9060-bf1efc8d9baa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f6f4a640>]}
[0m23:05:04.579152 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m23:05:04.594257 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m23:05:04.595909 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m23:05:04.601244 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m23:05:04.603834 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m23:05:04.785023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4e338272-6503-4426-9060-bf1efc8d9baa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f72fdc40>]}
[0m23:05:04.796641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4e338272-6503-4426-9060-bf1efc8d9baa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f7292160>]}
[0m23:05:04.797073 [info ] [MainThread]: Found 3 models, 10 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 2 sources, 0 exposures, 0 metrics
[0m23:05:04.797417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e338272-6503-4426-9060-bf1efc8d9baa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f715a8e0>]}
[0m23:05:04.799089 [info ] [MainThread]: 
[0m23:05:04.800875 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:05:04.802049 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m23:05:04.815448 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:05:05.528344 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m23:05:05.540214 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:05:05.543412 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m23:05:05.543854 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m23:05:05.549887 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m23:05:05.563849 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:05:05.566974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e338272-6503-4426-9060-bf1efc8d9baa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f7358550>]}
[0m23:05:05.567730 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:05:05.568030 [info ] [MainThread]: 
[0m23:05:05.582923 [debug] [Thread-1  ]: Began running node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:05:05.583515 [info ] [Thread-1  ]: 1 of 1 START seed file sandbox.taxi_zone_lookup ................................ [RUN]
[0m23:05:05.584431 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'seed.taxi_rides_ny.taxi_zone_lookup'
[0m23:05:05.584776 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly seed.taxi_rides_ny.taxi_zone_lookup)
[0m23:05:05.585027 [debug] [Thread-1  ]: Began compiling node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:05:05.585269 [debug] [Thread-1  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (compile): 2023-02-19 23:05:05.585203 => 2023-02-19 23:05:05.585207
[0m23:05:05.585463 [debug] [Thread-1  ]: Began executing node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:05:05.632927 [debug] [Thread-1  ]: dbt_clickhouse adapter: On seed.taxi_rides_ny.taxi_zone_lookup: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "seed.taxi_rides_ny.taxi_zone_lookup"} */

    create table sandbox.taxi_zone_lookup ("locationid" numeric,"borough" String,"zone" String,"service_zone" String)
    
  engine = MergeTree()
    
      order by (tuple())
    
  ...
[0m23:05:05.645006 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "seed.taxi_rides_ny.taxi_zone_lookup"} */

    create table sandbox.taxi_zone_lookup ("locationid" numeric,"borough" String,"zone" String,"service_zone" String)
    
  engine = MergeTree()
    
      order by (tuple())
    
  
[0m23:05:05.645366 [debug] [Thread-1  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (execute): 2023-02-19 23:05:05.585589 => 2023-02-19 23:05:05.645292
[0m23:05:05.662807 [debug] [Thread-1  ]: Database Error in seed taxi_zone_lookup (seeds/taxi_zone_lookup.csv)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 42. DB::Exception: Decimal data type family must have exactly two arguments: precision and scale. (NUMBER_OF_ARGUMENTS_DOESNT_MATCH) (version 22.8.13.20 (official build))
[0m23:05:05.663888 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e338272-6503-4426-9060-bf1efc8d9baa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f7d87a00>]}
[0m23:05:05.664536 [error] [Thread-1  ]: 1 of 1 ERROR loading seed file sandbox.taxi_zone_lookup ........................ [[31mERROR[0m in 0.08s]
[0m23:05:05.666237 [debug] [Thread-1  ]: Finished running node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:05:05.668235 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:05:05.668834 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:05:05.669055 [debug] [MainThread]: Connection 'seed.taxi_rides_ny.taxi_zone_lookup' was left open.
[0m23:05:05.669252 [debug] [MainThread]: On seed.taxi_rides_ny.taxi_zone_lookup: Close
[0m23:05:05.671082 [info ] [MainThread]: 
[0m23:05:05.671445 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m23:05:05.671873 [debug] [MainThread]: Command end result
[0m23:05:05.706778 [info ] [MainThread]: 
[0m23:05:05.707190 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:05:05.707451 [info ] [MainThread]: 
[0m23:05:05.707685 [error] [MainThread]: [33mDatabase Error in seed taxi_zone_lookup (seeds/taxi_zone_lookup.csv)[0m
[0m23:05:05.707903 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m23:05:05.708098 [error] [MainThread]:    Code: 42. DB::Exception: Decimal data type family must have exactly two arguments: precision and scale. (NUMBER_OF_ARGUMENTS_DOESNT_MATCH) (version 22.8.13.20 (official build))
[0m23:05:05.708292 [info ] [MainThread]: 
[0m23:05:05.708503 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m23:05:05.708807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f7b7c430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f73720a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8f7148a90>]}
[0m23:05:05.709275 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 23:07:53.988370 | a7acc0ee-4a79-4a0d-8330-83216ff447de ==============================
[0m23:07:53.988370 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:07:53.991784 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'parse_only': False, 'select': ['dim_zones'], 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m23:07:53.992184 [debug] [MainThread]: Tracking: tracking
[0m23:07:54.017285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc067c100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc067c670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc067c400>]}
[0m23:07:54.171261 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:07:54.171592 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:07:54.180363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7acc0ee-4a79-4a0d-8330-83216ff447de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc08b5700>]}
[0m23:07:54.192830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7acc0ee-4a79-4a0d-8330-83216ff447de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc088ef40>]}
[0m23:07:54.193248 [info ] [MainThread]: Found 3 models, 10 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 2 sources, 0 exposures, 0 metrics
[0m23:07:54.193543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7acc0ee-4a79-4a0d-8330-83216ff447de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc07d6190>]}
[0m23:07:54.195139 [info ] [MainThread]: 
[0m23:07:54.197113 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:07:54.199234 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m23:07:54.211253 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:07:54.923500 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m23:07:54.937653 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:07:54.940850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7acc0ee-4a79-4a0d-8330-83216ff447de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc088ed90>]}
[0m23:07:54.941570 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:07:54.941868 [info ] [MainThread]: 
[0m23:07:54.949720 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m23:07:54.950470 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m23:07:54.950867 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m23:07:54.951517 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m23:07:54.954939 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m23:07:54.956357 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-19 23:07:54.951734 => 2023-02-19 23:07:54.956258
[0m23:07:54.956694 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m23:07:54.956902 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-19 23:07:54.956842 => 2023-02-19 23:07:54.956863
[0m23:07:54.958216 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m23:07:54.959465 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:07:54.959743 [debug] [MainThread]: Connection 'model.taxi_rides_ny.dim_zones' was left open.
[0m23:07:54.959948 [debug] [MainThread]: On model.taxi_rides_ny.dim_zones: Close
[0m23:07:54.962207 [debug] [MainThread]: Command end result
[0m23:07:54.974515 [info ] [MainThread]: Done.
[0m23:07:54.975040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc08e94f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc08f1910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7facc12125e0>]}
[0m23:07:54.975358 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 23:09:40.464312 | a86822e2-1202-462a-903c-cd9f841a268f ==============================
[0m23:09:40.464312 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:09:40.468306 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'parse_only': False, 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m23:09:40.468707 [debug] [MainThread]: Tracking: tracking
[0m23:09:40.512886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ad658040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ad658610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ad6583a0>]}
[0m23:09:40.698898 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m23:09:40.699453 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/fact_trips.sql
[0m23:09:40.699712 [debug] [MainThread]: Partial parsing: added file: taxi_rides_ny://models/core/dm_monthly_zone_revenue.sql
[0m23:09:40.716792 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m23:09:40.730697 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m23:09:40.747961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a86822e2-1202-462a-903c-cd9f841a268f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ad992820>]}
[0m23:09:40.761311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a86822e2-1202-462a-903c-cd9f841a268f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ad968fa0>]}
[0m23:09:40.761769 [info ] [MainThread]: Found 5 models, 10 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 2 sources, 0 exposures, 0 metrics
[0m23:09:40.762092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a86822e2-1202-462a-903c-cd9f841a268f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ad968c40>]}
[0m23:09:40.763949 [info ] [MainThread]: 
[0m23:09:40.765564 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:09:40.767444 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m23:09:40.782777 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:09:41.499761 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m23:09:41.514403 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:09:41.518889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a86822e2-1202-462a-903c-cd9f841a268f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ad9f9490>]}
[0m23:09:41.519578 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:09:41.519865 [info ] [MainThread]: 
[0m23:09:41.528460 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m23:09:41.528859 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:09:41.529626 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m23:09:41.529988 [debug] [Thread-3  ]: Began running node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:09:41.530685 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m23:09:41.530925 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_green_tripdata)
[0m23:09:41.531428 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'seed.taxi_rides_ny.taxi_zone_lookup'
[0m23:09:41.531689 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:09:41.531922 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m23:09:41.550811 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m23:09:41.532127 [debug] [Thread-3  ]: Began compiling node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:09:41.555049 [debug] [Thread-3  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (compile): 2023-02-19 23:09:41.552505 => 2023-02-19 23:09:41.554933
[0m23:09:41.555402 [debug] [Thread-3  ]: Began executing node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:09:41.555644 [debug] [Thread-3  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (execute): 2023-02-19 23:09:41.555573 => 2023-02-19 23:09:41.555597
[0m23:09:41.538358 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m23:09:41.616927 [debug] [Thread-3  ]: Finished running node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:09:41.618350 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 23:09:41.545949 => 2023-02-19 23:09:41.618248
[0m23:09:41.618999 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.dim_zones
[0m23:09:41.619287 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m23:09:41.619982 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m23:09:41.620274 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 23:09:41.620183 => 2023-02-19 23:09:41.620194
[0m23:09:41.620511 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m23:09:41.621298 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m23:09:41.624231 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m23:09:41.624945 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 23:09:41.532369 => 2023-02-19 23:09:41.624838
[0m23:09:41.625629 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:09:41.625916 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:09:41.626183 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:09:41.626935 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854'
[0m23:09:41.627514 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b'
[0m23:09:41.627797 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 23:09:41.627715 => 2023-02-19 23:09:41.627726
[0m23:09:41.628186 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:09:41.628434 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b)
[0m23:09:41.628701 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-19 23:09:41.621498 => 2023-02-19 23:09:41.628628
[0m23:09:41.629304 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:09:41.641373 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:09:41.642290 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854"
[0m23:09:41.642710 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m23:09:41.643114 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:09:41.652356 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b"
[0m23:09:41.652945 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-19 23:09:41.652831 => 2023-02-19 23:09:41.652847
[0m23:09:41.653642 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22'
[0m23:09:41.654721 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m23:09:41.655115 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:09:41.655717 [debug] [Thread-4  ]: Began running node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:09:41.655931 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854 (compile): 2023-02-19 23:09:41.629523 => 2023-02-19 23:09:41.655889
[0m23:09:41.664642 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22"
[0m23:09:41.665392 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e'
[0m23:09:41.665756 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b (compile): 2023-02-19 23:09:41.643296 => 2023-02-19 23:09:41.665655
[0m23:09:41.666020 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:09:41.666510 [debug] [Thread-4  ]: Began compiling node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:09:41.666876 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:09:41.667220 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854 (execute): 2023-02-19 23:09:41.667130 => 2023-02-19 23:09:41.667143
[0m23:09:41.667541 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22 (compile): 2023-02-19 23:09:41.656275 => 2023-02-19 23:09:41.667464
[0m23:09:41.672847 [debug] [Thread-4  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e"
[0m23:09:41.673303 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b (execute): 2023-02-19 23:09:41.673178 => 2023-02-19 23:09:41.673220
[0m23:09:41.673975 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:09:41.674266 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:09:41.674999 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:09:41.675409 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:09:41.675883 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22 (execute): 2023-02-19 23:09:41.675797 => 2023-02-19 23:09:41.675808
[0m23:09:41.676408 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:09:41.676703 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e (compile): 2023-02-19 23:09:41.667677 => 2023-02-19 23:09:41.676596
[0m23:09:41.677296 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182'
[0m23:09:41.678032 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:09:41.678659 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2'
[0m23:09:41.679080 [debug] [Thread-4  ]: Began executing node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:09:41.679327 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:09:41.679667 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:09:41.679850 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2)
[0m23:09:41.680217 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e (execute): 2023-02-19 23:09:41.680165 => 2023-02-19 23:09:41.680175
[0m23:09:41.688526 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182"
[0m23:09:41.689228 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c'
[0m23:09:41.689599 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:09:41.690131 [debug] [Thread-4  ]: Finished running node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:09:41.690539 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:09:41.695693 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2"
[0m23:09:41.696203 [debug] [Thread-4  ]: Began running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:09:41.700525 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c"
[0m23:09:41.701001 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182 (compile): 2023-02-19 23:09:41.680406 => 2023-02-19 23:09:41.700907
[0m23:09:41.701793 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f'
[0m23:09:41.702391 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:09:41.702807 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2 (compile): 2023-02-19 23:09:41.690773 => 2023-02-19 23:09:41.702714
[0m23:09:41.703150 [debug] [Thread-4  ]: Began compiling node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:09:41.703342 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c (compile): 2023-02-19 23:09:41.696421 => 2023-02-19 23:09:41.703270
[0m23:09:41.703608 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182 (execute): 2023-02-19 23:09:41.703544 => 2023-02-19 23:09:41.703554
[0m23:09:41.703850 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:09:41.709400 [debug] [Thread-4  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f"
[0m23:09:41.709791 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:09:41.710564 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:09:41.710831 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2 (execute): 2023-02-19 23:09:41.710766 => 2023-02-19 23:09:41.710774
[0m23:09:41.711206 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c (execute): 2023-02-19 23:09:41.711145 => 2023-02-19 23:09:41.711156
[0m23:09:41.711770 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:09:41.712330 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f (compile): 2023-02-19 23:09:41.704017 => 2023-02-19 23:09:41.712249
[0m23:09:41.713006 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:09:41.713879 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:09:41.714599 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631'
[0m23:09:41.714924 [debug] [Thread-4  ]: Began executing node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:09:41.715280 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:09:41.715785 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.fact_trips
[0m23:09:41.716219 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:09:41.716530 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f (execute): 2023-02-19 23:09:41.716444 => 2023-02-19 23:09:41.716454
[0m23:09:41.717149 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82'
[0m23:09:41.717659 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m23:09:41.723795 [debug] [Thread-4  ]: Finished running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:09:41.724609 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631"
[0m23:09:41.725017 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82)
[0m23:09:41.725369 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m23:09:41.725956 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:09:41.729685 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m23:09:41.735307 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82"
[0m23:09:41.735706 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631 (compile): 2023-02-19 23:09:41.717831 => 2023-02-19 23:09:41.735599
[0m23:09:41.736274 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:09:41.736699 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631 (execute): 2023-02-19 23:09:41.736592 => 2023-02-19 23:09:41.736609
[0m23:09:41.737412 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:09:41.738036 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82 (compile): 2023-02-19 23:09:41.730034 => 2023-02-19 23:09:41.737955
[0m23:09:41.738373 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:09:41.738581 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82 (execute): 2023-02-19 23:09:41.738537 => 2023-02-19 23:09:41.738545
[0m23:09:41.739138 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:09:41.739655 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-19 23:09:41.726167 => 2023-02-19 23:09:41.739610
[0m23:09:41.739915 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m23:09:41.740154 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-19 23:09:41.740071 => 2023-02-19 23:09:41.740077
[0m23:09:41.740700 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m23:09:41.741355 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:09:41.741915 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dm_monthly_zone_revenue'
[0m23:09:41.742184 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:09:41.745100 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.dm_monthly_zone_revenue"
[0m23:09:41.746020 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dm_monthly_zone_revenue (compile): 2023-02-19 23:09:41.742353 => 2023-02-19 23:09:41.745949
[0m23:09:41.746323 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:09:41.746512 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dm_monthly_zone_revenue (execute): 2023-02-19 23:09:41.746465 => 2023-02-19 23:09:41.746474
[0m23:09:41.747013 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:09:41.748303 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:09:41.748599 [debug] [MainThread]: Connection 'test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82' was left open.
[0m23:09:41.748860 [debug] [MainThread]: On test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82: Close
[0m23:09:41.750694 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was properly closed.
[0m23:09:41.750933 [debug] [MainThread]: Connection 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631' was properly closed.
[0m23:09:41.751085 [debug] [MainThread]: Connection 'model.taxi_rides_ny.dm_monthly_zone_revenue' was properly closed.
[0m23:09:41.751789 [debug] [MainThread]: Command end result
[0m23:09:41.763807 [info ] [MainThread]: Done.
[0m23:09:41.764286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ab42f820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ae268ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc4ae2584c0>]}
[0m23:09:41.765178 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 23:47:03.427012 | 5fec79d2-3d01-4583-b0b7-ca822f037e6b ==============================
[0m23:47:03.427012 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:47:03.430373 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'parse_only': False, 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m23:47:03.430813 [debug] [MainThread]: Tracking: tracking
[0m23:47:03.463290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950ce72c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950ce68520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950ce682b0>]}
[0m23:47:03.508858 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m23:47:03.509376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5fec79d2-3d01-4583-b0b7-ca822f037e6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950ce0a8b0>]}
[0m23:47:04.835866 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m23:47:04.854275 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m23:47:04.856452 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m23:47:04.863874 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m23:47:04.865747 [debug] [MainThread]: 1603: static parser failed on staging/stg_fhv_tripdata.sql
[0m23:47:04.872137 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_fhv_tripdata.sql
[0m23:47:04.875194 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m23:47:04.879454 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips_fhv.sql
[0m23:47:04.883137 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m23:47:04.886750 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m23:47:05.141769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5fec79d2-3d01-4583-b0b7-ca822f037e6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950d2f7820>]}
[0m23:47:05.157991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5fec79d2-3d01-4583-b0b7-ca822f037e6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950cf24f70>]}
[0m23:47:05.158508 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m23:47:05.158880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fec79d2-3d01-4583-b0b7-ca822f037e6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950cf60a00>]}
[0m23:47:05.161604 [info ] [MainThread]: 
[0m23:47:05.163916 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:47:05.165551 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m23:47:05.180182 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:47:05.821776 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m23:47:05.839393 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:47:05.845080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fec79d2-3d01-4583-b0b7-ca822f037e6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950d2f7c10>]}
[0m23:47:05.846160 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:47:05.846783 [info ] [MainThread]: 
[0m23:47:05.857773 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:47:05.858290 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m23:47:05.859493 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m23:47:05.859935 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:47:05.860328 [debug] [Thread-4  ]: Began running node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:47:05.865095 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'seed.taxi_rides_ny.taxi_zone_lookup'
[0m23:47:05.865780 [debug] [Thread-4  ]: Began compiling node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:47:05.868793 [debug] [Thread-4  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (compile): 2023-02-19 23:47:05.866135 => 2023-02-19 23:47:05.868665
[0m23:47:05.869225 [debug] [Thread-4  ]: Began executing node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:47:05.869701 [debug] [Thread-4  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (execute): 2023-02-19 23:47:05.869599 => 2023-02-19 23:47:05.869624
[0m23:47:05.871987 [debug] [Thread-4  ]: Finished running node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:47:05.861449 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m23:47:05.873804 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m23:47:05.862762 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m23:47:05.883251 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:47:05.879950 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m23:47:05.861859 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_fhv_tripdata)
[0m23:47:05.893329 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:47:05.889586 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m23:47:05.899970 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m23:47:05.906782 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-19 23:47:05.893613 => 2023-02-19 23:47:05.906654
[0m23:47:05.909487 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:47:05.909880 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-19 23:47:05.909791 => 2023-02-19 23:47:05.909807
[0m23:47:05.910749 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:47:05.911201 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m23:47:05.912129 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m23:47:05.912435 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m23:47:05.912749 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m23:47:05.918609 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m23:47:05.923843 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 23:47:05.883620 => 2023-02-19 23:47:05.923719
[0m23:47:05.924256 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:47:05.924561 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 23:47:05.924483 => 2023-02-19 23:47:05.924498
[0m23:47:05.925305 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:47:05.925927 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 23:47:05.874140 => 2023-02-19 23:47:05.925844
[0m23:47:05.926263 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m23:47:05.926529 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 23:47:05.926465 => 2023-02-19 23:47:05.926475
[0m23:47:05.927356 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m23:47:05.928823 [debug] [Thread-4  ]: Began running node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:47:05.929506 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:47:05.930619 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854'
[0m23:47:05.931248 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:47:05.932175 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2'
[0m23:47:05.932731 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-19 23:47:05.912944 => 2023-02-19 23:47:05.932599
[0m23:47:05.933070 [debug] [Thread-4  ]: Began compiling node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:47:05.933796 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b'
[0m23:47:05.941881 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:47:05.934181 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:47:05.941453 [debug] [Thread-4  ]: Writing injected SQL for node "test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854"
[0m23:47:05.954309 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b"
[0m23:47:05.934510 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m23:47:05.961441 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2"
[0m23:47:05.962079 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-19 23:47:05.961973 => 2023-02-19 23:47:05.961993
[0m23:47:05.963204 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m23:47:05.963748 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:47:05.964649 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c'
[0m23:47:05.964947 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c)
[0m23:47:05.965403 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:47:05.971659 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854 (compile): 2023-02-19 23:47:05.934738 => 2023-02-19 23:47:05.971560
[0m23:47:05.971994 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c"
[0m23:47:05.972252 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2 (compile): 2023-02-19 23:47:05.954738 => 2023-02-19 23:47:05.972193
[0m23:47:05.972500 [debug] [Thread-4  ]: Began executing node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:47:05.972970 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:47:05.973272 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854 (execute): 2023-02-19 23:47:05.973203 => 2023-02-19 23:47:05.973217
[0m23:47:05.973681 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b (compile): 2023-02-19 23:47:05.942105 => 2023-02-19 23:47:05.973617
[0m23:47:05.973991 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2 (execute): 2023-02-19 23:47:05.973915 => 2023-02-19 23:47:05.973929
[0m23:47:05.974422 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c (compile): 2023-02-19 23:47:05.965825 => 2023-02-19 23:47:05.974354
[0m23:47:05.975145 [debug] [Thread-4  ]: Finished running node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:47:05.975446 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:47:05.976139 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:47:05.976418 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:47:05.976808 [debug] [Thread-4  ]: Began running node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:47:05.977145 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b (execute): 2023-02-19 23:47:05.977076 => 2023-02-19 23:47:05.977088
[0m23:47:05.977684 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:47:05.978025 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c (execute): 2023-02-19 23:47:05.977963 => 2023-02-19 23:47:05.977973
[0m23:47:05.978623 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22'
[0m23:47:05.979298 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:47:05.979865 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e'
[0m23:47:05.980505 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:47:05.980773 [debug] [Thread-4  ]: Began compiling node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:47:05.981172 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:47:05.981535 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:47:05.981852 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:47:05.989011 [debug] [Thread-4  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22"
[0m23:47:05.989754 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f'
[0m23:47:05.997985 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e"
[0m23:47:05.998697 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631'
[0m23:47:05.999570 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:47:06.000245 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631)
[0m23:47:06.000600 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22 (compile): 2023-02-19 23:47:05.982050 => 2023-02-19 23:47:06.000510
[0m23:47:06.007485 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f"
[0m23:47:06.007921 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:47:06.008162 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e (compile): 2023-02-19 23:47:05.990032 => 2023-02-19 23:47:06.008097
[0m23:47:06.008437 [debug] [Thread-4  ]: Began executing node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:47:06.015577 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631"
[0m23:47:06.016050 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:47:06.016378 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22 (execute): 2023-02-19 23:47:06.016302 => 2023-02-19 23:47:06.016316
[0m23:47:06.016653 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f (compile): 2023-02-19 23:47:06.000869 => 2023-02-19 23:47:06.016576
[0m23:47:06.017225 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e (execute): 2023-02-19 23:47:06.017133 => 2023-02-19 23:47:06.017148
[0m23:47:06.018047 [debug] [Thread-4  ]: Finished running node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:47:06.018412 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:47:06.019251 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:47:06.019568 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631 (compile): 2023-02-19 23:47:06.008809 => 2023-02-19 23:47:06.019491
[0m23:47:06.019926 [debug] [Thread-4  ]: Began running node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:47:06.020334 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f (execute): 2023-02-19 23:47:06.020259 => 2023-02-19 23:47:06.020272
[0m23:47:06.020715 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:47:06.021116 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:47:06.021735 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182'
[0m23:47:06.022439 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:47:06.023012 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82'
[0m23:47:06.023283 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631 (execute): 2023-02-19 23:47:06.023218 => 2023-02-19 23:47:06.023229
[0m23:47:06.023563 [debug] [Thread-4  ]: Began compiling node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:47:06.023950 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.fact_trips
[0m23:47:06.024284 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:47:06.025080 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:47:06.033316 [debug] [Thread-4  ]: Writing injected SQL for node "test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182"
[0m23:47:06.034187 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m23:47:06.039626 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82"
[0m23:47:06.040318 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m23:47:06.040848 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m23:47:06.041681 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m23:47:06.046193 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m23:47:06.046598 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips_fhv)
[0m23:47:06.046944 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182 (compile): 2023-02-19 23:47:06.025375 => 2023-02-19 23:47:06.046866
[0m23:47:06.047215 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82 (compile): 2023-02-19 23:47:06.034437 => 2023-02-19 23:47:06.047149
[0m23:47:06.047541 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m23:47:06.047861 [debug] [Thread-4  ]: Began executing node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:47:06.048228 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:47:06.052608 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m23:47:06.052977 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-19 23:47:06.042015 => 2023-02-19 23:47:06.052891
[0m23:47:06.053236 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182 (execute): 2023-02-19 23:47:06.053165 => 2023-02-19 23:47:06.053180
[0m23:47:06.053529 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82 (execute): 2023-02-19 23:47:06.053466 => 2023-02-19 23:47:06.053477
[0m23:47:06.053901 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m23:47:06.054801 [debug] [Thread-4  ]: Finished running node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:47:06.055511 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:47:06.055783 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-19 23:47:06.055721 => 2023-02-19 23:47:06.055729
[0m23:47:06.056018 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-19 23:47:06.048495 => 2023-02-19 23:47:06.055952
[0m23:47:06.056971 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m23:47:06.057261 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m23:47:06.057729 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-19 23:47:06.057672 => 2023-02-19 23:47:06.057681
[0m23:47:06.058026 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:47:06.058667 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m23:47:06.059271 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dm_monthly_zone_revenue'
[0m23:47:06.059830 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:47:06.065177 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.dm_monthly_zone_revenue"
[0m23:47:06.066561 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dm_monthly_zone_revenue (compile): 2023-02-19 23:47:06.060049 => 2023-02-19 23:47:06.066403
[0m23:47:06.067036 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:47:06.067346 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dm_monthly_zone_revenue (execute): 2023-02-19 23:47:06.067262 => 2023-02-19 23:47:06.067277
[0m23:47:06.068306 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:47:06.069798 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m23:47:06.070743 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41'
[0m23:47:06.071068 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m23:47:06.129931 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41"
[0m23:47:06.130992 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41 (compile): 2023-02-19 23:47:06.071251 => 2023-02-19 23:47:06.130875
[0m23:47:06.131410 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m23:47:06.131759 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41 (execute): 2023-02-19 23:47:06.131673 => 2023-02-19 23:47:06.131689
[0m23:47:06.132592 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m23:47:06.133885 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:47:06.134244 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was left open.
[0m23:47:06.134580 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips_fhv: Close
[0m23:47:06.138356 [debug] [MainThread]: Connection 'test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41' was properly closed.
[0m23:47:06.138769 [debug] [MainThread]: Connection 'test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82' was properly closed.
[0m23:47:06.139018 [debug] [MainThread]: Connection 'model.taxi_rides_ny.dm_monthly_zone_revenue' was properly closed.
[0m23:47:06.140327 [debug] [MainThread]: Command end result
[0m23:47:06.156011 [info ] [MainThread]: Done.
[0m23:47:06.156582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950db53be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950d31f430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950dbc4a90>]}
[0m23:47:06.156999 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 23:48:21.028511 | 57f62a8b-38a3-4ad7-a1c4-e41ce37ad2e3 ==============================
[0m23:48:21.028511 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:48:21.034014 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'parse_only': False, 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m23:48:21.034617 [debug] [MainThread]: Tracking: tracking
[0m23:48:21.077746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a1e59100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a1e59670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a1e59400>]}
[0m23:48:21.469007 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:48:21.470191 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_fhv_tripdata.sql
[0m23:48:21.503224 [debug] [MainThread]: 1603: static parser failed on staging/stg_fhv_tripdata.sql
[0m23:48:21.532290 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_fhv_tripdata.sql
[0m23:48:21.575552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '57f62a8b-38a3-4ad7-a1c4-e41ce37ad2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a227b310>]}
[0m23:48:21.598642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '57f62a8b-38a3-4ad7-a1c4-e41ce37ad2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a1e597f0>]}
[0m23:48:21.599427 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m23:48:21.600023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57f62a8b-38a3-4ad7-a1c4-e41ce37ad2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a21eb6a0>]}
[0m23:48:21.603871 [info ] [MainThread]: 
[0m23:48:21.607926 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:48:21.610478 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m23:48:21.633409 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:48:23.793813 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m23:48:23.813592 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:48:23.820835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57f62a8b-38a3-4ad7-a1c4-e41ce37ad2e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a21b8df0>]}
[0m23:48:23.822667 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:48:23.823395 [info ] [MainThread]: 
[0m23:48:23.837104 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:48:23.837838 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m23:48:23.838881 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m23:48:23.839339 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:48:23.840032 [debug] [Thread-4  ]: Began running node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:48:23.841149 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m23:48:23.841622 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_fhv_tripdata)
[0m23:48:23.843482 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m23:48:23.845296 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'seed.taxi_rides_ny.taxi_zone_lookup'
[0m23:48:23.845960 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m23:48:23.846462 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:48:23.846905 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:48:23.847425 [debug] [Thread-4  ]: Began compiling node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:48:23.859792 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m23:48:23.867720 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m23:48:23.878398 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m23:48:23.882667 [debug] [Thread-4  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (compile): 2023-02-19 23:48:23.878852 => 2023-02-19 23:48:23.882395
[0m23:48:23.884620 [debug] [Thread-4  ]: Began executing node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:48:23.885863 [debug] [Thread-4  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (execute): 2023-02-19 23:48:23.885672 => 2023-02-19 23:48:23.885721
[0m23:48:23.889003 [debug] [Thread-4  ]: Finished running node seed.taxi_rides_ny.taxi_zone_lookup
[0m23:48:23.890445 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.dim_zones
[0m23:48:23.892419 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m23:48:23.893233 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 23:48:23.847837 => 2023-02-19 23:48:23.893073
[0m23:48:23.893751 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 23:48:23.868259 => 2023-02-19 23:48:23.893651
[0m23:48:23.894251 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m23:48:23.894675 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-19 23:48:23.860235 => 2023-02-19 23:48:23.894582
[0m23:48:23.895154 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m23:48:23.895614 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:48:23.904904 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m23:48:23.905542 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:48:23.906390 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 23:48:23.906050 => 2023-02-19 23:48:23.906122
[0m23:48:23.907452 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 23:48:23.907017 => 2023-02-19 23:48:23.907119
[0m23:48:23.908415 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-19 23:48:23.908258 => 2023-02-19 23:48:23.908286
[0m23:48:23.909943 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m23:48:23.911150 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:48:23.912572 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:48:23.913521 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-19 23:48:23.896001 => 2023-02-19 23:48:23.913391
[0m23:48:23.914477 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:48:23.915291 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:48:23.916730 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:48:23.917429 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m23:48:23.918591 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854'
[0m23:48:23.919602 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b'
[0m23:48:23.920673 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22'
[0m23:48:23.921214 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-19 23:48:23.921072 => 2023-02-19 23:48:23.921098
[0m23:48:23.921725 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:48:23.922230 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:48:23.922688 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22)
[0m23:48:23.923967 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m23:48:23.968709 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:48:23.969359 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854"
[0m23:48:23.973145 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b"
[0m23:48:23.974105 [debug] [Thread-4  ]: Began running node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:48:24.000219 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22"
[0m23:48:24.001757 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e'
[0m23:48:24.002395 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854 (compile): 2023-02-19 23:48:23.924403 => 2023-02-19 23:48:24.002240
[0m23:48:24.003058 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b (compile): 2023-02-19 23:48:23.941157 => 2023-02-19 23:48:24.002867
[0m23:48:24.003961 [debug] [Thread-4  ]: Began compiling node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:48:24.004844 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:48:24.006087 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:48:24.020278 [debug] [Thread-4  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e"
[0m23:48:24.021053 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22 (compile): 2023-02-19 23:48:23.974768 => 2023-02-19 23:48:24.020851
[0m23:48:24.021620 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854 (execute): 2023-02-19 23:48:24.021455 => 2023-02-19 23:48:24.021486
[0m23:48:24.022352 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b (execute): 2023-02-19 23:48:24.022190 => 2023-02-19 23:48:24.022217
[0m23:48:24.023663 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:48:24.025056 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m23:48:24.026261 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m23:48:24.026931 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22 (execute): 2023-02-19 23:48:24.026784 => 2023-02-19 23:48:24.026808
[0m23:48:24.027500 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e (compile): 2023-02-19 23:48:24.006627 => 2023-02-19 23:48:24.027376
[0m23:48:24.028166 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:48:24.029059 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:48:24.030773 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m23:48:24.031376 [debug] [Thread-4  ]: Began executing node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:48:24.032450 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182'
[0m23:48:24.033415 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2'
[0m23:48:24.034016 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:48:24.034803 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e (execute): 2023-02-19 23:48:24.034669 => 2023-02-19 23:48:24.034693
[0m23:48:24.035639 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:48:24.036186 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:48:24.037286 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c'
[0m23:48:24.079027 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c)
[0m23:48:24.079636 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:48:24.038482 [debug] [Thread-4  ]: Finished running node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m23:48:24.096199 [debug] [Thread-4  ]: Began running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:48:24.097606 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f'
[0m23:48:24.098890 [debug] [Thread-4  ]: Began compiling node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:48:24.094380 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c"
[0m23:48:24.066519 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182"
[0m23:48:24.072405 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2"
[0m23:48:24.139040 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2 (compile): 2023-02-19 23:48:24.049600 => 2023-02-19 23:48:24.138738
[0m23:48:24.140421 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:48:24.141423 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182 (compile): 2023-02-19 23:48:24.038838 => 2023-02-19 23:48:24.140988
[0m23:48:24.142177 [debug] [Thread-4  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f"
[0m23:48:24.143125 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2 (execute): 2023-02-19 23:48:24.142918 => 2023-02-19 23:48:24.142945
[0m23:48:24.143572 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c (compile): 2023-02-19 23:48:24.080211 => 2023-02-19 23:48:24.143473
[0m23:48:24.144088 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:48:24.145808 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m23:48:24.146536 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:48:24.147106 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f (compile): 2023-02-19 23:48:24.099331 => 2023-02-19 23:48:24.146977
[0m23:48:24.147524 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182 (execute): 2023-02-19 23:48:24.147429 => 2023-02-19 23:48:24.147445
[0m23:48:24.148359 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:48:24.149145 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c (execute): 2023-02-19 23:48:24.149014 => 2023-02-19 23:48:24.149035
[0m23:48:24.149692 [debug] [Thread-4  ]: Began executing node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:48:24.151337 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m23:48:24.152359 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631'
[0m23:48:24.153918 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m23:48:24.154470 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f (execute): 2023-02-19 23:48:24.154351 => 2023-02-19 23:48:24.154369
[0m23:48:24.155063 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:48:24.155669 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:48:24.157119 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m23:48:24.159389 [debug] [Thread-4  ]: Finished running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m23:48:24.160564 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82'
[0m23:48:24.175220 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631"
[0m23:48:24.176940 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m23:48:24.177767 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m23:48:24.178581 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:48:24.179812 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m23:48:24.183163 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m23:48:24.183793 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631 (compile): 2023-02-19 23:48:24.160981 => 2023-02-19 23:48:24.183585
[0m23:48:24.190722 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m23:48:24.195111 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82"
[0m23:48:24.196230 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m23:48:24.196937 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:48:24.205185 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m23:48:24.213054 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631 (execute): 2023-02-19 23:48:24.212687 => 2023-02-19 23:48:24.212842
[0m23:48:24.215894 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m23:48:24.216562 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82 (compile): 2023-02-19 23:48:24.184214 => 2023-02-19 23:48:24.216412
[0m23:48:24.220102 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m23:48:24.221199 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:48:24.222736 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82 (execute): 2023-02-19 23:48:24.222469 => 2023-02-19 23:48:24.222506
[0m23:48:24.224466 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m23:48:24.225804 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-19 23:48:24.197353 => 2023-02-19 23:48:24.225643
[0m23:48:24.226730 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m23:48:24.227318 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-19 23:48:24.227184 => 2023-02-19 23:48:24.227206
[0m23:48:24.227857 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-19 23:48:24.206451 => 2023-02-19 23:48:24.227728
[0m23:48:24.229615 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m23:48:24.230609 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m23:48:24.232036 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:48:24.232502 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-19 23:48:24.232384 => 2023-02-19 23:48:24.232411
[0m23:48:24.233565 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dm_monthly_zone_revenue'
[0m23:48:24.234727 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m23:48:24.235198 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:48:24.246099 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.dm_monthly_zone_revenue"
[0m23:48:24.249636 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.dm_monthly_zone_revenue (compile): 2023-02-19 23:48:24.235892 => 2023-02-19 23:48:24.249459
[0m23:48:24.250291 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:48:24.250743 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.dm_monthly_zone_revenue (execute): 2023-02-19 23:48:24.250635 => 2023-02-19 23:48:24.250654
[0m23:48:24.252045 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:48:24.254395 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m23:48:24.255749 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41'
[0m23:48:24.256267 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41)
[0m23:48:24.256775 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m23:48:24.268292 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41"
[0m23:48:24.271464 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41 (compile): 2023-02-19 23:48:24.257279 => 2023-02-19 23:48:24.271218
[0m23:48:24.272284 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m23:48:24.273132 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41 (execute): 2023-02-19 23:48:24.272947 => 2023-02-19 23:48:24.272988
[0m23:48:24.274660 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m23:48:24.278703 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:48:24.279247 [debug] [MainThread]: Connection 'test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41' was left open.
[0m23:48:24.279725 [debug] [MainThread]: On test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41: Close
[0m23:48:24.284178 [debug] [MainThread]: Connection 'test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82' was properly closed.
[0m23:48:24.285309 [debug] [MainThread]: Connection 'model.taxi_rides_ny.dm_monthly_zone_revenue' was properly closed.
[0m23:48:24.285952 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was properly closed.
[0m23:48:24.288307 [debug] [MainThread]: Command end result
[0m23:48:24.312444 [info ] [MainThread]: Done.
[0m23:48:24.313333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a2c41df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a2204c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f82a2b70c10>]}
[0m23:48:24.314078 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 23:49:03.202871 | b1fec1ce-93df-4f5d-93ed-ed806d1d1e17 ==============================
[0m23:49:03.202871 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:49:03.205493 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m23:49:03.205849 [debug] [MainThread]: Tracking: tracking
[0m23:49:03.239675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e30e75c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e30e6b520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e30e6b2b0>]}
[0m23:49:03.417963 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:49:03.418379 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:49:03.428917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b1fec1ce-93df-4f5d-93ed-ed806d1d1e17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e310a8910>]}
[0m23:49:03.443748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b1fec1ce-93df-4f5d-93ed-ed806d1d1e17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e30f94100>]}
[0m23:49:03.444234 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m23:49:03.444608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1fec1ce-93df-4f5d-93ed-ed806d1d1e17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e30f94130>]}
[0m23:49:03.446776 [info ] [MainThread]: 
[0m23:49:03.448645 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:49:03.450500 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m23:49:03.464876 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:49:04.111842 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m23:49:04.122238 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:04.125882 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m23:49:04.126327 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m23:49:04.133009 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m23:49:04.146018 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:04.149038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1fec1ce-93df-4f5d-93ed-ed806d1d1e17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e30f94130>]}
[0m23:49:04.149866 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:49:04.150203 [info ] [MainThread]: 
[0m23:49:04.155812 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m23:49:04.156332 [info ] [Thread-1  ]: 1 of 7 START sql table model sandbox.dim_zones ................................. [RUN]
[0m23:49:04.157051 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m23:49:04.157268 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m23:49:04.157510 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m23:49:04.162399 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m23:49:04.162864 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:49:04.163420 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m23:49:04.163709 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:49:04.164168 [info ] [Thread-2  ]: 2 of 7 START sql view model sandbox.stg_fhv_tripdata ........................... [RUN]
[0m23:49:04.164679 [info ] [Thread-3  ]: 3 of 7 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m23:49:04.165355 [info ] [Thread-4  ]: 4 of 7 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m23:49:04.166527 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m23:49:04.167448 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m23:49:04.167791 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-19 23:49:04.157693 => 2023-02-19 23:49:04.167682
[0m23:49:04.168590 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m23:49:04.169043 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:49:04.169479 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m23:49:04.169998 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m23:49:04.170428 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:49:04.175309 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m23:49:04.181593 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m23:49:04.205528 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m23:49:04.216554 [debug] [Thread-1  ]: Creating new relation dim_zones
[0m23:49:04.227853 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-19 23:49:04.170762 => 2023-02-19 23:49:04.227728
[0m23:49:04.228357 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:49:04.235118 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 23:49:04.200020 => 2023-02-19 23:49:04.235020
[0m23:49:04.252752 [debug] [Thread-2  ]: Creating new relation stg_fhv_tripdata
[0m23:49:04.258398 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:49:04.265053 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 23:49:04.175625 => 2023-02-19 23:49:04.264944
[0m23:49:04.267022 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        


select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone,'Boro','Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        ...
[0m23:49:04.321268 [debug] [Thread-2  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m23:49:04.332201 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m23:49:04.336114 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m23:49:04.342671 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m23:49:04.343283 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:49:04.345740 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:49:04.348762 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:49:04.369083 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        


select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone,'Boro','Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        
[0m23:49:04.390626 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-19 23:49:04.181959 => 2023-02-19 23:49:04.390507
[0m23:49:04.405563 [debug] [Thread-1  ]: Database Error in model dim_zones (models/core/dim_zones.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 60. DB::Exception: Table sandbox.taxi_zone_lookup doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m23:49:04.406053 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1fec1ce-93df-4f5d-93ed-ed806d1d1e17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e31b06100>]}
[0m23:49:04.406562 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model sandbox.dim_zones ........................ [[31mERROR[0m in 0.25s]
[0m23:49:04.407984 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m23:49:04.573700 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m23:49:04.576041 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m23:49:05.677089 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,
    dispatching_base_num as vendorid,

    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m23:49:05.685652 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 1.11 seconds
[0m23:49:05.691687 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 1.12 seconds
[0m23:49:05.699334 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m23:49:05.702250 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m23:49:05.704192 [debug] [Thread-2  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,
    dispatching_base_num as vendorid,

    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m23:49:05.704580 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-19 23:49:04.235343 => 2023-02-19 23:49:05.704491
[0m23:49:05.706075 [debug] [Thread-2  ]: Database Error in model stg_fhv_tripdata (models/staging/stg_fhv_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 47. DB::Exception: Missing columns: 'dropoff_datetime' 'sr_flag' while processing query: 'SELECT lower(hex(MD5(concat(ifNull(toString(dispatching_base_num AS vendorid), ''), '-', ifNull(toString(toDateTime(pickup_datetime) AS pickup_d
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_fhv_tripdata.sql
[0m23:49:05.706565 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1fec1ce-93df-4f5d-93ed-ed806d1d1e17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e31a812b0>]}
[0m23:49:05.707164 [error] [Thread-2  ]: 2 of 7 ERROR creating sql view model sandbox.stg_fhv_tripdata .................. [[31mERROR[0m in 1.54s]
[0m23:49:05.707652 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:49:05.716893 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:05.718668 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m23:49:05.719649 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:05.721243 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m23:49:05.733924 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:05.737770 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m23:49:05.739167 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:05.743321 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m23:49:05.754936 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:05.756693 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m23:49:05.757980 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:05.759456 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m23:49:05.770682 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:05.777420 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:05.824279 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m23:49:05.826640 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m23:49:05.839622 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:05.841117 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 23:49:04.337446 => 2023-02-19 23:49:05.841056
[0m23:49:05.841933 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1fec1ce-93df-4f5d-93ed-ed806d1d1e17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e31af2640>]}
[0m23:49:05.842506 [info ] [Thread-3  ]: 3 of 7 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 1.67s]
[0m23:49:05.842917 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m23:49:05.843774 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:05.845328 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 23:49:04.321534 => 2023-02-19 23:49:05.845244
[0m23:49:05.846162 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1fec1ce-93df-4f5d-93ed-ed806d1d1e17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e31ba1fa0>]}
[0m23:49:05.846690 [info ] [Thread-4  ]: 4 of 7 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 1.68s]
[0m23:49:05.847061 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:49:05.850263 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m23:49:05.850693 [info ] [Thread-1  ]: 5 of 7 SKIP relation sandbox.fact_trips ........................................ [[33mSKIP[0m]
[0m23:49:05.851121 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m23:49:05.851456 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m23:49:05.851749 [info ] [Thread-1  ]: 6 of 7 SKIP relation sandbox.fact_trips_fhv .................................... [[33mSKIP[0m]
[0m23:49:05.852118 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m23:49:05.856592 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:49:05.856977 [info ] [Thread-3  ]: 7 of 7 SKIP relation sandbox.dm_monthly_zone_revenue ........................... [[33mSKIP[0m]
[0m23:49:05.857313 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:49:05.866707 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:49:05.867353 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:49:05.867597 [debug] [MainThread]: Connection 'model.taxi_rides_ny.dim_zones' was left open.
[0m23:49:05.867836 [debug] [MainThread]: On model.taxi_rides_ny.dim_zones: Close
[0m23:49:05.870196 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_fhv_tripdata' was left open.
[0m23:49:05.870558 [debug] [MainThread]: On model.taxi_rides_ny.stg_fhv_tripdata: Close
[0m23:49:05.872717 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m23:49:05.873107 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m23:49:05.875244 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m23:49:05.875603 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m23:49:05.878648 [info ] [MainThread]: 
[0m23:49:05.879052 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 0 minutes and 2.43 seconds (2.43s).
[0m23:49:05.879641 [debug] [MainThread]: Command end result
[0m23:49:05.893338 [info ] [MainThread]: 
[0m23:49:05.893770 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m23:49:05.894069 [info ] [MainThread]: 
[0m23:49:05.894369 [error] [MainThread]: [33mDatabase Error in model dim_zones (models/core/dim_zones.sql)[0m
[0m23:49:05.894646 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m23:49:05.894893 [error] [MainThread]:    Code: 60. DB::Exception: Table sandbox.taxi_zone_lookup doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m23:49:05.895135 [info ] [MainThread]: 
[0m23:49:05.895402 [error] [MainThread]: [33mDatabase Error in model stg_fhv_tripdata (models/staging/stg_fhv_tripdata.sql)[0m
[0m23:49:05.895669 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m23:49:05.895937 [error] [MainThread]:    Code: 47. DB::Exception: Missing columns: 'dropoff_datetime' 'sr_flag' while processing query: 'SELECT lower(hex(MD5(concat(ifNull(toString(dispatching_base_num AS vendorid), ''), '-', ifNull(toString(toDateTime(pickup_datetime) AS pickup_d
[0m23:49:05.896219 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_fhv_tripdata.sql
[0m23:49:05.896536 [info ] [MainThread]: 
[0m23:49:05.896806 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=3 TOTAL=7
[0m23:49:05.897420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e310eecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e31a4ff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8e31a4ffa0>]}
[0m23:49:05.897800 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 23:54:43.894742 | e2fbe131-e6e8-442d-9131-d0c297f2e8a9 ==============================
[0m23:54:43.894742 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:54:43.899755 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m23:54:43.900196 [debug] [MainThread]: Tracking: tracking
[0m23:54:44.008500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e95e62b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e95f6d580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e95f6d310>]}
[0m23:54:44.218818 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m23:54:44.219670 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/dim_zones.sql
[0m23:54:44.220128 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips_fhv.sql
[0m23:54:44.220565 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_fhv_tripdata.sql
[0m23:54:44.245268 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m23:54:44.265609 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips_fhv.sql
[0m23:54:44.270264 [debug] [MainThread]: 1603: static parser failed on staging/stg_fhv_tripdata.sql
[0m23:54:44.277135 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_fhv_tripdata.sql
[0m23:54:44.310781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2fbe131-e6e8-442d-9131-d0c297f2e8a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e9623fd60>]}
[0m23:54:44.326994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2fbe131-e6e8-442d-9131-d0c297f2e8a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e961e4310>]}
[0m23:54:44.327562 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m23:54:44.328004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2fbe131-e6e8-442d-9131-d0c297f2e8a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e961e4190>]}
[0m23:54:44.330589 [info ] [MainThread]: 
[0m23:54:44.332810 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:54:44.335556 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m23:54:44.352071 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:54:45.049982 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m23:54:45.064570 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:54:45.068672 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m23:54:45.069145 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m23:54:45.076497 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m23:54:45.091590 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:54:45.095548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2fbe131-e6e8-442d-9131-d0c297f2e8a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e962281f0>]}
[0m23:54:45.096772 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:54:45.097511 [info ] [MainThread]: 
[0m23:54:45.106190 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m23:54:45.106729 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:54:45.107294 [info ] [Thread-1  ]: 1 of 7 START sql table model sandbox.dim_zones ................................. [RUN]
[0m23:54:45.107873 [info ] [Thread-2  ]: 2 of 7 START sql view model sandbox.stg_fhv_tripdata ........................... [RUN]
[0m23:54:45.108336 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m23:54:45.108929 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:54:45.109753 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m23:54:45.130182 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m23:54:45.131341 [info ] [Thread-3  ]: 3 of 7 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m23:54:45.131945 [info ] [Thread-4  ]: 4 of 7 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m23:54:45.132396 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m23:54:45.132766 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:54:45.133515 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m23:54:45.134277 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m23:54:45.134612 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m23:54:45.139801 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m23:54:45.140677 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m23:54:45.141148 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:54:45.145641 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m23:54:45.154767 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m23:54:45.155156 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-19 23:54:45.134847 => 2023-02-19 23:54:45.155048
[0m23:54:45.163320 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m23:54:45.164036 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:54:45.170980 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 23:54:45.146188 => 2023-02-19 23:54:45.170855
[0m23:54:45.182769 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-19 23:54:45.141470 => 2023-02-19 23:54:45.182597
[0m23:54:45.188561 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 23:54:45.155496 => 2023-02-19 23:54:45.188382
[0m23:54:45.189081 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m23:54:45.199400 [debug] [Thread-2  ]: Creating new relation stg_fhv_tripdata
[0m23:54:45.199931 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m23:54:45.200341 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:54:45.234190 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m23:54:45.237291 [debug] [Thread-2  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m23:54:45.249806 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m23:54:45.256500 [debug] [Thread-1  ]: Creating new relation dim_zones
[0m23:54:45.288844 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:54:45.289246 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        ...
[0m23:54:45.289678 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:54:45.289924 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:54:45.338379 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        
[0m23:54:45.338862 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-19 23:54:45.224274 => 2023-02-19 23:54:45.338768
[0m23:54:45.362386 [debug] [Thread-1  ]: Database Error in model dim_zones (models/core/dim_zones.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 60. DB::Exception: Table sandbox.taxi_zone_lookup doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m23:54:45.363207 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2fbe131-e6e8-442d-9131-d0c297f2e8a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e96a72850>]}
[0m23:54:45.364647 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model sandbox.dim_zones ........................ [[31mERROR[0m in 0.25s]
[0m23:54:45.367036 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m23:54:45.504629 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m23:54:45.506138 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m23:54:45.521578 [debug] [Thread-2  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m23:54:45.522027 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-19 23:54:45.165674 => 2023-02-19 23:54:45.521930
[0m23:54:45.523091 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m23:54:45.524059 [debug] [Thread-2  ]: Database Error in model stg_fhv_tripdata (models/staging/stg_fhv_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 47. DB::Exception: Missing columns: 'dropoff_datetime' 'SR_flag' while processing query: 'SELECT lower(hex(MD5(concat(ifNull(toString(dispatching_base_num AS vendorid), ''), '-', ifNull(toString(toDateTime(pickup_datetime) AS pickup_d
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_fhv_tripdata.sql
[0m23:54:45.524685 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2fbe131-e6e8-442d-9131-d0c297f2e8a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e96203820>]}
[0m23:54:45.525713 [error] [Thread-2  ]: 2 of 7 ERROR creating sql view model sandbox.stg_fhv_tripdata .................. [[31mERROR[0m in 0.39s]
[0m23:54:45.526238 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:54:45.529020 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m23:54:45.529479 [info ] [Thread-1  ]: 5 of 7 SKIP relation sandbox.fact_trips_fhv .................................... [[33mSKIP[0m]
[0m23:54:45.529912 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m23:54:45.530952 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:54:45.541455 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m23:54:45.547613 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:54:45.551428 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m23:54:45.553366 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:54:45.554870 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m23:54:45.571089 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:54:45.572965 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m23:54:45.576292 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:54:45.580256 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m23:54:45.595774 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:54:45.599983 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m23:54:45.606797 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:54:45.608362 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m23:54:45.619619 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:54:45.621260 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m23:54:45.622914 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:54:45.651881 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:54:45.665061 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m23:54:45.672314 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m23:54:45.686505 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:54:45.688115 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 23:54:45.244893 => 2023-02-19 23:54:45.688046
[0m23:54:45.688854 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2fbe131-e6e8-442d-9131-d0c297f2e8a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e96a723d0>]}
[0m23:54:45.689366 [info ] [Thread-4  ]: 4 of 7 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.55s]
[0m23:54:45.689767 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:54:45.700900 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:54:45.703303 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 23:54:45.200608 => 2023-02-19 23:54:45.703207
[0m23:54:45.707547 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2fbe131-e6e8-442d-9131-d0c297f2e8a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e96ab4ee0>]}
[0m23:54:45.710030 [info ] [Thread-3  ]: 3 of 7 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.57s]
[0m23:54:45.711294 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m23:54:45.712624 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m23:54:45.713067 [info ] [Thread-1  ]: 6 of 7 SKIP relation sandbox.fact_trips ........................................ [[33mSKIP[0m]
[0m23:54:45.713747 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m23:54:45.714629 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:54:45.715107 [info ] [Thread-4  ]: 7 of 7 SKIP relation sandbox.dm_monthly_zone_revenue ........................... [[33mSKIP[0m]
[0m23:54:45.715756 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:54:45.717718 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:54:45.718480 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:54:45.718818 [debug] [MainThread]: Connection 'model.taxi_rides_ny.dim_zones' was left open.
[0m23:54:45.719127 [debug] [MainThread]: On model.taxi_rides_ny.dim_zones: Close
[0m23:54:45.721520 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_fhv_tripdata' was left open.
[0m23:54:45.721913 [debug] [MainThread]: On model.taxi_rides_ny.stg_fhv_tripdata: Close
[0m23:54:45.724204 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m23:54:45.724634 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m23:54:45.727038 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m23:54:45.727607 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m23:54:45.731504 [info ] [MainThread]: 
[0m23:54:45.731983 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 0 minutes and 1.40 seconds (1.40s).
[0m23:54:45.732781 [debug] [MainThread]: Command end result
[0m23:54:45.746731 [info ] [MainThread]: 
[0m23:54:45.747227 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m23:54:45.747951 [info ] [MainThread]: 
[0m23:54:45.748457 [error] [MainThread]: [33mDatabase Error in model dim_zones (models/core/dim_zones.sql)[0m
[0m23:54:45.748880 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m23:54:45.749254 [error] [MainThread]:    Code: 60. DB::Exception: Table sandbox.taxi_zone_lookup doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m23:54:45.749554 [info ] [MainThread]: 
[0m23:54:45.749985 [error] [MainThread]: [33mDatabase Error in model stg_fhv_tripdata (models/staging/stg_fhv_tripdata.sql)[0m
[0m23:54:45.750324 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m23:54:45.750654 [error] [MainThread]:    Code: 47. DB::Exception: Missing columns: 'dropoff_datetime' 'SR_flag' while processing query: 'SELECT lower(hex(MD5(concat(ifNull(toString(dispatching_base_num AS vendorid), ''), '-', ifNull(toString(toDateTime(pickup_datetime) AS pickup_d
[0m23:54:45.750927 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_fhv_tripdata.sql
[0m23:54:45.751242 [info ] [MainThread]: 
[0m23:54:45.751576 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=3 TOTAL=7
[0m23:54:45.752020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e96c8b400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e96c8bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e96a2b220>]}
[0m23:54:45.752409 [debug] [MainThread]: Flushing usage events


============================== 2023-02-19 23:58:15.106023 | 6b24eef0-6cfd-4597-a128-fd5ab77651e5 ==============================
[0m23:58:15.106023 [info ] [MainThread]: Running with dbt=1.4.1
[0m23:58:15.111384 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m23:58:15.112052 [debug] [MainThread]: Tracking: tracking
[0m23:58:15.151198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e30676c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e3066e520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e3066e2b0>]}
[0m23:58:15.616024 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:58:15.616518 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:58:15.636876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b24eef0-6cfd-4597-a128-fd5ab77651e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e308a7910>]}
[0m23:58:15.671555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b24eef0-6cfd-4597-a128-fd5ab77651e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e3079d100>]}
[0m23:58:15.673606 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m23:58:15.675965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b24eef0-6cfd-4597-a128-fd5ab77651e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e3079d130>]}
[0m23:58:15.680603 [info ] [MainThread]: 
[0m23:58:15.686527 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:58:15.689585 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m23:58:15.714002 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:58:17.342904 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m23:58:17.359771 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:58:17.366280 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m23:58:17.366750 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m23:58:17.382230 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m23:58:17.398004 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:58:17.403215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b24eef0-6cfd-4597-a128-fd5ab77651e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e308dc1c0>]}
[0m23:58:17.404719 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:58:17.405388 [info ] [MainThread]: 
[0m23:58:17.415788 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m23:58:17.416515 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:58:17.417074 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m23:58:17.417965 [info ] [Thread-1  ]: 1 of 7 START sql table model sandbox.dim_zones ................................. [RUN]
[0m23:58:17.419456 [info ] [Thread-2  ]: 2 of 7 START sql view model sandbox.stg_fhv_tripdata ........................... [RUN]
[0m23:58:17.420567 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:58:17.421307 [info ] [Thread-3  ]: 3 of 7 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m23:58:17.422647 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m23:58:17.423883 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m23:58:17.424616 [info ] [Thread-4  ]: 4 of 7 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m23:58:17.425863 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m23:58:17.426386 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m23:58:17.426932 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:58:17.428619 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m23:58:17.429153 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m23:58:17.429614 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m23:58:17.438304 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m23:58:17.439006 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:58:17.448889 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m23:58:17.455090 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m23:58:17.463200 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m23:58:17.464113 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-19 23:58:17.429999 => 2023-02-19 23:58:17.463945
[0m23:58:17.465032 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:58:17.498997 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-19 23:58:17.439499 => 2023-02-19 23:58:17.498835
[0m23:58:17.506600 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-19 23:58:17.455809 => 2023-02-19 23:58:17.506443
[0m23:58:17.510299 [debug] [Thread-2  ]: Creating new relation stg_fhv_tripdata
[0m23:58:17.510793 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-19 23:58:17.449367 => 2023-02-19 23:58:17.510656
[0m23:58:17.511216 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m23:58:17.511781 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:58:17.518105 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m23:58:17.662729 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m23:58:17.666333 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m23:58:17.669537 [debug] [Thread-2  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m23:58:17.680242 [debug] [Thread-1  ]: Creating new relation dim_zones
[0m23:58:17.681766 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:58:17.700109 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:58:17.740028 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:58:17.811325 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        ...
[0m23:58:17.829628 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        
[0m23:58:17.830416 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-19 23:58:17.607151 => 2023-02-19 23:58:17.830203
[0m23:58:17.863204 [debug] [Thread-1  ]: Database Error in model dim_zones (models/core/dim_zones.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 60. DB::Exception: Table sandbox.taxi_zone_lookup doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m23:58:17.864739 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b24eef0-6cfd-4597-a128-fd5ab77651e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e31300ca0>]}
[0m23:58:17.865618 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model sandbox.dim_zones ........................ [[31mERROR[0m in 0.44s]
[0m23:58:17.868637 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m23:58:18.001332 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m23:58:18.003741 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m23:58:18.022076 [debug] [Thread-2  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )
[0m23:58:18.023094 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-19 23:58:17.465483 => 2023-02-19 23:58:18.022955
[0m23:58:18.026640 [debug] [Thread-2  ]: Database Error in model stg_fhv_tripdata (models/staging/stg_fhv_tripdata.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 47. DB::Exception: Missing columns: 'SR_flag' while processing query: 'SELECT lower(hex(MD5(concat(ifNull(toString(dispatching_base_num AS vendorid), ''), '-', ifNull(toString(toDateTime(pickup_datetime) AS pickup_datetime), ''))))) A
  compiled Code at target/run/taxi_rides_ny/models/staging/stg_fhv_tripdata.sql
[0m23:58:18.027357 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b24eef0-6cfd-4597-a128-fd5ab77651e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e3130f370>]}
[0m23:58:18.028498 [error] [Thread-2  ]: 2 of 7 ERROR creating sql view model sandbox.stg_fhv_tripdata .................. [[31mERROR[0m in 0.60s]
[0m23:58:18.029769 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m23:58:18.031308 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:58:18.034498 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m23:58:18.048815 [info ] [Thread-1  ]: 5 of 7 SKIP relation sandbox.fact_trips_fhv .................................... [[33mSKIP[0m]
[0m23:58:18.056002 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m23:58:18.057482 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m23:58:18.071357 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:58:18.074439 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m23:58:18.086948 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:58:18.093975 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m23:58:18.107788 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:58:18.109775 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m23:58:18.111628 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m23:58:18.125395 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:58:18.144771 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:58:18.156416 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m23:58:18.196601 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:58:18.196974 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m23:58:18.199285 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m23:58:18.212400 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:58:18.219872 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m23:58:18.233134 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:58:18.236243 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m23:58:18.248885 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:58:18.258280 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m23:58:18.271187 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m23:58:18.273626 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-19 23:58:17.525966 => 2023-02-19 23:58:18.273518
[0m23:58:18.275188 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b24eef0-6cfd-4597-a128-fd5ab77651e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e31300130>]}
[0m23:58:18.276348 [info ] [Thread-4  ]: 4 of 7 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.85s]
[0m23:58:18.277653 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m23:58:18.372228 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m23:58:18.374890 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-19 23:58:17.518808 => 2023-02-19 23:58:18.374663
[0m23:58:18.376569 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b24eef0-6cfd-4597-a128-fd5ab77651e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e312ec550>]}
[0m23:58:18.377521 [info ] [Thread-3  ]: 3 of 7 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.95s]
[0m23:58:18.379153 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m23:58:18.380853 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.fact_trips
[0m23:58:18.382024 [info ] [Thread-2  ]: 6 of 7 SKIP relation sandbox.fact_trips ........................................ [[33mSKIP[0m]
[0m23:58:18.383174 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m23:58:18.384572 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:58:18.385675 [info ] [Thread-4  ]: 7 of 7 SKIP relation sandbox.dm_monthly_zone_revenue ........................... [[33mSKIP[0m]
[0m23:58:18.387659 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m23:58:18.390106 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:58:18.391585 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:58:18.392056 [debug] [MainThread]: Connection 'model.taxi_rides_ny.dim_zones' was left open.
[0m23:58:18.392486 [debug] [MainThread]: On model.taxi_rides_ny.dim_zones: Close
[0m23:58:18.396064 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_fhv_tripdata' was left open.
[0m23:58:18.396591 [debug] [MainThread]: On model.taxi_rides_ny.stg_fhv_tripdata: Close
[0m23:58:18.400246 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m23:58:18.401105 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m23:58:18.406208 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m23:58:18.406953 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m23:58:18.410760 [info ] [MainThread]: 
[0m23:58:18.411370 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 0 minutes and 2.73 seconds (2.73s).
[0m23:58:18.412292 [debug] [MainThread]: Command end result
[0m23:58:18.441191 [info ] [MainThread]: 
[0m23:58:18.441833 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m23:58:18.442282 [info ] [MainThread]: 
[0m23:58:18.442695 [error] [MainThread]: [33mDatabase Error in model dim_zones (models/core/dim_zones.sql)[0m
[0m23:58:18.443064 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m23:58:18.443419 [error] [MainThread]:    Code: 60. DB::Exception: Table sandbox.taxi_zone_lookup doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m23:58:18.443849 [info ] [MainThread]: 
[0m23:58:18.444247 [error] [MainThread]: [33mDatabase Error in model stg_fhv_tripdata (models/staging/stg_fhv_tripdata.sql)[0m
[0m23:58:18.444606 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m23:58:18.444976 [error] [MainThread]:    Code: 47. DB::Exception: Missing columns: 'SR_flag' while processing query: 'SELECT lower(hex(MD5(concat(ifNull(toString(dispatching_base_num AS vendorid), ''), '-', ifNull(toString(toDateTime(pickup_datetime) AS pickup_datetime), ''))))) A
[0m23:58:18.445323 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/staging/stg_fhv_tripdata.sql
[0m23:58:18.446374 [info ] [MainThread]: 
[0m23:58:18.446860 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=3 TOTAL=7
[0m23:58:18.447437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e3124ef10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e3124efa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7e3124ef40>]}
[0m23:58:18.448004 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:00:22.729073 | b6375ae1-5a92-465a-95ec-f9fa672990b7 ==============================
[0m00:00:22.729073 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:00:22.735314 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:00:22.735899 [debug] [MainThread]: Tracking: tracking
[0m00:00:22.793217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b686100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b686670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b686400>]}
[0m00:00:23.280757 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:00:23.281860 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_fhv_tripdata.sql
[0m00:00:23.417391 [debug] [MainThread]: 1603: static parser failed on staging/stg_fhv_tripdata.sql
[0m00:00:23.468701 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_fhv_tripdata.sql
[0m00:00:23.525152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b6375ae1-5a92-465a-95ec-f9fa672990b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b96e310>]}
[0m00:00:23.601551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b6375ae1-5a92-465a-95ec-f9fa672990b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b818400>]}
[0m00:00:23.602323 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:00:23.604087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6375ae1-5a92-465a-95ec-f9fa672990b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b8d86a0>]}
[0m00:00:23.624196 [info ] [MainThread]: 
[0m00:00:23.628179 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:00:23.630804 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:00:23.657883 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:00:24.699460 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:00:24.732459 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:00:24.738266 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:00:24.738920 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:00:24.750746 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:00:24.787312 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:00:24.792675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6375ae1-5a92-465a-95ec-f9fa672990b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b999c40>]}
[0m00:00:24.793961 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:00:24.795003 [info ] [MainThread]: 
[0m00:00:24.806591 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m00:00:24.808225 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:00:24.808835 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m00:00:24.809324 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:00:24.817571 [info ] [Thread-1  ]: 1 of 7 START sql table model sandbox.dim_zones ................................. [RUN]
[0m00:00:24.818614 [info ] [Thread-2  ]: 2 of 7 START sql view model sandbox.stg_fhv_tripdata ........................... [RUN]
[0m00:00:24.820742 [info ] [Thread-3  ]: 3 of 7 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m00:00:24.822081 [info ] [Thread-4  ]: 4 of 7 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m00:00:24.823457 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m00:00:24.824783 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m00:00:24.825848 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m00:00:24.826818 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m00:00:24.827208 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m00:00:24.827666 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:00:24.828115 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m00:00:24.828761 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:00:24.829234 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m00:00:24.845575 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:00:24.857849 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:00:24.862327 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:00:24.871867 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m00:00:24.875424 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-20 00:00:24.829607 => 2023-02-20 00:00:24.875215
[0m00:00:24.876185 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:00:24.890475 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-20 00:00:24.846117 => 2023-02-20 00:00:24.890298
[0m00:00:24.891073 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:00:24.902953 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-20 00:00:24.862831 => 2023-02-20 00:00:24.902772
[0m00:00:24.903557 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m00:00:24.942995 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-20 00:00:24.835909 => 2023-02-20 00:00:24.942818
[0m00:00:24.994099 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m00:00:25.025252 [debug] [Thread-2  ]: Creating new relation stg_fhv_tripdata
[0m00:00:25.067032 [debug] [Thread-1  ]: Creating new relation dim_zones
[0m00:00:25.079160 [debug] [Thread-2  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:00:25.082057 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:00:25.082520 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:00:25.131481 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        ...
[0m00:00:25.133008 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m00:00:25.135659 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m00:00:25.140302 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m00:00:25.147923 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        
[0m00:00:25.149104 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-20 00:00:24.903900 => 2023-02-20 00:00:25.148930
[0m00:00:25.233590 [debug] [Thread-1  ]: Database Error in model dim_zones (models/core/dim_zones.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 60. DB::Exception: Table sandbox.taxi_zone_lookup doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m00:00:25.235106 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6375ae1-5a92-465a-95ec-f9fa672990b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b947880>]}
[0m00:00:25.236381 [error] [Thread-1  ]: 1 of 7 ERROR creating sql table model sandbox.dim_zones ........................ [[31mERROR[0m in 0.41s]
[0m00:00:25.240151 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m00:00:25.596204 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_Flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:00:25.605979 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:00:25.695151 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m00:00:25.728605 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-20 00:00:24.876611 => 2023-02-20 00:00:25.728507
[0m00:00:25.730341 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6375ae1-5a92-465a-95ec-f9fa672990b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03c4080a0>]}
[0m00:00:25.731005 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:00:25.731454 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m00:00:25.732404 [info ] [Thread-2  ]: 2 of 7 OK created sql view model sandbox.stg_fhv_tripdata ...................... [[32mOK[0m in 0.91s]
[0m00:00:25.747014 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:00:25.748459 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:00:25.761278 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m00:00:25.762030 [info ] [Thread-1  ]: 5 of 7 SKIP relation sandbox.fact_trips_fhv .................................... [[33mSKIP[0m]
[0m00:00:25.762828 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m00:00:25.764063 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:00:25.771785 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:00:25.774218 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:00:25.776768 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:00:25.785928 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:00:25.788168 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:00:25.790646 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:00:25.797164 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m00:00:25.801924 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:00:25.809582 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m00:00:25.811788 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:00:25.813916 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m00:00:25.823409 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:00:25.825518 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m00:00:25.828147 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:00:25.845827 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m00:00:25.847947 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:00:25.855685 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m00:00:25.870672 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:00:25.872973 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-20 00:00:24.994939 => 2023-02-20 00:00:25.872882
[0m00:00:25.874098 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6375ae1-5a92-465a-95ec-f9fa672990b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b935dc0>]}
[0m00:00:25.874863 [info ] [Thread-3  ]: 3 of 7 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 1.05s]
[0m00:00:25.875476 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m00:00:25.971379 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.12 seconds
[0m00:00:25.973857 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-20 00:00:24.891396 => 2023-02-20 00:00:25.973769
[0m00:00:25.974974 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6375ae1-5a92-465a-95ec-f9fa672990b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03b961c70>]}
[0m00:00:25.975846 [info ] [Thread-4  ]: 4 of 7 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 1.15s]
[0m00:00:25.976532 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:00:25.978245 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:00:25.979030 [info ] [Thread-1  ]: 6 of 7 SKIP relation sandbox.fact_trips ........................................ [[33mSKIP[0m]
[0m00:00:25.979860 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:00:25.981723 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:00:25.982631 [info ] [Thread-3  ]: 7 of 7 SKIP relation sandbox.dm_monthly_zone_revenue ........................... [[33mSKIP[0m]
[0m00:00:25.983381 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:00:25.992299 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:00:25.993478 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:00:25.994016 [debug] [MainThread]: Connection 'model.taxi_rides_ny.dim_zones' was left open.
[0m00:00:25.994743 [debug] [MainThread]: On model.taxi_rides_ny.dim_zones: Close
[0m00:00:25.998816 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_fhv_tripdata' was left open.
[0m00:00:25.999375 [debug] [MainThread]: On model.taxi_rides_ny.stg_fhv_tripdata: Close
[0m00:00:26.003619 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m00:00:26.004464 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m00:00:26.008440 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m00:00:26.008983 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m00:00:26.012924 [info ] [MainThread]: 
[0m00:00:26.013611 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 0 minutes and 2.39 seconds (2.39s).
[0m00:00:26.014735 [debug] [MainThread]: Command end result
[0m00:00:26.041991 [info ] [MainThread]: 
[0m00:00:26.042780 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:00:26.043283 [info ] [MainThread]: 
[0m00:00:26.044554 [error] [MainThread]: [33mDatabase Error in model dim_zones (models/core/dim_zones.sql)[0m
[0m00:00:26.045138 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m00:00:26.045664 [error] [MainThread]:    Code: 60. DB::Exception: Table sandbox.taxi_zone_lookup doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m00:00:26.046114 [info ] [MainThread]: 
[0m00:00:26.046632 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=3 TOTAL=7
[0m00:00:26.047272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03c44d6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03c215280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe03c5b4a60>]}
[0m00:00:26.047811 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:02:24.104910 | d35d57c5-55ff-41a6-a09b-0955dc5da055 ==============================
[0m00:02:24.104910 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:02:24.111007 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'show': False, 'which': 'seed', 'rpc_method': 'seed', 'indirect_selection': 'eager'}
[0m00:02:24.111894 [debug] [MainThread]: Tracking: tracking
[0m00:02:24.174983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe8d8cb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe8e96580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe8e96310>]}
[0m00:02:24.555216 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:02:24.555908 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:02:24.575795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd35d57c5-55ff-41a6-a09b-0955dc5da055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe91e7970>]}
[0m00:02:24.603818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd35d57c5-55ff-41a6-a09b-0955dc5da055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe90d71c0>]}
[0m00:02:24.605230 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:02:24.606210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd35d57c5-55ff-41a6-a09b-0955dc5da055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe90d72e0>]}
[0m00:02:24.610684 [info ] [MainThread]: 
[0m00:02:24.614653 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:02:24.617345 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:02:24.649480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:02:25.703722 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:02:25.719014 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:25.726031 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:02:25.726786 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:02:25.740548 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:02:25.761398 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:02:25.768163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd35d57c5-55ff-41a6-a09b-0955dc5da055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe9219220>]}
[0m00:02:25.769819 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:02:25.770562 [info ] [MainThread]: 
[0m00:02:25.783688 [debug] [Thread-1  ]: Began running node seed.taxi_rides_ny.taxi_zone_lookup
[0m00:02:25.784832 [info ] [Thread-1  ]: 1 of 1 START seed file sandbox.taxi_zone_lookup ................................ [RUN]
[0m00:02:25.786385 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'seed.taxi_rides_ny.taxi_zone_lookup'
[0m00:02:25.786939 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly seed.taxi_rides_ny.taxi_zone_lookup)
[0m00:02:25.787552 [debug] [Thread-1  ]: Began compiling node seed.taxi_rides_ny.taxi_zone_lookup
[0m00:02:25.788148 [debug] [Thread-1  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (compile): 2023-02-20 00:02:25.787973 => 2023-02-20 00:02:25.787988
[0m00:02:25.788699 [debug] [Thread-1  ]: Began executing node seed.taxi_rides_ny.taxi_zone_lookup
[0m00:02:26.045382 [debug] [Thread-1  ]: dbt_clickhouse adapter: On seed.taxi_rides_ny.taxi_zone_lookup: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "seed.taxi_rides_ny.taxi_zone_lookup"} */

    create table sandbox.taxi_zone_lookup ("locationid" Int32,"borough" String,"zone" String,"service_zone" String)
    
  engine = MergeTree()
    
      order by (tuple())
    
  ...
[0m00:02:26.065267 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:02:26.088536 [debug] [Thread-1  ]: dbt_clickhouse adapter: On seed.taxi_rides_ny.taxi_zone_lookup: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "seed.taxi_rides_ny.taxi_zone_lookup"} */
insert into sandbox.taxi_zone_lookup ("locationid", "borough", "zone", "service_zone")
    
    format CSV
    1,EWR,Newark Airport,EWR
2,Queens,Jamaica Bay,Boro Zone
3,Bronx,Allerton/Pelham Gardens,Boro Zone
4,Manhattan,Alphabet City,Yellow Zone
5,Staten Island,Arden Heights,Boro Zone
6,Staten Island,Arrochar/Fort Wadsworth,Boro Zone
7,Queens,Astoria,Boro Zone
8,Queens,Astoria Park,Boro Zone
9,Queens,Auburndale,Boro Zone
10,Queens,Baisley Park,Boro Zone
11,Brooklyn,Bath Beach,Boro Zone
12,Manhattan,Battery Park,Yellow Zone
13,Manhattan,Battery Park City,Yellow Zone
14,Brooklyn,Bay Ridge,Boro Zone
15,Queens,Bay Terrace/Fort Totten,Boro Zone
16,Queens,Bayside,Boro Zone
17,Brooklyn,Bedford,Boro Zone
18,Bronx,Bedford Park,Boro Zone
19,Queens,Bellerose,Boro Zone
20,Bronx,Belmont,Boro Zone
21,Brooklyn,Bensonhurst East,Boro Zone
22,Brooklyn,Bensonhurst West,Boro Zone
23,Staten Island,Bloomfield/Emerson Hill,Boro Zone
24,Manhattan,Bloomingdale,Yellow Zone
25,Brooklyn,Boerum Hill,Boro Zone
26,Brooklyn,Borough Park,Boro Zone
27,Queens,Breezy Point/Fort Tilden/Riis Beach,Boro Zone
28,Queens,Briarwood/Jamaica Hills,Boro Zone
29,Brooklyn,Brighton Beach,Boro Zone
30,Queens,Broad Channel,Boro Zone
31,Bronx,Bronx Park,Boro Zone
32,Bronx,Bronxdale,Boro Zone
33,Brooklyn,Brooklyn Heights,Boro Zone
34,Brooklyn,Brooklyn Navy Yard,Boro Zone
35,Brooklyn,Brownsville,Boro Zone
36,Brooklyn,Bushwick North,Boro Zone
37,Brooklyn,Bushwick South,Boro Zone
38,Queens,Cambria Heights,Boro Zone
39,Brooklyn,Canarsie,Boro Zone
40,Brooklyn,Carroll Gardens,Boro Zone
41,Manhattan,Central Harlem,Boro Zone
42,Manhattan,Central Harlem North,Boro Zone
43,Manhattan,Central Park,Yellow Zone
44,Staten Island,Charleston/Tottenville,Boro Zone
45,Manhattan,Chinatown,Yellow Zone
46,Bronx,City Island,Boro Zone
47,Bronx,Claremont/Bathgate,Boro Zone
48,Manhattan,Clinton East,Yellow Zone
49,Brooklyn,Clinton Hill,Boro Zone
50,Manhattan,Clinton West,Yellow Zone
51,Bronx,Co-Op City,Boro Zone
52,Brooklyn,Cobble Hill,Boro Zone
53,Queens,College Point,Boro Zone
54,Brooklyn,Columbia Street,Boro Zone
55,Brooklyn,Coney Island,Boro Zone
56,Queens,Corona,Boro Zone
57,Queens,Corona,Boro Zone
58,Bronx,Country Club,Boro Zone
59,Bronx,Crotona Park,Boro Zone
60,Bronx,Crotona Park East,Boro Zone
61,Brooklyn,Crown Heights North,Boro Zone
62,Brooklyn,Crown Heights South,Boro Zone
63,Brooklyn,Cypress Hills,Boro Zone
64,Queens,Douglaston,Boro Zone
65,Brooklyn,Downtown Brooklyn/MetroTech,Boro Zone
66,Brooklyn,DUMBO/Vinegar Hill,Boro Zone
67,Brooklyn,Dyker Heights,Boro Zone
68,Manhattan,East Chelsea,Yellow Zone
69,Bronx,East Concourse/Concourse Village,Boro Zone
70,Queens,East Elmhurst,Boro Zone
71,Brooklyn,East Flatbush/Farragut,Boro Zone
72,Brooklyn,East Flatbush/Remsen Village,Boro Zone
73,Queens,East Flushing,Boro Zone
74,Manhattan,East Harlem North,Boro Zone
75,Manhattan,East Harlem South,Boro Zone
76,Brooklyn,East New York,Boro Zone
77,Brooklyn,East New York/Pennsylvania Avenue,Boro Zone
78,Bronx,East Tremont,Boro Zone
79,Manhattan,East Village,Yellow Zone
80,Brooklyn,East Williamsburg,Boro Zone
81,Bronx,Eastchester,Boro Zone
82,Queens,Elmhurst,Boro Zone
83,Queens,Elmhurst/Maspeth,Boro Zone
84,Staten Island,Eltingville/Annadale/Prince's Bay,Boro Zone
85,Brooklyn,Erasmus,Boro Zone
86,Queens,Far Rockaway,Boro Zone
87,Manhattan,Financial District North,Yellow Zone
88,Manhattan,Financial District South,Yellow Zone
89,Brooklyn,Flatbush/Ditmas Park,Boro Zone
90,Manhattan,Flatiron,Yellow Zone
91,Brooklyn,Flatlands,Boro Zone
92,Queens,Flushing,Boro Zone
93,Queens,Flushing Meadows-Corona Park,Boro Zone
94,Bronx,Fordham South,Boro Zone
95,Queens,Forest Hills,Boro Zone
96,Queens,Forest Park/Highland Park,Boro Zone
97,Brooklyn,Fort Greene,Boro Zone
98,Queens,Fresh Meadows,Boro Zone
99,Staten Island,Freshkills Park,Boro Zone
100,Manhattan,Garment District,Yellow Zone
101,Queens,Glen Oaks,Boro Zone
102,Queens,Glendale,Boro Zone
103,Manhattan,Governor's Island/Ellis Island/Liberty Island,Yellow Zone
104,Manhattan,Governor's Island/Ellis Island/Liberty Island,Yellow Zone
105,Manhattan,Governor's Island/Ellis Island/Liberty Island,Yellow Zone
106,Brooklyn,Gowanus,Boro Zone
107,Manhattan,Gramercy,Yellow Zone
108,Brooklyn,Gravesend,Boro Zone
109,Staten Island,Great Kills,Boro Zone
110,Staten Island,Great Kills Park,Boro Zone
111,Brooklyn,Green-Wood Cemetery,Boro Zone
112,Brooklyn,Greenpoint,Boro Zone
113,Manhattan,Greenwich Village North,Yellow Zone
114,Manhattan,Greenwich Village South,Yellow Zone
115,Staten Island,Grymes Hill/Clifton,Boro Zone
116,Manhattan,Hamilton Heights,Boro Zone
117,Queens,Hammels/Arverne,Boro Zone
118,Staten Island,Heartland Village/Todt Hill,Boro Zone
119,Bronx,Highbridge,Boro Zone
120,Manhattan,Highbridge Park,Boro Zone
121,Queens,Hillcrest/Pomonok,Boro Zone
122,Queens,Hollis,Boro Zone
123,Brooklyn,Homecrest,Boro Zone
124,Queens,Howard Beach,Boro Zone
125,Manhattan,Hudson Sq,Yellow Zone
126,Bronx,Hunts Point,Boro Zone
127,Manhattan,Inwood,Boro Zone
128,Manhattan,Inwood Hill Park,Boro Zone
129,Queens,Jackson Heights,Boro Zone
130,Queens,Jamaica,Boro Zone
131,Queens,Jamaica Estates,Boro Zone
132,Queens,JFK Airport,Airports
133,Brooklyn,Kensington,Boro Zone
134,Queens,Kew Gardens,Boro Zone
135,Queens,Kew Gardens Hills,Boro Zone
136,Bronx,Kingsbridge Heights,Boro Zone
137,Manhattan,Kips Bay,Yellow Zone
138,Queens,LaGuardia Airport,Airports
139,Queens,Laurelton,Boro Zone
140,Manhattan,Lenox Hill East,Yellow Zone
141,Manhattan,Lenox Hill West,Yellow Zone
142,Manhattan,Lincoln Square East,Yellow Zone
143,Manhattan,Lincoln Square West,Yellow Zone
144,Manhattan,Little Italy/NoLiTa,Yellow Zone
145,Queens,Long Island City/Hunters Point,Boro Zone
146,Queens,Long Island City/Queens Plaza,Boro Zone
147,Bronx,Longwood,Boro Zone
148,Manhattan,Lower East Side,Yellow Zone
149,Brooklyn,Madison,Boro Zone
150,Brooklyn,Manhattan Beach,Boro Zone
151,Manhattan,Manhattan Valley,Yellow Zone
152,Manhattan,Manhattanville,Boro Zone
153,Manhattan,Marble Hill,Boro Zone
154,Brooklyn,Marine Park/Floyd Bennett Field,Boro Zone
155,Brooklyn,Marine Park/Mill Basin,Boro Zone
156,Staten Island,Mariners Harbor,Boro Zone
157,Queens,Maspeth,Boro Zone
158,Manhattan,Meatpacking/West Village West,Yellow Zone
159,Bronx,Melrose South,Boro Zone
160,Queens,Middle Village,Boro Zone
161,Manhattan,Midtown Center,Yellow Zone
162,Manhattan,Midtown East,Yellow Zone
163,Manhattan,Midtown North,Yellow Zone
164,Manhattan,Midtown South,Yellow Zone
165,Brooklyn,Midwood,Boro Zone
166,Manhattan,Morningside Heights,Boro Zone
167,Bronx,Morrisania/Melrose,Boro Zone
168,Bronx,Mott Haven/Port Morris,Boro Zone
169,Bronx,Mount Hope,Boro Zone
170,Manhattan,Murray Hill,Yellow Zone
171,Queens,Murray Hill-Queens,Boro Zone
172,Staten Island,New Dorp/Midland Beach,Boro Zone
173,Queens,North Corona,Boro Zone
174,Bronx,Norwood,Boro Zone
175,Queens,Oakland Gardens,Boro Zone
176,Staten Island,Oakwood,Boro Zone
177,Brooklyn,Ocean Hill,Boro Zone
178,Brooklyn,Ocean Parkway South,Boro Zone
179,Queens,Old Astoria,Boro Zone
180,Queens,Ozone Park,Boro Zone
181,Brooklyn,Park Slope,Boro Zone
182,Bronx,Parkchester,Boro Zone
183,Bronx,Pelham Bay,Boro Zone
184,Bronx,Pelham Bay Park,Boro Zone
185,Bronx,Pelham Parkway,Boro Zone
186,Manhattan,Penn Station/Madison Sq West,Yellow Zone
187,Staten Island,Port Richmond,Boro Zone
188,Brooklyn,Prospect-Lefferts Gardens,Boro Zone
189,Brooklyn,Prospect Heights,Boro Zone
190,Brooklyn,Prospect Park,Boro Zone
191,Queens,Queens Village,Boro Zone
192,Queens,Queensboro Hill,Boro Zone
193,Queens,Queensbridge/Ravenswood,Boro Zone
194,Manhattan,Randalls Island,Yellow Zone
195,Brooklyn,Red Hook,Boro Zone
196,Queens,Rego Park,Boro Zone
197,Queens,Richmond Hill,Boro Zone
198,Queens,Ridgewood,Boro Zone
199,Bronx,Rikers Island,Boro Zone
200,Bronx,Riverdale/North Riverdale/Fieldston,Boro Zone
201,Queens,Rockaway Park,Boro Zone
202,Manhattan,Roosevelt Island,Boro Zone
203,Queens,Rosedale,Boro Zone
204,Staten Island,Rossville/Woodrow,Boro Zone
205,Queens,Saint Albans,Boro Zone
206,Staten Island,Saint George/New Brighton,Boro Zone
207,Queens,Saint Michaels Cemetery/Woodside,Boro Zone
208,Bronx,Schuylerville/Edgewater Park,Boro Zone
209,Manhattan,Seaport,Yellow Zone
210,Brooklyn,Sheepshead Bay,Boro Zone
211,Manhattan,SoHo,Yellow Zone
212,Bronx,Soundview/Bruckner,Boro Zone
213,Bronx,Soundview/Castle Hill,Boro Zone
214,Staten Island,South Beach/Dongan Hills,Boro Zone
215,Queens,South Jamaica,Boro Zone
216,Queens,South Ozone Park,Boro Zone
217,Brooklyn,South Williamsburg,Boro Zone
218,Queens,Springfield Gardens North,Boro Zone
219,Queens,Springfield Gardens South,Boro Zone
220,Bronx,Spuyten Duyvil/Kingsbridge,Boro Zone
221,Staten Island,Stapleton,Boro Zone
222,Brooklyn,Starrett City,Boro Zone
223,Queens,Steinway,Boro Zone
224,Manhattan,Stuy Town/Peter Cooper Village,Yellow Zone
225,Brooklyn,Stuyvesant Heights,Boro Zone
226,Queens,Sunnyside,Boro Zone
227,Brooklyn,Sunset Park East,Boro Zone
228,Brooklyn,Sunset Park West,Boro Zone
229,Manhattan,Sutton Place/Turtle Bay North,Yellow Zone
230,Manhattan,Times Sq/Theatre District,Yellow Zone
231,Manhattan,TriBeCa/Civic Center,Yellow Zone
232,Manhattan,Two Bridges/Seward Park,Yellow Zone
233,Manhattan,UN/Turtle Bay South,Yellow Zone
234,Manhattan,Union Sq,Yellow Zone
235,Bronx,University Heights/Morris Heights,Boro Zone
236,Manhattan,Upper East Side North,Yellow Zone
237,Manhattan,Upper East Side South,Yellow Zone
238,Manhattan,Upper West Side North,Yellow Zone
239,Manhattan,Upper West Side South,Yellow Zone
240,Bronx,Van Cortlandt Park,Boro Zone
241,Bronx,Van Cortlandt Village,Boro Zone
242,Bronx,Van Nest/Morris Park,Boro Zone
243,Manhattan,Washington Heights North,Boro Zone
244,Manhattan,Washington Heights South,Boro Zone
245,Staten Island,West Brighton,Boro Zone
246,Manhattan,West Chelsea/Hudson Yards,Yellow Zone
247,Bronx,West Concourse,Boro Zone
248,Bronx,West Farms/Bronx River,Boro Zone
249,Manhattan,West Village,Yellow Zone
250,Bronx,Westchester Village/Unionport,Boro Zone
251,Staten Island,Westerleigh,Boro Zone
252,Queens,Whitestone,Boro Zone
253,Queens,Willets Point,Boro Zone
254,Bronx,Williamsbridge/Olinville,Boro Zone
255,Brooklyn,Williamsburg (North Side),Boro Zone
256,Brooklyn,Williamsburg (South Side),Boro Zone
257,Brooklyn,Windsor Terrace,Boro Zone
258,Queens,Woodhaven,Boro Zone
259,Bronx,Woodlawn/Wakefield,Boro Zone
260,Queens,Woodside,Boro Zone
261,Manhattan,World Trade Center,Yellow Zone
262,Manhattan,Yorkville East,Yellow Zone
263,Manhattan,Yorkville West,Yellow Zone
264,Unknown,NV,N/A
265,Unknown,NA,N/A
...
[0m00:02:26.103431 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:26.119712 [debug] [Thread-1  ]: Writing runtime SQL for node "seed.taxi_rides_ny.taxi_zone_lookup"
[0m00:02:26.173058 [debug] [Thread-1  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (execute): 2023-02-20 00:02:25.789075 => 2023-02-20 00:02:26.172918
[0m00:02:26.174784 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd35d57c5-55ff-41a6-a09b-0955dc5da055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe99beee0>]}
[0m00:02:26.175784 [info ] [Thread-1  ]: 1 of 1 OK loaded seed file sandbox.taxi_zone_lookup ............................ [[32mINSERT 265[0m in 0.39s]
[0m00:02:26.178693 [debug] [Thread-1  ]: Finished running node seed.taxi_rides_ny.taxi_zone_lookup
[0m00:02:26.183329 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:02:26.184777 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:02:26.185379 [debug] [MainThread]: Connection 'seed.taxi_rides_ny.taxi_zone_lookup' was left open.
[0m00:02:26.185920 [debug] [MainThread]: On seed.taxi_rides_ny.taxi_zone_lookup: Close
[0m00:02:26.190098 [info ] [MainThread]: 
[0m00:02:26.190879 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 1.58 seconds (1.58s).
[0m00:02:26.191710 [debug] [MainThread]: Command end result
[0m00:02:26.222706 [info ] [MainThread]: 
[0m00:02:26.223676 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:02:26.225358 [info ] [MainThread]: 
[0m00:02:26.226235 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:02:26.228000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe993b3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe9953f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcbe91bff10>]}
[0m00:02:26.228803 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:02:37.989254 | 19c7d9fc-0ec4-4054-a99e-5bd924b58513 ==============================
[0m00:02:37.989254 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:02:37.996167 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:02:37.996879 [debug] [MainThread]: Tracking: tracking
[0m00:02:38.067005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ebe75bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ebe6d4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ebe6d280>]}
[0m00:02:38.475343 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:02:38.476012 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:02:38.494992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec0a78e0>]}
[0m00:02:38.524169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ebf960d0>]}
[0m00:02:38.525054 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:02:38.525758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ebf96100>]}
[0m00:02:38.530232 [info ] [MainThread]: 
[0m00:02:38.533970 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:02:38.537826 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:02:38.569886 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:02:39.610084 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:02:39.622704 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:39.629261 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:02:39.629939 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:02:39.642664 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:02:39.657304 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:39.663380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec0dc190>]}
[0m00:02:39.664927 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:02:39.665648 [info ] [MainThread]: 
[0m00:02:39.689858 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m00:02:39.690811 [info ] [Thread-1  ]: 1 of 7 START sql table model sandbox.dim_zones ................................. [RUN]
[0m00:02:39.692093 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m00:02:39.692546 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m00:02:39.693009 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m00:02:39.700405 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:02:39.704797 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m00:02:39.705639 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m00:02:39.701338 [info ] [Thread-2  ]: 2 of 7 START sql view model sandbox.stg_fhv_tripdata ........................... [RUN]
[0m00:02:39.706475 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:02:39.707845 [info ] [Thread-3  ]: 3 of 7 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m00:02:39.710773 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m00:02:39.712244 [info ] [Thread-4  ]: 4 of 7 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m00:02:39.714511 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m00:02:39.715359 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-20 00:02:39.693400 => 2023-02-20 00:02:39.715178
[0m00:02:39.716036 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:02:39.717169 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m00:02:39.730084 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:02:39.717734 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m00:02:39.729248 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:02:39.755824 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:02:39.718453 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m00:02:39.760586 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:02:39.775355 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-20 00:02:39.730963 => 2023-02-20 00:02:39.774964
[0m00:02:39.776074 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:02:39.794355 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-20 00:02:39.718906 => 2023-02-20 00:02:39.794162
[0m00:02:39.800414 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-20 00:02:39.741855 => 2023-02-20 00:02:39.800228
[0m00:02:39.810812 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:02:39.834951 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m00:02:39.857402 [debug] [Thread-1  ]: Creating new relation dim_zones
[0m00:02:39.991525 [debug] [Thread-2  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:02:39.995211 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:02:39.997118 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:02:40.028131 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m00:02:40.043179 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m00:02:40.057849 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        ...
[0m00:02:40.060505 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m00:02:40.250173 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.19 seconds
[0m00:02:40.274876 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

    select name, type from system.columns where table = 'dim_zones'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:02:40.291372 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:40.298670 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.dim_zones"
[0m00:02:40.305100 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

  
    
    
        
        insert into sandbox.dim_zones ("locationid", "borough", "zone", "service_zone")
  

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
  ...
[0m00:02:40.320315 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:40.364758 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-20 00:02:39.761773 => 2023-02-20 00:02:40.364644
[0m00:02:40.366474 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec978f70>]}
[0m00:02:40.367478 [info ] [Thread-1  ]: 1 of 7 OK created sql table model sandbox.dim_zones ............................ [[32mOK[0m in 0.67s]
[0m00:02:40.370375 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m00:02:40.381840 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:02:40.385363 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:02:40.387935 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata__dbt_tmp 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_Flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:02:40.410034 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:02:40.426824 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m00:02:40.430188 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m00:02:40.438871 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m00:02:40.439483 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:02:40.446056 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:02:40.457463 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:40.459778 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:02:40.461051 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:02:40.463328 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:02:40.465519 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata to sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m00:02:40.467485 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:02:40.473636 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:40.480459 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m00:02:40.482846 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:40.489005 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata 
  
  ...
[0m00:02:40.491306 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:02:40.499962 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m00:02:40.510338 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:02:40.512638 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m00:02:40.518745 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:02:40.519549 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:02:40.521738 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata__dbt_tmp to sandbox.stg_fhv_tripdata 
  
  ...
[0m00:02:40.523899 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m00:02:40.527281 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:02:40.548912 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m00:02:40.551495 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:02:40.559711 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */
drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  ...
[0m00:02:40.561011 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:02:40.570051 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m00:02:40.581092 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:02:40.583850 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-20 00:02:39.972331 => 2023-02-20 00:02:40.583716
[0m00:02:40.585385 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec0d47c0>]}
[0m00:02:40.586985 [info ] [Thread-3  ]: 3 of 7 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.87s]
[0m00:02:40.587879 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m00:02:40.588893 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:02:40.591434 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-20 00:02:39.863195 => 2023-02-20 00:02:40.591324
[0m00:02:40.592745 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec9d97f0>]}
[0m00:02:40.593611 [info ] [Thread-2  ]: 2 of 7 OK created sql view model sandbox.stg_fhv_tripdata ...................... [[32mOK[0m in 0.88s]
[0m00:02:40.594331 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:02:40.595369 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m00:02:40.596116 [info ] [Thread-1  ]: 5 of 7 START sql table model sandbox.fact_trips_fhv ............................ [RUN]
[0m00:02:40.597616 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m00:02:40.598139 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips_fhv)
[0m00:02:40.598724 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m00:02:40.607174 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:02:40.612038 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-20 00:02:40.599110 => 2023-02-20 00:02:40.611286
[0m00:02:40.612737 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m00:02:40.619400 [debug] [Thread-1  ]: Creating new relation fact_trips_fhv
[0m00:02:40.625937 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
)

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:02:40.660197 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
)

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:02:40.660913 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-20 00:02:40.613133 => 2023-02-20 00:02:40.660777
[0m00:02:40.733902 [debug] [Thread-1  ]: Database Error in model fact_trips_fhv (models/core/fact_trips_fhv.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
   Code: 62. DB::Exception: Syntax error: failed at position 427 ('dim_zones') (line 24, col 1): dim_zones as (
      select * from sandbox.dim_zones
      where borough != 'Unknown'
  )
  
  select 
      fhv_data.tripid,
      fhv_data.vendorid,
      fhv_d
[0m00:02:40.735026 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec9be130>]}
[0m00:02:40.736095 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model sandbox.fact_trips_fhv ................... [[31mERROR[0m in 0.14s]
[0m00:02:40.736953 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m00:02:40.738468 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.17 seconds
[0m00:02:40.741433 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-20 00:02:39.776718 => 2023-02-20 00:02:40.741317
[0m00:02:40.743383 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec0afcd0>]}
[0m00:02:40.744362 [info ] [Thread-4  ]: 4 of 7 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 1.03s]
[0m00:02:40.745565 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:02:40.747900 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:02:40.748963 [info ] [Thread-2  ]: 6 of 7 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:02:40.751302 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:02:40.751848 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:02:40.752359 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:02:40.782957 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:02:40.788309 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:02:40.752817 => 2023-02-20 00:02:40.788102
[0m00:02:40.789047 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:02:40.795156 [debug] [Thread-2  ]: Creating new relation fact_trips
[0m00:02:40.798522 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)
select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:02:40.825860 [debug] [Thread-2  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)
select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:02:40.826583 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:02:40.789430 => 2023-02-20 00:02:40.826447
[0m00:02:40.828997 [debug] [Thread-2  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:02:40.829729 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19c7d9fc-0ec4-4054-a99e-5bd924b58513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec978d90>]}
[0m00:02:40.830569 [error] [Thread-2  ]: 6 of 7 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.08s]
[0m00:02:40.831243 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:02:40.832676 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:02:40.833545 [info ] [Thread-1  ]: 7 of 7 SKIP relation sandbox.dm_monthly_zone_revenue ........................... [[33mSKIP[0m]
[0m00:02:40.834606 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:02:40.837517 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:02:40.838791 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:02:40.839315 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was left open.
[0m00:02:40.840283 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips_fhv: Close
[0m00:02:40.844379 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:02:40.844986 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:02:40.849159 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m00:02:40.850058 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m00:02:40.855292 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m00:02:40.855947 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m00:02:40.860228 [info ] [MainThread]: 
[0m00:02:40.861753 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 0 minutes and 2.33 seconds (2.33s).
[0m00:02:40.863342 [debug] [MainThread]: Command end result
[0m00:02:40.887385 [info ] [MainThread]: 
[0m00:02:40.888126 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m00:02:40.888699 [info ] [MainThread]: 
[0m00:02:40.889253 [error] [MainThread]: [33mDatabase Error in model fact_trips_fhv (models/core/fact_trips_fhv.sql)[0m
[0m00:02:40.889761 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
[0m00:02:40.890523 [error] [MainThread]:    Code: 62. DB::Exception: Syntax error: failed at position 427 ('dim_zones') (line 24, col 1): dim_zones as (
[0m00:02:40.891910 [error] [MainThread]:       select * from sandbox.dim_zones
[0m00:02:40.892616 [error] [MainThread]:       where borough != 'Unknown'
[0m00:02:40.893180 [error] [MainThread]:   )
[0m00:02:40.893735 [error] [MainThread]:   
[0m00:02:40.894364 [error] [MainThread]:   select 
[0m00:02:40.894932 [error] [MainThread]:       fhv_data.tripid,
[0m00:02:40.895527 [error] [MainThread]:       fhv_data.vendorid,
[0m00:02:40.896254 [error] [MainThread]:       fhv_d
[0m00:02:40.897095 [info ] [MainThread]: 
[0m00:02:40.897741 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:02:40.899018 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:02:40.899910 [error] [MainThread]:    Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:02:40.901140 [info ] [MainThread]: 
[0m00:02:40.902522 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=1 TOTAL=7
[0m00:02:40.905059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec90ee80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec90efa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7ec90ef40>]}
[0m00:02:40.906177 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:03:42.290460 | 2d7f0f0f-00e4-4826-a979-6eeb104e9b9f ==============================
[0m00:03:42.290460 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:03:42.293885 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips_fhv'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:03:42.294312 [debug] [MainThread]: Tracking: tracking
[0m00:03:42.332814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c640c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c66c520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c66c2b0>]}
[0m00:03:42.499940 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:03:42.500793 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips_fhv.sql
[0m00:03:42.528716 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips_fhv.sql
[0m00:03:42.576668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2d7f0f0f-00e4-4826-a979-6eeb104e9b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c941310>]}
[0m00:03:42.593405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2d7f0f0f-00e4-4826-a979-6eeb104e9b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c7ec0d0>]}
[0m00:03:42.593976 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:03:42.594457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d7f0f0f-00e4-4826-a979-6eeb104e9b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c7ec1f0>]}
[0m00:03:42.597003 [info ] [MainThread]: 
[0m00:03:42.599229 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:03:42.600836 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:03:42.622492 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:03:43.192965 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:03:43.210514 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:03:43.216222 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:03:43.216852 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:03:43.277612 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:03:43.294656 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:03:43.299078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d7f0f0f-00e4-4826-a979-6eeb104e9b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c87ccd0>]}
[0m00:03:43.300129 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:03:43.300546 [info ] [MainThread]: 
[0m00:03:43.313048 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m00:03:43.313690 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips_fhv ............................ [RUN]
[0m00:03:43.314672 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m00:03:43.315009 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips_fhv)
[0m00:03:43.315310 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m00:03:43.320747 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:03:43.322318 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-20 00:03:43.315524 => 2023-02-20 00:03:43.322164
[0m00:03:43.322775 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m00:03:43.360640 [debug] [Thread-1  ]: Creating new relation fact_trips_fhv
[0m00:03:43.402437 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:03:43.419207 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:03:43.419862 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-20 00:03:43.323033 => 2023-02-20 00:03:43.419726
[0m00:03:43.431962 [debug] [Thread-1  ]: Database Error in model fact_trips_fhv (models/core/fact_trips_fhv.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
   Code: 60. DB::Exception: Table sandbox.trips_unioned doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m00:03:43.432618 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2d7f0f0f-00e4-4826-a979-6eeb104e9b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899d14f5b0>]}
[0m00:03:43.434099 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips_fhv ................... [[31mERROR[0m in 0.12s]
[0m00:03:43.436049 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m00:03:43.438604 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:03:43.440021 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:03:43.440432 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was left open.
[0m00:03:43.440794 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips_fhv: Close
[0m00:03:43.444190 [info ] [MainThread]: 
[0m00:03:43.445061 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m00:03:43.445666 [debug] [MainThread]: Command end result
[0m00:03:43.464586 [info ] [MainThread]: 
[0m00:03:43.465186 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:03:43.465820 [info ] [MainThread]: 
[0m00:03:43.466485 [error] [MainThread]: [33mDatabase Error in model fact_trips_fhv (models/core/fact_trips_fhv.sql)[0m
[0m00:03:43.467045 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 404)
[0m00:03:43.467586 [error] [MainThread]:    Code: 60. DB::Exception: Table sandbox.trips_unioned doesn't exist. (UNKNOWN_TABLE) (version 22.8.13.20 (official build))
[0m00:03:43.468040 [info ] [MainThread]: 
[0m00:03:43.468882 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:03:43.469522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899d0cc370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c85e130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f899c85e1c0>]}
[0m00:03:43.470061 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:04:06.754232 | f19e507d-c6e0-465a-b03b-3998bab741cd ==============================
[0m00:04:06.754232 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:04:06.757496 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips_fhv'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:04:06.757967 [debug] [MainThread]: Tracking: tracking
[0m00:04:06.850348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf69e72b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf69e6b490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf69e6b220>]}
[0m00:04:07.025128 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:04:07.025853 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips_fhv.sql
[0m00:04:07.045085 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips_fhv.sql
[0m00:04:07.082544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f19e507d-c6e0-465a-b03b-3998bab741cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6a37d280>]}
[0m00:04:07.097966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f19e507d-c6e0-465a-b03b-3998bab741cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6a228220>]}
[0m00:04:07.098442 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:04:07.098842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f19e507d-c6e0-465a-b03b-3998bab741cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6a228340>]}
[0m00:04:07.100622 [info ] [MainThread]: 
[0m00:04:07.102365 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:04:07.103681 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:04:07.117977 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:04:09.381263 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:04:09.395136 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:09.402839 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:04:09.403490 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:04:09.460322 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:04:09.598754 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.14 seconds
[0m00:04:09.606106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f19e507d-c6e0-465a-b03b-3998bab741cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6a3702b0>]}
[0m00:04:09.607818 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:04:09.608524 [info ] [MainThread]: 
[0m00:04:09.621303 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m00:04:09.622036 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips_fhv ............................ [RUN]
[0m00:04:09.623164 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m00:04:09.623549 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips_fhv)
[0m00:04:09.623914 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m00:04:09.630168 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:04:09.632421 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-20 00:04:09.624180 => 2023-02-20 00:04:09.632260
[0m00:04:09.632893 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m00:04:09.662992 [debug] [Thread-1  ]: Creating new relation fact_trips_fhv
[0m00:04:09.691907 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:04:09.875716 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.18 seconds
[0m00:04:09.889800 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

    select name, type from system.columns where table = 'fact_trips_fhv'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:04:10.871817 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.98 seconds
[0m00:04:10.881318 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:04:10.882597 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

  
    
    
        
        insert into sandbox.fact_trips_fhv ("fhv_data.tripid", "fhv_data.vendorid", "fhv_data.pickup_locationid", "pickup_borough", "pickup_zone", "fhv_data.dropoff_locationid", "dropoff_borough", "dropoff_zone", "fhv_data.pickup_datetime", "fhv_data.dropoff_datetime", "fhv_data.sr_flag")
  

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:04:10.921767 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m00:04:10.953376 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-20 00:04:09.633237 => 2023-02-20 00:04:10.953225
[0m00:04:10.954272 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f19e507d-c6e0-465a-b03b-3998bab741cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6ac42280>]}
[0m00:04:10.954860 [info ] [Thread-1  ]: 1 of 1 OK created sql table model sandbox.fact_trips_fhv ....................... [[32mOK[0m in 1.33s]
[0m00:04:10.956446 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m00:04:10.959078 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:04:10.959769 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:04:10.960019 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was left open.
[0m00:04:10.960242 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips_fhv: Close
[0m00:04:10.962900 [info ] [MainThread]: 
[0m00:04:10.963311 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.86 seconds (3.86s).
[0m00:04:10.963799 [debug] [MainThread]: Command end result
[0m00:04:10.975760 [info ] [MainThread]: 
[0m00:04:10.976194 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:04:10.976636 [info ] [MainThread]: 
[0m00:04:10.976963 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:04:10.977365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6ab21f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6ab21eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf6a29a130>]}
[0m00:04:10.977764 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:04:17.997458 | 41dc6aa3-f8d0-44ca-934b-990a98ad4bc4 ==============================
[0m00:04:17.997458 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:04:18.000018 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:04:18.000731 [debug] [MainThread]: Tracking: tracking
[0m00:04:18.023648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49bda2b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49beab580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49beab310>]}
[0m00:04:18.162991 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:04:18.163415 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:04:18.172805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49c0e7970>]}
[0m00:04:18.186423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49bfdd1c0>]}
[0m00:04:18.186857 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:04:18.187210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49bfdd2e0>]}
[0m00:04:18.189131 [info ] [MainThread]: 
[0m00:04:18.190853 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:04:18.192365 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:04:18.222889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:04:18.695927 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:04:18.707104 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:18.710650 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:04:18.710996 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:04:18.717840 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:04:18.730875 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:18.734127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49c12b430>]}
[0m00:04:18.734851 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:04:18.735146 [info ] [MainThread]: 
[0m00:04:18.740631 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m00:04:18.741131 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:04:18.741583 [info ] [Thread-1  ]: 1 of 7 START sql table model sandbox.dim_zones ................................. [RUN]
[0m00:04:18.742071 [info ] [Thread-2  ]: 2 of 7 START sql view model sandbox.stg_fhv_tripdata ........................... [RUN]
[0m00:04:18.744767 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m00:04:18.742505 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m00:04:18.743771 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:04:18.745312 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:04:18.746099 [info ] [Thread-3  ]: 3 of 7 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m00:04:18.743406 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m00:04:18.746888 [info ] [Thread-4  ]: 4 of 7 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m00:04:18.752625 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:04:18.753318 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m00:04:18.753672 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m00:04:18.754133 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m00:04:18.754499 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m00:04:18.754744 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m00:04:18.754957 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:04:18.760242 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:04:18.764461 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m00:04:18.765117 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-20 00:04:18.747494 => 2023-02-20 00:04:18.764999
[0m00:04:18.770442 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:04:18.771071 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:04:18.779121 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-20 00:04:18.760628 => 2023-02-20 00:04:18.779004
[0m00:04:18.779527 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m00:04:18.793939 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-20 00:04:18.755104 => 2023-02-20 00:04:18.793775
[0m00:04:18.794493 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-20 00:04:18.765325 => 2023-02-20 00:04:18.794372
[0m00:04:18.794764 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m00:04:18.818911 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:04:18.886866 [debug] [Thread-2  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:04:18.897707 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:04:18.910183 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        ...
[0m00:04:18.914530 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:04:18.917954 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m00:04:18.918346 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m00:04:18.918673 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m00:04:18.939902 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:04:18.949155 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

    select name, type from system.columns where table = 'dim_zones__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:04:18.979617 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:04:18.983369 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.dim_zones"
[0m00:04:18.985473 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

  
    
    
        
        insert into sandbox.dim_zones__dbt_backup ("locationid", "borough", "zone", "service_zone")
  

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
  ...
[0m00:04:19.001001 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:04:19.004209 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */
EXCHANGE TABLES sandbox.dim_zones__dbt_backup AND sandbox.dim_zones 
  
  ...
[0m00:04:19.017569 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.045981 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */
drop table if exists sandbox.dim_zones__dbt_backup 
  ...
[0m00:04:19.119348 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m00:04:19.121402 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-20 00:04:18.779824 => 2023-02-20 00:04:19.121334
[0m00:04:19.122655 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49ca43fd0>]}
[0m00:04:19.123160 [info ] [Thread-1  ]: 1 of 7 OK created sql table model sandbox.dim_zones ............................ [[32mOK[0m in 0.38s]
[0m00:04:19.124812 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m00:04:19.139340 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata__dbt_tmp 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_Flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:04:19.154060 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:04:19.157471 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:04:19.158132 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    case payment_type
        when 1 then 'Credit card'
        when 2 then 'Cash'
        when 3 then 'No charge'
        when 4 then 'Dispute'
        when 5 then 'Unknown'
        when 6 then 'Voided trip'
    end as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:04:19.165414 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m00:04:19.172720 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:04:19.175903 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:04:19.179773 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.180906 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata to sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m00:04:19.184897 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:04:19.188171 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:04:19.189441 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.190606 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:04:19.191646 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.194634 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata 
  
  ...
[0m00:04:19.202154 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.203336 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:04:19.207176 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:04:19.207703 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.212378 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m00:04:19.213609 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata__dbt_tmp to sandbox.stg_fhv_tripdata 
  
  ...
[0m00:04:19.215665 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.218712 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m00:04:19.225063 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.226306 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m00:04:19.227274 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.231241 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */
drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  ...
[0m00:04:19.232987 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.234173 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m00:04:19.241771 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:04:19.246461 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m00:04:19.247965 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.248362 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:04:19.252175 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m00:04:19.253813 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-20 00:04:18.772056 => 2023-02-20 00:04:19.253748
[0m00:04:19.255179 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49ca437c0>]}
[0m00:04:19.255717 [info ] [Thread-2  ]: 2 of 7 OK created sql view model sandbox.stg_fhv_tripdata ...................... [[32mOK[0m in 0.51s]
[0m00:04:19.256127 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:04:19.257107 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m00:04:19.257569 [info ] [Thread-1  ]: 5 of 7 START sql table model sandbox.fact_trips_fhv ............................ [RUN]
[0m00:04:19.258300 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m00:04:19.258681 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips_fhv)
[0m00:04:19.258999 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m00:04:19.262965 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:04:19.264378 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-20 00:04:19.259207 => 2023-02-20 00:04:19.264264
[0m00:04:19.264797 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m00:04:19.270688 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:04:19.272432 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:04:19.273916 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-20 00:04:18.910478 => 2023-02-20 00:04:19.273860
[0m00:04:19.274802 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49ca4e280>]}
[0m00:04:19.275331 [info ] [Thread-4  ]: 4 of 7 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.52s]
[0m00:04:19.275808 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:04:19.294961 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:04:19.298367 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

    select name, type from system.columns where table = 'fact_trips_fhv__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:04:19.309848 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.311977 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:04:19.314182 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

  
    
    
        
        insert into sandbox.fact_trips_fhv__dbt_backup ("fhv_data.tripid", "fhv_data.vendorid", "fhv_data.pickup_locationid", "pickup_borough", "pickup_zone", "fhv_data.dropoff_locationid", "dropoff_borough", "dropoff_zone", "fhv_data.pickup_datetime", "fhv_data.dropoff_datetime", "fhv_data.sr_flag")
  

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:04:19.342826 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:04:19.344053 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */
EXCHANGE TABLES sandbox.fact_trips_fhv__dbt_backup AND sandbox.fact_trips_fhv 
  
  ...
[0m00:04:19.354614 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:04:19.358695 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */
drop table if exists sandbox.fact_trips_fhv__dbt_backup 
  ...
[0m00:04:19.367066 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m00:04:19.368524 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-20 00:04:18.893910 => 2023-02-20 00:04:19.368444
[0m00:04:19.369146 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49ca43b80>]}
[0m00:04:19.369573 [info ] [Thread-3  ]: 3 of 7 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.62s]
[0m00:04:19.369901 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m00:04:19.370507 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:04:19.370883 [info ] [Thread-2  ]: 6 of 7 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:04:19.371577 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:04:19.371819 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:04:19.372058 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:04:19.376424 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:04:19.379014 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:04:19.372306 => 2023-02-20 00:04:19.378904
[0m00:04:19.379377 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:04:19.382566 [debug] [Thread-2  ]: Creating new relation fact_trips
[0m00:04:19.384276 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)
select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:04:19.406617 [debug] [Thread-2  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)
select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:04:19.407119 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:04:19.379574 => 2023-02-20 00:04:19.407002
[0m00:04:19.423882 [debug] [Thread-2  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:04:19.424379 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49c9e3d60>]}
[0m00:04:19.424860 [error] [Thread-2  ]: 6 of 7 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.05s]
[0m00:04:19.425276 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:04:19.426233 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:04:19.426652 [info ] [Thread-3  ]: 7 of 7 SKIP relation sandbox.dm_monthly_zone_revenue ........................... [[33mSKIP[0m]
[0m00:04:19.427115 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:04:19.470085 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m00:04:19.471727 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-20 00:04:19.265014 => 2023-02-20 00:04:19.471668
[0m00:04:19.472383 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41dc6aa3-f8d0-44ca-934b-990a98ad4bc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49cc47250>]}
[0m00:04:19.472836 [info ] [Thread-1  ]: 5 of 7 OK created sql table model sandbox.fact_trips_fhv ....................... [[32mOK[0m in 0.21s]
[0m00:04:19.473166 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m00:04:19.474654 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:04:19.475313 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:04:19.475580 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was left open.
[0m00:04:19.475819 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips_fhv: Close
[0m00:04:19.477537 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:04:19.477861 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:04:19.479809 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m00:04:19.480156 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m00:04:19.482340 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m00:04:19.482697 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m00:04:19.491864 [info ] [MainThread]: 
[0m00:04:19.492279 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 0 minutes and 1.30 seconds (1.30s).
[0m00:04:19.492853 [debug] [MainThread]: Command end result
[0m00:04:19.538102 [info ] [MainThread]: 
[0m00:04:19.538548 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:04:19.538892 [info ] [MainThread]: 
[0m00:04:19.539171 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:04:19.539418 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:04:19.539662 [error] [MainThread]:    Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:04:19.539928 [info ] [MainThread]: 
[0m00:04:19.540196 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m00:04:19.540590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49ca8f0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49ca9d5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb49c124a90>]}
[0m00:04:19.541066 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:07:45.559546 | b570cf75-8aa8-40a5-891b-39591650a710 ==============================
[0m00:07:45.559546 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:07:45.563998 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:07:45.564489 [debug] [MainThread]: Tracking: tracking
[0m00:07:45.630229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7952c8cf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7952d895e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7952d89370>]}
[0m00:07:45.975400 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:07:45.976426 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/dm_monthly_zone_revenue.sql
[0m00:07:46.001114 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m00:07:46.063163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b570cf75-8aa8-40a5-891b-39591650a710', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79532b7eb0>]}
[0m00:07:46.080309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b570cf75-8aa8-40a5-891b-39591650a710', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7953161d60>]}
[0m00:07:46.080898 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:07:46.081343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b570cf75-8aa8-40a5-891b-39591650a710', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7953161ee0>]}
[0m00:07:46.083673 [info ] [MainThread]: 
[0m00:07:46.086210 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:07:46.088309 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:07:46.105619 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:07:46.769541 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:07:46.786210 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:07:46.790589 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:07:46.791045 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:07:46.849108 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:07:46.862616 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:07:46.866746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b570cf75-8aa8-40a5-891b-39591650a710', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79531f8be0>]}
[0m00:07:46.867726 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:07:46.868146 [info ] [MainThread]: 
[0m00:07:46.878290 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:07:46.879390 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:07:46.880465 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:07:46.880804 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:07:46.881152 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:07:46.887506 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:07:46.890537 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:07:46.881405 => 2023-02-20 00:07:46.890358
[0m00:07:46.891239 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:07:46.964310 [debug] [Thread-1  ]: Creating new relation fact_trips
[0m00:07:47.020778 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)
select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:07:47.043116 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)
select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:07:47.043694 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:07:46.891583 => 2023-02-20 00:07:47.043586
[0m00:07:47.072827 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:07:47.073551 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b570cf75-8aa8-40a5-891b-39591650a710', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f795320c610>]}
[0m00:07:47.074228 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.19s]
[0m00:07:47.076101 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:07:47.078509 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:07:47.079446 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:07:47.079794 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:07:47.080144 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:07:47.083665 [info ] [MainThread]: 
[0m00:07:47.084213 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.00 seconds (1.00s).
[0m00:07:47.084764 [debug] [MainThread]: Command end result
[0m00:07:47.102316 [info ] [MainThread]: 
[0m00:07:47.102822 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:07:47.103193 [info ] [MainThread]: 
[0m00:07:47.103567 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:07:47.103941 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:07:47.104255 [error] [MainThread]:    Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:07:47.104581 [info ] [MainThread]: 
[0m00:07:47.104942 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:07:47.105433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79532ff9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79531da3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f79531da400>]}
[0m00:07:47.105906 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:08:12.004170 | ae99a39c-3581-48a6-9f1e-5c417951e4f3 ==============================
[0m00:08:12.004170 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:08:12.006580 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:08:12.006910 [debug] [MainThread]: Tracking: tracking
[0m00:08:12.048391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3686070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3686640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e36863d0>]}
[0m00:08:12.205662 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:08:12.206323 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:08:12.221909 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:08:12.256330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ae99a39c-3581-48a6-9f1e-5c417951e4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3a7c430>]}
[0m00:08:12.268918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ae99a39c-3581-48a6-9f1e-5c417951e4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3686910>]}
[0m00:08:12.269402 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:08:12.269752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae99a39c-3581-48a6-9f1e-5c417951e4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3686e50>]}
[0m00:08:12.271327 [info ] [MainThread]: 
[0m00:08:12.272987 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:08:12.274167 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:08:12.286470 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:08:12.878311 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:08:12.947879 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m00:08:12.954618 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:08:12.955403 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:08:13.012178 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:08:13.312601 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.30 seconds
[0m00:08:13.318888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae99a39c-3581-48a6-9f1e-5c417951e4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3a6d460>]}
[0m00:08:13.320205 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:08:13.320774 [info ] [MainThread]: 
[0m00:08:13.331413 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:08:13.332123 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:08:13.333118 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:08:13.333453 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:08:13.333787 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:08:13.339238 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:08:13.341309 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:08:13.334040 => 2023-02-20 00:08:13.341154
[0m00:08:13.341932 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:08:13.377319 [debug] [Thread-1  ]: Creating new relation fact_trips
[0m00:08:13.430111 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:08:13.455009 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:08:13.455565 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:08:13.342218 => 2023-02-20 00:08:13.455469
[0m00:08:13.469925 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:08:13.470420 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae99a39c-3581-48a6-9f1e-5c417951e4f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3a34820>]}
[0m00:08:13.470975 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.14s]
[0m00:08:13.474755 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:08:13.476783 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:08:13.477411 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:08:13.477664 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:08:13.477867 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:08:13.479733 [info ] [MainThread]: 
[0m00:08:13.480087 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.21 seconds (1.21s).
[0m00:08:13.480458 [debug] [MainThread]: Command end result
[0m00:08:13.491628 [info ] [MainThread]: 
[0m00:08:13.492392 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:08:13.492900 [info ] [MainThread]: 
[0m00:08:13.493292 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:08:13.493713 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:08:13.494133 [error] [MainThread]:    Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:08:13.494434 [info ] [MainThread]: 
[0m00:08:13.497718 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:08:13.498607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e4221e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3a4b820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4e3a3d160>]}
[0m00:08:13.499016 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:08:29.755404 | 7031a322-0d4b-4c70-a3d0-1cfcf5dda212 ==============================
[0m00:08:29.755404 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:08:29.758959 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:08:29.759459 [debug] [MainThread]: Tracking: tracking
[0m00:08:29.793984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848dc5fb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848dd6b580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848dd6b310>]}
[0m00:08:29.939010 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:08:29.939719 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:08:29.958796 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:08:29.999622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7031a322-0d4b-4c70-a3d0-1cfcf5dda212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848e144370>]}
[0m00:08:30.013876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7031a322-0d4b-4c70-a3d0-1cfcf5dda212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848dfef400>]}
[0m00:08:30.014371 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:08:30.014762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7031a322-0d4b-4c70-a3d0-1cfcf5dda212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848dfef460>]}
[0m00:08:30.016551 [info ] [MainThread]: 
[0m00:08:30.018448 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:08:30.019765 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:08:30.043572 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:08:30.749725 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:08:30.761658 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:08:30.765355 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:08:30.765744 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:08:30.819869 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:08:30.833410 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:08:30.837091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7031a322-0d4b-4c70-a3d0-1cfcf5dda212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848e1373a0>]}
[0m00:08:30.837987 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:08:30.838387 [info ] [MainThread]: 
[0m00:08:30.844243 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:08:30.844784 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:08:30.845684 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:08:30.846042 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:08:30.846395 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:08:30.851576 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:08:30.853009 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:08:30.846645 => 2023-02-20 00:08:30.852820
[0m00:08:30.853468 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:08:30.886581 [debug] [Thread-1  ]: Creating new relation fact_trips
[0m00:08:30.920203 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:08:30.942150 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:08:30.942743 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:08:30.853690 => 2023-02-20 00:08:30.942644
[0m00:08:30.958914 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:08:30.959492 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7031a322-0d4b-4c70-a3d0-1cfcf5dda212', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848e0ee250>]}
[0m00:08:30.960216 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.11s]
[0m00:08:30.962085 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:08:30.964226 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:08:30.965116 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:08:30.965389 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:08:30.965661 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:08:30.967916 [info ] [MainThread]: 
[0m00:08:30.968312 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.95 seconds (0.95s).
[0m00:08:30.968830 [debug] [MainThread]: Command end result
[0m00:08:30.984400 [info ] [MainThread]: 
[0m00:08:30.985052 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:08:30.985476 [info ] [MainThread]: 
[0m00:08:30.985944 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:08:30.986430 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:08:30.987100 [error] [MainThread]:    Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:08:30.987529 [info ] [MainThread]: 
[0m00:08:30.988025 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:08:30.988797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848ea083d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848dfef490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f848e07fee0>]}
[0m00:08:30.989249 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:08:48.554257 | f4c8140f-ca56-404b-b1ef-6423c5234ae2 ==============================
[0m00:08:48.554257 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:08:48.558643 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:08:48.559101 [debug] [MainThread]: Tracking: tracking
[0m00:08:48.596406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee40c6bb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee40d77580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee40d77310>]}
[0m00:08:48.805160 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:08:48.806004 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:08:48.830204 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:08:48.879270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f4c8140f-ca56-404b-b1ef-6423c5234ae2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee412bc370>]}
[0m00:08:48.896221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f4c8140f-ca56-404b-b1ef-6423c5234ae2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee41167400>]}
[0m00:08:48.896771 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:08:48.897250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f4c8140f-ca56-404b-b1ef-6423c5234ae2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee41167460>]}
[0m00:08:48.899382 [info ] [MainThread]: 
[0m00:08:48.901591 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:08:48.903400 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:08:48.921019 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:08:49.485201 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:08:49.501300 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:08:49.506363 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:08:49.506757 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:08:49.567194 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:08:49.583458 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:08:49.588009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f4c8140f-ca56-404b-b1ef-6423c5234ae2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee411f8ee0>]}
[0m00:08:49.588985 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:08:49.589416 [info ] [MainThread]: 
[0m00:08:49.599546 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:08:49.600477 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:08:49.601453 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:08:49.601797 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:08:49.602152 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:08:49.609428 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:08:49.611932 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:08:49.602428 => 2023-02-20 00:08:49.611661
[0m00:08:49.612413 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:08:49.659860 [debug] [Thread-1  ]: Creating new relation fact_trips
[0m00:08:49.730227 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:08:49.767245 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m00:08:49.780229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:08:49.799678 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:08:49.807328 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m00:08:49.809779 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips ("trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:09:20.367396 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 30.56 seconds
[0m00:09:20.412441 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:08:49.612809 => 2023-02-20 00:09:20.412354
[0m00:09:20.413361 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f4c8140f-ca56-404b-b1ef-6423c5234ae2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee41cee550>]}
[0m00:09:20.414079 [info ] [Thread-1  ]: 1 of 1 OK created sql table model sandbox.fact_trips ........................... [[32mOK[0m in 30.81s]
[0m00:09:20.415489 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:09:20.432469 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:09:20.433728 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:09:20.434467 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:09:20.434862 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:09:20.439272 [info ] [MainThread]: 
[0m00:09:20.442243 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 31.54 seconds (31.54s).
[0m00:09:20.445110 [debug] [MainThread]: Command end result
[0m00:09:20.496809 [info ] [MainThread]: 
[0m00:09:20.497335 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:09:20.497651 [info ] [MainThread]: 
[0m00:09:20.497917 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:09:20.498237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee41a4e3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee412b4e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fee40d121c0>]}
[0m00:09:20.498657 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:10:17.610668 | 67f27acd-e7d3-4e66-9f7f-27e6b1f0b1ac ==============================
[0m00:10:17.610668 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:10:17.615094 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:10:17.615432 [debug] [MainThread]: Tracking: tracking
[0m00:10:17.655888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec69d4a040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec69d4a610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec69d4a3a0>]}
[0m00:10:17.823551 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:10:17.824119 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:10:17.841908 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:10:17.878654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '67f27acd-e7d3-4e66-9f7f-27e6b1f0b1ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec6a13c400>]}
[0m00:10:17.891620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '67f27acd-e7d3-4e66-9f7f-27e6b1f0b1ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec69fe7490>]}
[0m00:10:17.892061 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:10:17.892518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67f27acd-e7d3-4e66-9f7f-27e6b1f0b1ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec69fe74f0>]}
[0m00:10:17.894995 [info ] [MainThread]: 
[0m00:10:17.896667 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:10:17.897777 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:10:17.910240 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:10:18.510012 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:10:18.521993 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:10:18.526679 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:10:18.526991 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:10:18.576930 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:10:18.591870 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:10:18.595445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67f27acd-e7d3-4e66-9f7f-27e6b1f0b1ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec6a1329d0>]}
[0m00:10:18.596152 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:10:18.596427 [info ] [MainThread]: 
[0m00:10:18.603531 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:10:18.603965 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:10:18.604648 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:10:18.604890 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:10:18.605142 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:10:18.609528 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:10:18.613090 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:10:18.605323 => 2023-02-20 00:10:18.612963
[0m00:10:18.613482 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:10:18.713663 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:10:18.748955 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:10:18.758112 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:10:18.770554 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:10:18.775840 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m00:10:18.777935 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:11:38.996381 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  
[0m00:11:38.999706 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:10:18.613737 => 2023-02-20 00:11:38.999383
[0m00:11:39.030245 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.00 GiB (attempt to allocate chunk of 4198377 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker. (MEMORY_LIMIT_EXCEEDED
  compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:11:39.031171 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67f27acd-e7d3-4e66-9f7f-27e6b1f0b1ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec6a0d78e0>]}
[0m00:11:39.032341 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 80.43s]
[0m00:11:39.035009 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:11:39.041227 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:11:39.042369 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:11:39.042934 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:11:39.043387 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:11:39.050378 [info ] [MainThread]: 
[0m00:11:39.051141 [info ] [MainThread]: Finished running 1 table model in 0 hours 1 minutes and 21.15 seconds (81.15s).
[0m00:11:39.052094 [debug] [MainThread]: Command end result
[0m00:11:39.075312 [info ] [MainThread]: 
[0m00:11:39.076005 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:11:39.076503 [info ] [MainThread]: 
[0m00:11:39.077002 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:11:39.077433 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:11:39.077859 [error] [MainThread]:    Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.00 GiB (attempt to allocate chunk of 4198377 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker. (MEMORY_LIMIT_EXCEEDED
[0m00:11:39.078314 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:11:39.078722 [info ] [MainThread]: 
[0m00:11:39.079180 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:11:39.080034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec6aac6460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec6aadf4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec6a132c70>]}
[0m00:11:39.080722 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:12:48.045729 | 20fc7ed6-e75d-4c55-80c3-33758e3b7764 ==============================
[0m00:12:48.045729 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:12:48.048834 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:12:48.049258 [debug] [MainThread]: Tracking: tracking
[0m00:12:48.072157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826d58cf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826d79d5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826d79d370>]}
[0m00:12:48.239526 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:12:48.240206 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:12:48.257781 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:12:48.293169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '20fc7ed6-e75d-4c55-80c3-33758e3b7764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826da833d0>]}
[0m00:12:48.307484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '20fc7ed6-e75d-4c55-80c3-33758e3b7764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826d92e460>]}
[0m00:12:48.307993 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:12:48.308388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20fc7ed6-e75d-4c55-80c3-33758e3b7764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826d92e4c0>]}
[0m00:12:48.310526 [info ] [MainThread]: 
[0m00:12:48.312962 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:12:48.314762 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:12:48.329582 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:12:49.054491 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:12:49.065723 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:12:49.068958 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:12:49.069365 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:12:49.118338 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:12:49.145680 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:12:49.149792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20fc7ed6-e75d-4c55-80c3-33758e3b7764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826da7cc70>]}
[0m00:12:49.150666 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:12:49.151034 [info ] [MainThread]: 
[0m00:12:49.160606 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:12:49.161767 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:12:49.162738 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:12:49.163079 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:12:49.163393 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:12:49.168309 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:12:49.171429 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:12:49.163595 => 2023-02-20 00:12:49.171288
[0m00:12:49.172010 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:12:49.218464 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
drop table if exists sandbox.fact_trips__dbt_backup 
  ...
[0m00:12:49.237484 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:12:49.281782 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:12:49.319718 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m00:12:49.331058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:12:49.354708 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:12:49.359630 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m00:12:49.363970 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:14:52.978201 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  
[0m00:14:52.979918 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:12:49.172265 => 2023-02-20 00:14:52.979804
[0m00:14:53.005873 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.00 GiB (attempt to allocate chunk of 4320634 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker. (MEMORY_LIMIT_EXCEEDED
  compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:14:53.006355 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20fc7ed6-e75d-4c55-80c3-33758e3b7764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826da6e130>]}
[0m00:14:53.006845 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 123.84s]
[0m00:14:53.008249 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:14:53.011868 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:14:53.012504 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:14:53.012729 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:14:53.012955 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:14:53.017116 [info ] [MainThread]: 
[0m00:14:53.017529 [info ] [MainThread]: Finished running 1 table model in 0 hours 2 minutes and 4.71 seconds (124.71s).
[0m00:14:53.017913 [debug] [MainThread]: Command end result
[0m00:14:53.035272 [info ] [MainThread]: 
[0m00:14:53.035716 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:14:53.036039 [info ] [MainThread]: 
[0m00:14:53.036366 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:14:53.036631 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:14:53.036877 [error] [MainThread]:    Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.00 GiB (attempt to allocate chunk of 4320634 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker. (MEMORY_LIMIT_EXCEEDED
[0m00:14:53.037273 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:14:53.037746 [info ] [MainThread]: 
[0m00:14:53.038152 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:14:53.038696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826e213430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826e2aaaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f826da7cc40>]}
[0m00:14:53.039035 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:15:08.021846 | 307bff95-b4cd-4543-9c14-bc1184df153a ==============================
[0m00:15:08.021846 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:15:08.024362 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:15:08.024843 [debug] [MainThread]: Tracking: tracking
[0m00:15:08.063054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88ead63f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88eae5c5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88eae5c370>]}
[0m00:15:08.227263 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m00:15:08.228211 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://macros/get_payment_type_description.sql
[0m00:15:08.228482 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:15:08.243480 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m00:15:08.257101 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:15:08.260749 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m00:15:08.266721 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m00:15:08.268252 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m00:15:08.273634 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m00:15:08.385234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '307bff95-b4cd-4543-9c14-bc1184df153a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88eb2b1430>]}
[0m00:15:08.398477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '307bff95-b4cd-4543-9c14-bc1184df153a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88eb1d9e20>]}
[0m00:15:08.398915 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:15:08.399328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '307bff95-b4cd-4543-9c14-bc1184df153a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88eb1eb6a0>]}
[0m00:15:08.401220 [info ] [MainThread]: 
[0m00:15:08.403093 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:15:08.404400 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:15:08.417223 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:15:10.305710 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:15:10.320992 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:15:10.328459 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:15:10.329168 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:15:10.340691 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:15:10.373294 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:15:10.380945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '307bff95-b4cd-4543-9c14-bc1184df153a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88ead5a5b0>]}
[0m00:15:10.382340 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:15:10.382982 [info ] [MainThread]: 
[0m00:15:10.395579 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:15:10.396217 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:15:10.397199 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:15:10.397492 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:15:10.397795 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:15:10.404333 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:15:10.407793 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:15:10.398022 => 2023-02-20 00:15:10.407608
[0m00:15:10.408224 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:15:10.444452 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
drop table if exists sandbox.fact_trips__dbt_backup 
  ...
[0m00:15:10.460339 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:15:10.487736 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:15:10.521238 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:15:10.521674 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:15:10.408466 => 2023-02-20 00:15:10.521577
[0m00:15:10.537317 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:15:10.537816 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '307bff95-b4cd-4543-9c14-bc1184df153a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88ebbf7820>]}
[0m00:15:10.538258 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.14s]
[0m00:15:10.539723 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:15:10.541051 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:15:10.541596 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:15:10.541775 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:15:10.541960 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:15:10.543705 [info ] [MainThread]: 
[0m00:15:10.543977 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.14 seconds (2.14s).
[0m00:15:10.544299 [debug] [MainThread]: Command end result
[0m00:15:10.555403 [info ] [MainThread]: 
[0m00:15:10.555974 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:15:10.556283 [info ] [MainThread]: 
[0m00:15:10.556546 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:15:10.556778 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:15:10.557046 [error] [MainThread]:    Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:15:10.557257 [info ] [MainThread]: 
[0m00:15:10.557478 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:15:10.557839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88eb1d9760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88ead51730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f88eb120910>]}
[0m00:15:10.558177 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:17:47.891198 | b3a45fff-e306-472f-936d-d4d5468ad8a5 ==============================
[0m00:17:47.891198 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:17:47.894226 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:17:47.894624 [debug] [MainThread]: Tracking: tracking
[0m00:17:47.918559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d1268cb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d12798580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d12798310>]}
[0m00:17:48.189879 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m00:17:48.191460 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_yellow_tripdata.sql
[0m00:17:48.192357 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://macros/get_payment_type_description.sql
[0m00:17:48.193002 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/staging/stg_green_tripdata.sql
[0m00:17:48.215845 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m00:17:48.237221 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m00:17:48.241869 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m00:17:48.245496 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:17:48.248774 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m00:17:48.255196 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m00:17:48.387287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b3a45fff-e306-472f-936d-d4d5468ad8a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d12aa4190>]}
[0m00:17:48.401646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b3a45fff-e306-472f-936d-d4d5468ad8a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d12a6abe0>]}
[0m00:17:48.402098 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:17:48.402459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3a45fff-e306-472f-936d-d4d5468ad8a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d129cd8b0>]}
[0m00:17:48.404357 [info ] [MainThread]: 
[0m00:17:48.406938 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:17:48.408371 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:17:48.426313 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:17:49.219842 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:17:49.235482 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:17:49.240195 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:17:49.240654 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:17:49.248654 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:17:49.269833 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:17:49.274865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3a45fff-e306-472f-936d-d4d5468ad8a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d129e4d30>]}
[0m00:17:49.275997 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:17:49.276516 [info ] [MainThread]: 
[0m00:17:49.286386 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:17:49.287055 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:17:49.288013 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:17:49.288342 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:17:49.288611 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:17:49.294281 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:17:49.297692 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:17:49.288825 => 2023-02-20 00:17:49.297515
[0m00:17:49.298047 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:17:49.364684 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:17:49.397701 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:17:49.398272 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:17:49.298252 => 2023-02-20 00:17:49.398147
[0m00:17:49.417211 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:17:49.417869 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3a45fff-e306-472f-936d-d4d5468ad8a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d132de100>]}
[0m00:17:49.418627 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.13s]
[0m00:17:49.420745 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:17:49.423309 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:17:49.424064 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:17:49.424482 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:17:49.424869 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:17:49.427997 [info ] [MainThread]: 
[0m00:17:49.428446 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.02 seconds (1.02s).
[0m00:17:49.428948 [debug] [MainThread]: Command end result
[0m00:17:49.443992 [info ] [MainThread]: 
[0m00:17:49.444567 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:17:49.445190 [info ] [MainThread]: 
[0m00:17:49.445543 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:17:49.445997 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:17:49.446288 [error] [MainThread]:    Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:17:49.446548 [info ] [MainThread]: 
[0m00:17:49.446808 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:17:49.447223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d131d3e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d132c9f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8d132c9910>]}
[0m00:17:49.447597 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:18:17.616131 | 01e6bbed-c607-43dc-a1c3-34fed48856e5 ==============================
[0m00:18:17.616131 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:18:17.618966 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:18:17.619315 [debug] [MainThread]: Tracking: tracking
[0m00:18:17.649347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c48cf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c5955b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c595340>]}
[0m00:18:17.802950 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:18:17.803602 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:18:17.821510 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:18:17.855088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01e6bbed-c607-43dc-a1c3-34fed48856e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c97e3a0>]}
[0m00:18:17.867839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01e6bbed-c607-43dc-a1c3-34fed48856e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c8b8fd0>]}
[0m00:18:17.868346 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:18:17.868670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01e6bbed-c607-43dc-a1c3-34fed48856e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c547100>]}
[0m00:18:17.870229 [info ] [MainThread]: 
[0m00:18:17.871912 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:18:17.873050 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:18:17.885729 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:18:18.578283 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:18:18.591087 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:18:18.594415 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:18:18.594841 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:18:18.644122 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:18:18.658474 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:18:18.661912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01e6bbed-c607-43dc-a1c3-34fed48856e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c8b8bb0>]}
[0m00:18:18.662691 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:18:18.663041 [info ] [MainThread]: 
[0m00:18:18.670647 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:18:18.671132 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:18:18.671863 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:18:18.672138 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:18:18.672403 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:18:18.677443 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:18:18.679498 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:18:18.672609 => 2023-02-20 00:18:18.679250
[0m00:18:18.679897 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:18:18.736194 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    trips_unioned.payment_type_description --, 
    -- trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:18:18.757693 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    trips_unioned.payment_type_description --, 
    -- trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:18:18.758096 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:18:18.680101 => 2023-02-20 00:18:18.758009
[0m00:18:18.775447 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:18:18.776036 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01e6bbed-c607-43dc-a1c3-34fed48856e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c97aac0>]}
[0m00:18:18.776521 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.10s]
[0m00:18:18.778097 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:18:18.780203 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:18:18.781059 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:18:18.781336 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:18:18.781556 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:18:18.783601 [info ] [MainThread]: 
[0m00:18:18.783979 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.91 seconds (0.91s).
[0m00:18:18.784346 [debug] [MainThread]: Command end result
[0m00:18:18.796220 [info ] [MainThread]: 
[0m00:18:18.796626 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:18:18.796888 [info ] [MainThread]: 
[0m00:18:18.797113 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:18:18.797331 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:18:18.797535 [error] [MainThread]:    Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:18:18.797750 [info ] [MainThread]: 
[0m00:18:18.798014 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:18:18.798384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820d345400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c547190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f820c93fac0>]}
[0m00:18:18.798696 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:18:35.804850 | 729f70fa-c46d-45a7-9582-92a94cdee188 ==============================
[0m00:18:35.804850 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:18:35.808179 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:18:35.808640 [debug] [MainThread]: Tracking: tracking
[0m00:18:35.857084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9ec8cf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9ed945b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9ed94340>]}
[0m00:18:36.055785 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:18:36.056644 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:18:36.079190 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:18:36.120621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '729f70fa-c46d-45a7-9582-92a94cdee188', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9f17e3a0>]}
[0m00:18:36.137478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '729f70fa-c46d-45a7-9582-92a94cdee188', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9f028490>]}
[0m00:18:36.137987 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:18:36.138428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '729f70fa-c46d-45a7-9582-92a94cdee188', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9f028460>]}
[0m00:18:36.140301 [info ] [MainThread]: 
[0m00:18:36.142095 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:18:36.143558 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:18:36.158160 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:18:36.899565 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:18:36.912517 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:18:36.916503 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:18:36.916837 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:18:36.970294 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:18:36.985372 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:18:36.989238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '729f70fa-c46d-45a7-9582-92a94cdee188', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9f0b86d0>]}
[0m00:18:36.990122 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:18:36.990478 [info ] [MainThread]: 
[0m00:18:37.000843 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:18:37.001372 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:18:37.002270 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:18:37.002588 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:18:37.002895 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:18:37.008317 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:18:37.009764 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:18:37.003147 => 2023-02-20 00:18:37.009594
[0m00:18:37.010269 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:18:37.108948 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    -- trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:18:37.136242 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    -- trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:18:37.136724 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:18:37.010560 => 2023-02-20 00:18:37.136626
[0m00:18:37.158969 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
   Code: 62. DB::Exception: Syntax error: failed at position 1804 ('trips_unioned') (line 71, col 6): trips_unioned
  inner join dim_zones as pickup_zone
  on trips_unioned.pickup_locationid = pickup_zone.locationid
  inner join dim_zones as dropoff
[0m00:18:37.159565 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '729f70fa-c46d-45a7-9582-92a94cdee188', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9f1640a0>]}
[0m00:18:37.160111 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.16s]
[0m00:18:37.161921 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:18:37.164105 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:18:37.164822 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:18:37.165080 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:18:37.165330 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:18:37.167722 [info ] [MainThread]: 
[0m00:18:37.168175 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.03 seconds (1.03s).
[0m00:18:37.168642 [debug] [MainThread]: Command end result
[0m00:18:37.186541 [info ] [MainThread]: 
[0m00:18:37.187233 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:18:37.187663 [info ] [MainThread]: 
[0m00:18:37.188249 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:18:37.188699 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
[0m00:18:37.189310 [error] [MainThread]:    Code: 62. DB::Exception: Syntax error: failed at position 1804 ('trips_unioned') (line 71, col 6): trips_unioned
[0m00:18:37.189685 [error] [MainThread]:   inner join dim_zones as pickup_zone
[0m00:18:37.190102 [error] [MainThread]:   on trips_unioned.pickup_locationid = pickup_zone.locationid
[0m00:18:37.190472 [error] [MainThread]:   inner join dim_zones as dropoff
[0m00:18:37.190957 [info ] [MainThread]: 
[0m00:18:37.191400 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:18:37.191956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9fb46400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9f0b8fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcd9f1332e0>]}
[0m00:18:37.192441 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:19:51.922811 | b207c841-b734-4432-a6e7-334e3b8091c9 ==============================
[0m00:19:51.922811 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:19:51.926053 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:19:51.926898 [debug] [MainThread]: Tracking: tracking
[0m00:19:51.957209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3ae8a070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3ae8a640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3ae8a3d0>]}
[0m00:19:52.124918 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:19:52.125610 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:19:52.144109 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:19:52.179537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b207c841-b734-4432-a6e7-334e3b8091c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3b16d430>]}
[0m00:19:52.192545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b207c841-b734-4432-a6e7-334e3b8091c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3b0194c0>]}
[0m00:19:52.194709 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:19:52.195152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b207c841-b734-4432-a6e7-334e3b8091c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3b019520>]}
[0m00:19:52.197171 [info ] [MainThread]: 
[0m00:19:52.198866 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:19:52.200096 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:19:52.212306 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:19:52.887674 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:19:52.900727 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:19:52.904084 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:19:52.904491 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:19:52.952699 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:19:52.967780 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:19:52.971074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b207c841-b734-4432-a6e7-334e3b8091c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3b16db80>]}
[0m00:19:52.971726 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:19:52.972005 [info ] [MainThread]: 
[0m00:19:52.980754 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:19:52.981311 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:19:52.982056 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:19:52.982366 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:19:52.982689 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:19:52.987506 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:19:52.990480 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:19:52.983000 => 2023-02-20 00:19:52.990331
[0m00:19:52.990835 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:19:53.045983 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    -- trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:19:53.058912 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    -- trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    -- trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:19:53.059388 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:19:52.991060 => 2023-02-20 00:19:53.059286
[0m00:19:53.077846 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
   Code: 62. DB::Exception: Syntax error: failed at position 1807 ('trips_unioned') (line 71, col 6): trips_unioned
  inner join dim_zones as pickup_zone
  on trips_unioned.pickup_locationid = pickup_zone.locationid
  inner join dim_zones as dropoff
[0m00:19:53.078690 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b207c841-b734-4432-a6e7-334e3b8091c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3b152100>]}
[0m00:19:53.079263 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.10s]
[0m00:19:53.080515 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:19:53.082118 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:19:53.082667 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:19:53.082876 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:19:53.083063 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:19:53.084983 [info ] [MainThread]: 
[0m00:19:53.085342 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.89 seconds (0.89s).
[0m00:19:53.085702 [debug] [MainThread]: Command end result
[0m00:19:53.097320 [info ] [MainThread]: 
[0m00:19:53.097699 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:19:53.097949 [info ] [MainThread]: 
[0m00:19:53.098173 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:19:53.098380 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 400)
[0m00:19:53.098579 [error] [MainThread]:    Code: 62. DB::Exception: Syntax error: failed at position 1807 ('trips_unioned') (line 71, col 6): trips_unioned
[0m00:19:53.098760 [error] [MainThread]:   inner join dim_zones as pickup_zone
[0m00:19:53.098940 [error] [MainThread]:   on trips_unioned.pickup_locationid = pickup_zone.locationid
[0m00:19:53.099124 [error] [MainThread]:   inner join dim_zones as dropoff
[0m00:19:53.099341 [info ] [MainThread]: 
[0m00:19:53.099573 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:19:53.099877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3b1a2400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3b019550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9a3b12eac0>]}
[0m00:19:53.100157 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:20:20.904791 | cee507d7-106a-4d9b-8733-8789c22b2e11 ==============================
[0m00:20:20.904791 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:20:20.908784 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:20:20.909230 [debug] [MainThread]: Tracking: tracking
[0m00:20:20.961408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e55a2f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e57ad5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e57ad340>]}
[0m00:20:21.196811 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:20:21.197702 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:20:21.221095 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:20:21.264043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cee507d7-106a-4d9b-8733-8789c22b2e11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e5bbd3a0>]}
[0m00:20:21.279571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cee507d7-106a-4d9b-8733-8789c22b2e11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e5a68430>]}
[0m00:20:21.280125 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:20:21.280556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cee507d7-106a-4d9b-8733-8789c22b2e11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e5a68490>]}
[0m00:20:21.282594 [info ] [MainThread]: 
[0m00:20:21.284672 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:20:21.286096 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:20:21.302772 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:23.388329 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:20:23.401383 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:20:23.406315 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:20:23.406720 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:20:23.462038 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:20:23.475924 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:20:23.493104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cee507d7-106a-4d9b-8733-8789c22b2e11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e5af9eb0>]}
[0m00:20:23.493970 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:20:23.494367 [info ] [MainThread]: 
[0m00:20:23.503273 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:20:23.503813 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:20:23.504581 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:20:23.504854 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:20:23.505120 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:20:23.510604 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:20:23.532114 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:20:23.505311 => 2023-02-20 00:20:23.531855
[0m00:20:23.532518 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:20:23.602207 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:20:23.641398 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:20:23.673176 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:20:23.707396 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:20:23.717345 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m00:20:23.734738 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.total_amount", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    -- trips_unioned.tripid, 
    -- trips_unioned.vendorid, 
    -- trips_unioned.service_type,
    -- trips_unioned.ratecodeid, 
    -- trips_unioned.pickup_locationid, 
    -- pickup_zone.borough as pickup_borough, 
    -- pickup_zone.zone as pickup_zone, 
    -- trips_unioned.dropoff_locationid,
    -- dropoff_zone.borough as dropoff_borough, 
    -- dropoff_zone.zone as dropoff_zone,  
    -- trips_unioned.pickup_datetime, 
    -- trips_unioned.dropoff_datetime, 
    -- trips_unioned.store_and_fwd_flag, 
    -- trips_unioned.passenger_count, 
    -- trips_unioned.trip_distance, 
    -- trips_unioned.trip_type, 
    -- trips_unioned.fare_amount, 
    -- trips_unioned.extra, 
    -- trips_unioned.mta_tax, 
    -- trips_unioned.tip_amount, 
    -- trips_unioned.tolls_amount, 
    -- trips_unioned.ehail_fee, 
    -- trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:21:28.716403 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 64.98 seconds
[0m00:21:28.720195 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
EXCHANGE TABLES sandbox.fact_trips__dbt_backup AND sandbox.fact_trips 
  
  ...
[0m00:21:28.731620 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:21:28.756093 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
drop table if exists sandbox.fact_trips__dbt_backup 
  ...
[0m00:21:28.870666 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m00:21:28.872013 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:20:23.532746 => 2023-02-20 00:21:28.871962
[0m00:21:28.872612 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cee507d7-106a-4d9b-8733-8789c22b2e11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e5b0bd90>]}
[0m00:21:28.873078 [info ] [Thread-1  ]: 1 of 1 OK created sql table model sandbox.fact_trips ........................... [[32mOK[0m in 65.37s]
[0m00:21:28.874908 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:21:28.876456 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:21:28.877077 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:21:28.877309 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:21:28.877506 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:21:28.879373 [info ] [MainThread]: 
[0m00:21:28.879760 [info ] [MainThread]: Finished running 1 table model in 0 hours 1 minutes and 7.60 seconds (67.60s).
[0m00:21:28.880174 [debug] [MainThread]: Command end result
[0m00:21:28.891642 [info ] [MainThread]: 
[0m00:21:28.892080 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:21:28.892389 [info ] [MainThread]: 
[0m00:21:28.892665 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:21:28.893022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e634b400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e5bb8ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa1e570a7f0>]}
[0m00:21:28.893363 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:23:45.192573 | a7d7ae0d-6f77-44cd-b89f-f08b36e6c1f7 ==============================
[0m00:23:45.192573 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:23:45.195777 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:23:45.196141 [debug] [MainThread]: Tracking: tracking
[0m00:23:45.282451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a658cf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a66965b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a6696340>]}
[0m00:23:45.453186 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:23:45.453991 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:23:45.474192 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:23:45.515924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7d7ae0d-6f77-44cd-b89f-f08b36e6c1f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a6a7d3a0>]}
[0m00:23:45.530356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7d7ae0d-6f77-44cd-b89f-f08b36e6c1f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a6927430>]}
[0m00:23:45.530765 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:23:45.531094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7d7ae0d-6f77-44cd-b89f-f08b36e6c1f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a6927490>]}
[0m00:23:45.532785 [info ] [MainThread]: 
[0m00:23:45.534638 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:23:45.535805 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:23:45.548915 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:23:46.257226 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:23:46.270548 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:23:46.273785 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:23:46.274117 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:23:46.321307 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:23:46.335501 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:23:46.338656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7d7ae0d-6f77-44cd-b89f-f08b36e6c1f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a6a765b0>]}
[0m00:23:46.339499 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:23:46.339823 [info ] [MainThread]: 
[0m00:23:46.347637 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:23:46.348230 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:23:46.348824 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:23:46.349040 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:23:46.349271 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:23:46.352980 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:23:46.356461 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:23:46.349448 => 2023-02-20 00:23:46.356259
[0m00:23:46.356788 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:23:46.408734 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:23:46.437744 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:23:46.448126 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:23:46.461670 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:23:46.466875 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m00:23:46.470352 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:25:50.155274 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  
[0m00:25:50.157007 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:23:46.356946 => 2023-02-20 00:25:50.156792
[0m00:25:50.179484 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  Error HTTPSConnectionPool(host='c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net', port=8443): Max retries exceeded with url: /?session_id=dbt%3A%3Ac929f73b-2fec-46c3-87a5-96e07e83e12a&mutations_sync=2&database=sandbox (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7fb3a7489790>: Failed to establish a new connection: [Errno 61] Connection refused')) executing HTTP request https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443
  compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:25:50.180194 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7d7ae0d-6f77-44cd-b89f-f08b36e6c1f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a7481430>]}
[0m00:25:50.181135 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 123.83s]
[0m00:25:50.183112 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:25:50.186493 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:25:50.187258 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:25:50.187577 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:25:50.187947 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:25:50.188407 [info ] [MainThread]: 
[0m00:25:50.188812 [info ] [MainThread]: Finished running 1 table model in 0 hours 2 minutes and 4.66 seconds (124.66s).
[0m00:25:50.189306 [debug] [MainThread]: Command end result
[0m00:25:50.212751 [info ] [MainThread]: 
[0m00:25:50.213272 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:25:50.213853 [info ] [MainThread]: 
[0m00:25:50.214267 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:25:50.214568 [error] [MainThread]:   Error HTTPSConnectionPool(host='c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net', port=8443): Max retries exceeded with url: /?session_id=dbt%3A%3Ac929f73b-2fec-46c3-87a5-96e07e83e12a&mutations_sync=2&database=sandbox (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7fb3a7489790>: Failed to establish a new connection: [Errno 61] Connection refused')) executing HTTP request https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443
[0m00:25:50.214847 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:25:50.215118 [info ] [MainThread]: 
[0m00:25:50.215402 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:25:50.215810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a6927460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a69b9c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb3a6a1f2b0>]}
[0m00:25:50.216203 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:28:10.340015 | c9a6fa8d-b01c-4b5f-a0af-2be60bb13492 ==============================
[0m00:28:10.340015 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:28:10.342967 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:28:10.343369 [debug] [MainThread]: Tracking: tracking
[0m00:28:10.368424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed17d62b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed17e6e580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed17e6e310>]}
[0m00:28:10.525403 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:28:10.526022 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:28:10.541294 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:28:10.575966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c9a6fa8d-b01c-4b5f-a0af-2be60bb13492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed18145370>]}
[0m00:28:10.587844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c9a6fa8d-b01c-4b5f-a0af-2be60bb13492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed17fef400>]}
[0m00:28:10.588350 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:28:10.588760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c9a6fa8d-b01c-4b5f-a0af-2be60bb13492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed17fef460>]}
[0m00:28:10.590581 [info ] [MainThread]: 
[0m00:28:10.592351 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:28:10.593819 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:28:10.609513 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:28:11.166912 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:28:11.180786 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:28:11.188274 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:28:11.188973 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:28:11.245338 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:28:11.259946 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:28:11.264456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c9a6fa8d-b01c-4b5f-a0af-2be60bb13492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed1813ef40>]}
[0m00:28:11.265389 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:28:11.265791 [info ] [MainThread]: 
[0m00:28:11.274950 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:28:11.275477 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:28:11.276381 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:28:11.276766 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:28:11.277330 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:28:11.282493 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:28:11.285465 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:28:11.277736 => 2023-02-20 00:28:11.285206
[0m00:28:11.285809 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:28:11.320938 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
drop table if exists sandbox.fact_trips__dbt_backup 
  ...
[0m00:28:11.436365 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m00:28:11.475281 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:28:11.506201 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    -- trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        
[0m00:28:11.507319 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:28:11.285985 => 2023-02-20 00:28:11.507150
[0m00:28:11.519001 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:28:11.519691 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c9a6fa8d-b01c-4b5f-a0af-2be60bb13492', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed17f97250>]}
[0m00:28:11.520429 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 0.24s]
[0m00:28:11.524739 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:28:11.526950 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:28:11.527752 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:28:11.528334 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:28:11.528704 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:28:11.531837 [info ] [MainThread]: 
[0m00:28:11.532531 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.94 seconds (0.94s).
[0m00:28:11.533266 [debug] [MainThread]: Command end result
[0m00:28:11.547725 [info ] [MainThread]: 
[0m00:28:11.548478 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:28:11.548849 [info ] [MainThread]: 
[0m00:28:11.549296 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:28:11.549716 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:28:11.550166 [error] [MainThread]:    Code: 370. DB::Exception: Data type Nullable(Nothing) cannot be used in tables. (DATA_TYPE_CANNOT_BE_USED_IN_TABLES) (version 22.8.13.20 (official build))
[0m00:28:11.550522 [info ] [MainThread]: 
[0m00:28:11.550824 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:28:11.551323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed18a083d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed1813ebe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fed17fef430>]}
[0m00:28:11.551689 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:28:31.221703 | e3c41230-6782-49c6-beab-24dcf61c5ab3 ==============================
[0m00:28:31.221703 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:28:31.224825 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:28:31.225225 [debug] [MainThread]: Tracking: tracking
[0m00:28:31.245826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c1da3f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c1ead5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c1ead340>]}
[0m00:28:31.354535 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:28:31.355278 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:28:31.370667 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:28:31.400402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e3c41230-6782-49c6-beab-24dcf61c5ab3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c22be3a0>]}
[0m00:28:31.412078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e3c41230-6782-49c6-beab-24dcf61c5ab3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c202f430>]}
[0m00:28:31.412519 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:28:31.412821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3c41230-6782-49c6-beab-24dcf61c5ab3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c202f490>]}
[0m00:28:31.414427 [info ] [MainThread]: 
[0m00:28:31.416028 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:28:31.417223 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:28:31.430170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:28:31.895270 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:28:31.909802 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:28:31.917014 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:28:31.917623 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:28:31.973743 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:28:31.987355 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:28:31.990916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3c41230-6782-49c6-beab-24dcf61c5ab3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c20bfeb0>]}
[0m00:28:31.991712 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:28:31.992011 [info ] [MainThread]: 
[0m00:28:31.997366 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:28:31.997804 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:28:31.998398 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:28:31.998583 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:28:31.998784 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:28:32.002586 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:28:32.004067 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:28:31.998930 => 2023-02-20 00:28:32.003946
[0m00:28:32.004412 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:28:32.061212 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:28:32.095707 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:28:32.113467 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:28:32.128162 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:28:32.137595 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m00:28:32.143472 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:30:22.272983 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  
[0m00:30:22.273493 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:28:32.004597 => 2023-02-20 00:30:22.273374
[0m00:30:22.289104 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.02 GiB (attempt to allocate chunk of 4222954 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker.: (while reading column
  compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:30:22.289598 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3c41230-6782-49c6-beab-24dcf61c5ab3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c226c5b0>]}
[0m00:30:22.290107 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 110.29s]
[0m00:30:22.291879 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:30:22.294497 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:30:22.295351 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:30:22.295752 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:30:22.296017 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:30:22.298263 [info ] [MainThread]: 
[0m00:30:22.298747 [info ] [MainThread]: Finished running 1 table model in 0 hours 1 minutes and 50.88 seconds (110.88s).
[0m00:30:22.299211 [debug] [MainThread]: Command end result
[0m00:30:22.311668 [info ] [MainThread]: 
[0m00:30:22.312245 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:30:22.312633 [info ] [MainThread]: 
[0m00:30:22.313401 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:30:22.313904 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:30:22.314590 [error] [MainThread]:    Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.02 GiB (attempt to allocate chunk of 4222954 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker.: (while reading column
[0m00:30:22.314924 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:30:22.315214 [info ] [MainThread]: 
[0m00:30:22.315526 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:30:22.315939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c2b4b400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c1e4a1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff6c2d32cd0>]}
[0m00:30:22.316296 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:30:36.299839 | 3df63249-398c-47a3-a292-880bc31209d6 ==============================
[0m00:30:36.299839 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:30:36.302019 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'parse_only': False, 'which': 'compile', 'rpc_method': 'compile', 'indirect_selection': 'eager'}
[0m00:30:36.302362 [debug] [MainThread]: Tracking: tracking
[0m00:30:36.320938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa74748cb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7475965e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa747596160>]}
[0m00:30:36.433525 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:30:36.433887 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:30:36.442483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3df63249-398c-47a3-a292-880bc31209d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7478e6970>]}
[0m00:30:36.454273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3df63249-398c-47a3-a292-880bc31209d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7477dc310>]}
[0m00:30:36.454812 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:30:36.455194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3df63249-398c-47a3-a292-880bc31209d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7477dc2e0>]}
[0m00:30:36.457367 [info ] [MainThread]: 
[0m00:30:36.459184 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:30:36.461017 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:30:36.474546 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:30:37.057879 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:30:37.075096 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:30:37.084636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3df63249-398c-47a3-a292-880bc31209d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa747536b50>]}
[0m00:30:37.085951 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:30:37.086509 [info ] [MainThread]: 
[0m00:30:37.099087 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:30:37.099745 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m00:30:37.100773 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m00:30:37.101319 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:30:37.102301 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m00:30:37.102674 [debug] [Thread-4  ]: Began running node seed.taxi_rides_ny.taxi_zone_lookup
[0m00:30:37.102940 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.stg_fhv_tripdata)
[0m00:30:37.103752 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m00:30:37.104069 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m00:30:37.104737 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'seed.taxi_rides_ny.taxi_zone_lookup'
[0m00:30:37.105188 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:30:37.105748 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:30:37.113563 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:30:37.113860 [debug] [Thread-4  ]: Began compiling node seed.taxi_rides_ny.taxi_zone_lookup
[0m00:30:37.118252 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:30:37.123614 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:30:37.125935 [debug] [Thread-4  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (compile): 2023-02-20 00:30:37.124085 => 2023-02-20 00:30:37.125837
[0m00:30:37.126607 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-20 00:30:37.106157 => 2023-02-20 00:30:37.126539
[0m00:30:37.127029 [debug] [Thread-4  ]: Began executing node seed.taxi_rides_ny.taxi_zone_lookup
[0m00:30:37.127370 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m00:30:37.127755 [debug] [Thread-4  ]: Timing info for seed.taxi_rides_ny.taxi_zone_lookup (execute): 2023-02-20 00:30:37.127649 => 2023-02-20 00:30:37.127675
[0m00:30:37.128092 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-20 00:30:37.128034 => 2023-02-20 00:30:37.128044
[0m00:30:37.129916 [debug] [Thread-4  ]: Finished running node seed.taxi_rides_ny.taxi_zone_lookup
[0m00:30:37.130115 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-20 00:30:37.118652 => 2023-02-20 00:30:37.130073
[0m00:30:37.130260 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-20 00:30:37.114086 => 2023-02-20 00:30:37.130227
[0m00:30:37.130826 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m00:30:37.131123 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:30:37.131657 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.dim_zones
[0m00:30:37.131874 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:30:37.132176 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-20 00:30:37.132131 => 2023-02-20 00:30:37.132139
[0m00:30:37.133063 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m00:30:37.133352 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m00:30:37.133551 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-20 00:30:37.133508 => 2023-02-20 00:30:37.133515
[0m00:30:37.134013 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:30:37.134234 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m00:30:37.134711 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854'
[0m00:30:37.135501 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:30:37.135917 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m00:30:37.139051 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m00:30:37.139826 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m00:30:37.140188 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m00:30:37.140752 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b'
[0m00:30:37.154684 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854"
[0m00:30:37.155322 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22'
[0m00:30:37.155546 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-20 00:30:37.136104 => 2023-02-20 00:30:37.155495
[0m00:30:37.155907 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m00:30:37.156236 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22)
[0m00:30:37.156521 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m00:30:37.165959 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b"
[0m00:30:37.166389 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m00:30:37.166931 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-20 00:30:37.166791 => 2023-02-20 00:30:37.166840
[0m00:30:37.167448 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854 (compile): 2023-02-20 00:30:37.141178 => 2023-02-20 00:30:37.167385
[0m00:30:37.176915 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22"
[0m00:30:37.177728 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m00:30:37.178343 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m00:30:37.178947 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b (compile): 2023-02-20 00:30:37.156691 => 2023-02-20 00:30:37.178813
[0m00:30:37.179418 [debug] [Thread-4  ]: Began running node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m00:30:37.179919 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854 (execute): 2023-02-20 00:30:37.179805 => 2023-02-20 00:30:37.179821
[0m00:30:37.180629 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m00:30:37.181080 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22 (compile): 2023-02-20 00:30:37.167592 => 2023-02-20 00:30:37.181000
[0m00:30:37.181673 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e'
[0m00:30:37.182346 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.accepted_values_stg_green_tripdata_Payment_type__False___var_payment_type_values_.f62fdf1854
[0m00:30:37.182597 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b (execute): 2023-02-20 00:30:37.182517 => 2023-02-20 00:30:37.182525
[0m00:30:37.182860 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m00:30:37.183176 [debug] [Thread-4  ]: Began compiling node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m00:30:37.183522 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m00:30:37.184061 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.not_null_stg_green_tripdata_tripid.3e149d002b
[0m00:30:37.184338 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22 (execute): 2023-02-20 00:30:37.184263 => 2023-02-20 00:30:37.184270
[0m00:30:37.232464 [debug] [Thread-4  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e"
[0m00:30:37.233031 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182'
[0m00:30:37.233441 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m00:30:37.234016 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.relationships_stg_green_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.d10960da22
[0m00:30:37.234461 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m00:30:37.235190 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2'
[0m00:30:37.235545 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m00:30:37.242460 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e (compile): 2023-02-20 00:30:37.184531 => 2023-02-20 00:30:37.242312
[0m00:30:37.242812 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182"
[0m00:30:37.243066 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m00:30:37.243518 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c'
[0m00:30:37.243886 [debug] [Thread-4  ]: Began executing node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m00:30:37.250071 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2"
[0m00:30:37.250418 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c)
[0m00:30:37.250834 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e (execute): 2023-02-20 00:30:37.250750 => 2023-02-20 00:30:37.250766
[0m00:30:37.251273 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182 (compile): 2023-02-20 00:30:37.235898 => 2023-02-20 00:30:37.251208
[0m00:30:37.251546 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m00:30:37.252184 [debug] [Thread-4  ]: Finished running node test.taxi_rides_ny.relationships_stg_green_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.e44ce4891e
[0m00:30:37.252524 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m00:30:37.256761 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c"
[0m00:30:37.257064 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2 (compile): 2023-02-20 00:30:37.244332 => 2023-02-20 00:30:37.256950
[0m00:30:37.257565 [debug] [Thread-4  ]: Began running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m00:30:37.257822 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182 (execute): 2023-02-20 00:30:37.257752 => 2023-02-20 00:30:37.257762
[0m00:30:37.258342 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m00:30:37.258883 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f'
[0m00:30:37.259713 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.unique_stg_green_tripdata_tripid.d46e7e4182
[0m00:30:37.260007 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c (compile): 2023-02-20 00:30:37.252804 => 2023-02-20 00:30:37.259922
[0m00:30:37.260219 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2 (execute): 2023-02-20 00:30:37.260148 => 2023-02-20 00:30:37.260185
[0m00:30:37.260566 [debug] [Thread-4  ]: Began compiling node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m00:30:37.260937 [debug] [Thread-2  ]: Began running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m00:30:37.261157 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m00:30:37.261817 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.accepted_values_stg_yellow_tripdata_Payment_type__False___var_payment_type_values_.cf82239ca2
[0m00:30:37.267402 [debug] [Thread-4  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f"
[0m00:30:37.268092 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631'
[0m00:30:37.268378 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c (execute): 2023-02-20 00:30:37.268316 => 2023-02-20 00:30:37.268328
[0m00:30:37.268815 [debug] [Thread-3  ]: Began running node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m00:30:37.269394 [debug] [Thread-2  ]: Began compiling node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m00:30:37.270038 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.not_null_stg_yellow_tripdata_tripid.099802d91c
[0m00:30:37.270579 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82'
[0m00:30:37.277089 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f (compile): 2023-02-20 00:30:37.262024 => 2023-02-20 00:30:37.276962
[0m00:30:37.278091 [debug] [Thread-2  ]: Writing injected SQL for node "test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631"
[0m00:30:37.278678 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:30:37.279041 [debug] [Thread-3  ]: Began compiling node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m00:30:37.279478 [debug] [Thread-4  ]: Began executing node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m00:30:37.280419 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:30:37.285679 [debug] [Thread-3  ]: Writing injected SQL for node "test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82"
[0m00:30:37.286198 [debug] [Thread-4  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f (execute): 2023-02-20 00:30:37.286085 => 2023-02-20 00:30:37.286101
[0m00:30:37.286478 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:30:37.286753 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631 (compile): 2023-02-20 00:30:37.270838 => 2023-02-20 00:30:37.286680
[0m00:30:37.287597 [debug] [Thread-4  ]: Finished running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_Pickup_locationid__locationid__ref_taxi_zone_lookup_.e3a1ac3c4f
[0m00:30:37.287926 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:30:37.288443 [debug] [Thread-2  ]: Began executing node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m00:30:37.288811 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82 (compile): 2023-02-20 00:30:37.280707 => 2023-02-20 00:30:37.288680
[0m00:30:37.289173 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m00:30:37.292995 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:30:37.293309 [debug] [Thread-2  ]: Timing info for test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631 (execute): 2023-02-20 00:30:37.293245 => 2023-02-20 00:30:37.293256
[0m00:30:37.293534 [debug] [Thread-3  ]: Began executing node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m00:30:37.294091 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m00:30:37.294975 [debug] [Thread-2  ]: Finished running node test.taxi_rides_ny.relationships_stg_yellow_tripdata_dropoff_locationid__locationid__ref_taxi_zone_lookup_.c687434631
[0m00:30:37.295419 [debug] [Thread-3  ]: Timing info for test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82 (execute): 2023-02-20 00:30:37.295303 => 2023-02-20 00:30:37.295345
[0m00:30:37.295819 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m00:30:37.296191 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:30:37.289467 => 2023-02-20 00:30:37.296126
[0m00:30:37.296903 [debug] [Thread-3  ]: Finished running node test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82
[0m00:30:37.300086 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:30:37.300377 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:30:37.301079 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:30:37.300996 => 2023-02-20 00:30:37.301011
[0m00:30:37.301882 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:30:37.302664 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:30:37.303200 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dm_monthly_zone_revenue'
[0m00:30:37.303465 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:30:37.306338 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.dm_monthly_zone_revenue"
[0m00:30:37.306901 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-20 00:30:37.297150 => 2023-02-20 00:30:37.306830
[0m00:30:37.307287 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m00:30:37.307574 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-20 00:30:37.307466 => 2023-02-20 00:30:37.307476
[0m00:30:37.308257 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m00:30:37.308877 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.dm_monthly_zone_revenue (compile): 2023-02-20 00:30:37.303603 => 2023-02-20 00:30:37.308821
[0m00:30:37.309156 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:30:37.309337 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.dm_monthly_zone_revenue (execute): 2023-02-20 00:30:37.309293 => 2023-02-20 00:30:37.309301
[0m00:30:37.309817 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:30:37.310611 [debug] [Thread-1  ]: Began running node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m00:30:37.311081 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41'
[0m00:30:37.311250 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41)
[0m00:30:37.311428 [debug] [Thread-1  ]: Began compiling node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m00:30:37.315820 [debug] [Thread-1  ]: Writing injected SQL for node "test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41"
[0m00:30:37.316888 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41 (compile): 2023-02-20 00:30:37.311557 => 2023-02-20 00:30:37.316794
[0m00:30:37.317200 [debug] [Thread-1  ]: Began executing node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m00:30:37.317413 [debug] [Thread-1  ]: Timing info for test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41 (execute): 2023-02-20 00:30:37.317356 => 2023-02-20 00:30:37.317368
[0m00:30:37.317965 [debug] [Thread-1  ]: Finished running node test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41
[0m00:30:37.319074 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:30:37.319282 [debug] [MainThread]: Connection 'test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41' was left open.
[0m00:30:37.319477 [debug] [MainThread]: On test.taxi_rides_ny.not_null_dm_monthly_zone_revenue_revenue_monthly_total_amount.34c3437d41: Close
[0m00:30:37.321193 [debug] [MainThread]: Connection 'model.taxi_rides_ny.dm_monthly_zone_revenue' was properly closed.
[0m00:30:37.321420 [debug] [MainThread]: Connection 'test.taxi_rides_ny.unique_stg_yellow_tripdata_tripid.7a6ae70c82' was properly closed.
[0m00:30:37.321583 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was properly closed.
[0m00:30:37.322381 [debug] [MainThread]: Command end result
[0m00:30:37.334768 [info ] [MainThread]: Done.
[0m00:30:37.335314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa7478e6880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa747944dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa748196d60>]}
[0m00:30:37.335718 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:31:10.610604 | d0147cda-6c64-4784-bdc1-c226e527fd3f ==============================
[0m00:31:10.610604 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:31:10.612955 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:31:10.613371 [debug] [MainThread]: Tracking: tracking
[0m00:31:10.633491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87025a2910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87026ad550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87026ad2e0>]}
[0m00:31:10.751949 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:31:10.752274 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:31:10.760981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87029e5940>]}
[0m00:31:10.773219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87028de2e0>]}
[0m00:31:10.773663 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:31:10.773989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87028de2b0>]}
[0m00:31:10.775770 [info ] [MainThread]: 
[0m00:31:10.777374 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:31:10.778806 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:31:10.791443 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:31:11.325919 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:31:11.341044 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.349013 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:31:11.349734 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:31:11.360830 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:31:11.376341 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.383773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87029bfb20>]}
[0m00:31:11.385107 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:31:11.385676 [info ] [MainThread]: 
[0m00:31:11.394475 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m00:31:11.395257 [info ] [Thread-1  ]: 1 of 7 START sql table model sandbox.dim_zones ................................. [RUN]
[0m00:31:11.395990 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:31:11.396796 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m00:31:11.397186 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m00:31:11.397627 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:31:11.399839 [info ] [Thread-4  ]: 4 of 7 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m00:31:11.401068 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m00:31:11.401535 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:31:11.398050 [info ] [Thread-2  ]: 2 of 7 START sql view model sandbox.stg_fhv_tripdata ........................... [RUN]
[0m00:31:11.417245 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m00:31:11.417605 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:31:11.421512 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:31:11.423479 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:31:11.398455 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m00:31:11.423969 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m00:31:11.427411 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m00:31:11.398993 [info ] [Thread-3  ]: 3 of 7 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m00:31:11.434116 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m00:31:11.434487 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m00:31:11.439374 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:31:11.443491 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-20 00:31:11.417794 => 2023-02-20 00:31:11.443314
[0m00:31:11.443856 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:31:11.453424 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-20 00:31:11.424181 => 2023-02-20 00:31:11.453312
[0m00:31:11.453849 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-20 00:31:11.434718 => 2023-02-20 00:31:11.453767
[0m00:31:11.482603 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m00:31:11.465760 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m00:31:11.466107 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-20 00:31:11.401845 => 2023-02-20 00:31:11.466033
[0m00:31:11.549608 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:31:11.554782 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:31:11.556920 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:31:11.571600 [debug] [Thread-2  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:31:11.584192 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m00:31:11.592877 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m00:31:11.594880 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        ...
[0m00:31:11.598051 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m00:31:11.620188 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:31:11.637050 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

    select name, type from system.columns where table = 'dim_zones__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:31:11.650794 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.654602 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.dim_zones"
[0m00:31:11.657839 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

  
    
    
        
        insert into sandbox.dim_zones__dbt_backup ("locationid", "borough", "zone", "service_zone")
  

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
  ...
[0m00:31:11.679358 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:31:11.682362 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */
EXCHANGE TABLES sandbox.dim_zones__dbt_backup AND sandbox.dim_zones 
  
  ...
[0m00:31:11.694227 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.718866 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */
drop table if exists sandbox.dim_zones__dbt_backup 
  ...
[0m00:31:11.809237 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m00:31:11.812093 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-20 00:31:11.539220 => 2023-02-20 00:31:11.811993
[0m00:31:11.813193 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87031c6f70>]}
[0m00:31:11.813986 [info ] [Thread-1  ]: 1 of 7 OK created sql table model sandbox.dim_zones ............................ [[32mOK[0m in 0.42s]
[0m00:31:11.816706 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m00:31:11.818376 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    toString(-- case payment_type
    --     when 1 then 'Credit card'
    --     when 2 then 'Cash'
    --     when 3 then 'No charge'
    --     when 4 then 'Dispute'
    --     when 5 then 'Unknown'
    --     when 6 then 'Voided trip'
    --     else 'Unknown'
    -- end

    multiIf(
        payment_type = 1, 'Credit card',
        payment_type = 2, 'Cash',
        payment_type = 3, 'No charge',
        payment_type = 4, 'Dispute',
        payment_type = 5, 'Unknown',
        payment_type = 6, 'Voided trip',
        'Unknown'
    )) as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:31:11.834609 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    toString(-- case payment_type
    --     when 1 then 'Credit card'
    --     when 2 then 'Cash'
    --     when 3 then 'No charge'
    --     when 4 then 'Dispute'
    --     when 5 then 'Unknown'
    --     when 6 then 'Voided trip'
    --     else 'Unknown'
    -- end

    multiIf(
        payment_type = 1, 'Credit card',
        payment_type = 2, 'Cash',
        payment_type = 3, 'No charge',
        payment_type = 4, 'Dispute',
        payment_type = 5, 'Unknown',
        payment_type = 6, 'Voided trip',
        'Unknown'
    )) as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:31:11.842312 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:31:11.854545 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:31:11.855878 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:31:11.859552 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:31:11.866055 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.867876 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:31:11.871032 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.872390 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:31:11.879369 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.884542 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m00:31:11.886272 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.891566 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m00:31:11.895986 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.897658 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m00:31:11.902838 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.904483 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m00:31:11.908797 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.914708 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m00:31:11.916282 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.921080 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m00:31:11.934778 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata__dbt_tmp 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_Flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:31:11.936306 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.936903 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:31:11.940130 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-20 00:31:11.482844 => 2023-02-20 00:31:11.940034
[0m00:31:11.942444 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-20 00:31:11.549870 => 2023-02-20 00:31:11.942351
[0m00:31:11.943522 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87033491f0>]}
[0m00:31:11.944781 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8703349760>]}
[0m00:31:11.945634 [info ] [Thread-3  ]: 3 of 7 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.51s]
[0m00:31:11.946540 [info ] [Thread-4  ]: 4 of 7 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.54s]
[0m00:31:11.947795 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m00:31:11.948542 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:31:11.950698 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:31:11.951510 [info ] [Thread-1  ]: 5 of 7 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:31:11.952825 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:31:11.953221 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:31:11.954144 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:31:11.960280 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:31:11.961270 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:31:11.965445 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m00:31:11.966649 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:31:11.954802 => 2023-02-20 00:31:11.966547
[0m00:31:11.967043 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:31:11.972413 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
drop table if exists sandbox.fact_trips__dbt_backup 
  ...
[0m00:31:11.984735 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:31:11.985548 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:11.986916 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata to sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m00:31:11.989027 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:31:12.003729 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:12.008450 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata 
  
  ...
[0m00:31:12.018739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:31:12.021841 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:31:12.022998 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:12.024059 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata__dbt_tmp to sandbox.stg_fhv_tripdata 
  
  ...
[0m00:31:12.036795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:12.037939 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:12.042979 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */
drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  ...
[0m00:31:12.046156 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m00:31:12.048526 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:31:12.162906 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.12 seconds
[0m00:31:12.166450 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-20 00:31:11.444051 => 2023-02-20 00:31:12.166336
[0m00:31:12.168035 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87031c6af0>]}
[0m00:31:12.169117 [info ] [Thread-2  ]: 2 of 7 OK created sql view model sandbox.stg_fhv_tripdata ...................... [[32mOK[0m in 0.75s]
[0m00:31:12.169969 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:31:12.171193 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m00:31:12.171837 [info ] [Thread-4  ]: 6 of 7 START sql table model sandbox.fact_trips_fhv ............................ [RUN]
[0m00:31:12.172993 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m00:31:12.173417 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips_fhv)
[0m00:31:12.173842 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m00:31:12.180823 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:31:12.183031 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-20 00:31:12.174132 => 2023-02-20 00:31:12.182844
[0m00:31:12.183528 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m00:31:12.189557 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:31:12.431268 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.24 seconds
[0m00:31:12.436769 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

    select name, type from system.columns where table = 'fact_trips_fhv__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:31:12.451680 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:12.454663 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:31:12.457562 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

  
    
    
        
        insert into sandbox.fact_trips_fhv__dbt_backup ("fhv_data.tripid", "fhv_data.vendorid", "fhv_data.pickup_locationid", "pickup_borough", "pickup_zone", "fhv_data.dropoff_locationid", "dropoff_borough", "dropoff_zone", "fhv_data.pickup_datetime", "fhv_data.dropoff_datetime", "fhv_data.sr_flag")
  

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:31:13.808071 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 1.35 seconds
[0m00:31:13.809440 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */
EXCHANGE TABLES sandbox.fact_trips_fhv__dbt_backup AND sandbox.fact_trips_fhv 
  
  ...
[0m00:31:13.820560 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:31:13.825626 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */
drop table if exists sandbox.fact_trips_fhv__dbt_backup 
  ...
[0m00:31:13.939067 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m00:31:13.942465 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-20 00:31:12.183757 => 2023-02-20 00:31:13.942352
[0m00:31:13.943842 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f87033eef70>]}
[0m00:31:13.944887 [info ] [Thread-4  ]: 6 of 7 OK created sql table model sandbox.fact_trips_fhv ....................... [[32mOK[0m in 1.77s]
[0m00:31:13.945753 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m00:33:02.328157 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    -- trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  
[0m00:33:02.329279 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:31:11.967373 => 2023-02-20 00:33:02.329053
[0m00:33:02.341689 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.01 GiB (attempt to allocate chunk of 4322666 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker. (MEMORY_LIMIT_EXCEEDED
  compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:33:02.342459 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd0147cda-6c64-4784-bdc1-c226e527fd3f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8703349220>]}
[0m00:33:02.343323 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 110.39s]
[0m00:33:02.344058 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:33:02.345258 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:33:02.346059 [info ] [Thread-2  ]: 7 of 7 SKIP relation sandbox.dm_monthly_zone_revenue ........................... [[33mSKIP[0m]
[0m00:33:02.346907 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:33:02.349760 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:33:02.350660 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:33:02.351063 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:33:02.351430 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:33:02.354089 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was left open.
[0m00:33:02.354577 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips_fhv: Close
[0m00:33:02.357426 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_fhv_tripdata' was left open.
[0m00:33:02.357879 [debug] [MainThread]: On model.taxi_rides_ny.stg_fhv_tripdata: Close
[0m00:33:02.360809 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_green_tripdata' was left open.
[0m00:33:02.361283 [debug] [MainThread]: On model.taxi_rides_ny.stg_green_tripdata: Close
[0m00:33:02.363611 [info ] [MainThread]: 
[0m00:33:02.364138 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 1 minutes and 51.59 seconds (111.59s).
[0m00:33:02.364930 [debug] [MainThread]: Command end result
[0m00:33:02.377266 [info ] [MainThread]: 
[0m00:33:02.377942 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:33:02.378448 [info ] [MainThread]: 
[0m00:33:02.379024 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:33:02.379337 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:33:02.379620 [error] [MainThread]:    Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.01 GiB (attempt to allocate chunk of 4322666 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker. (MEMORY_LIMIT_EXCEEDED
[0m00:33:02.379952 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:33:02.380348 [info ] [MainThread]: 
[0m00:33:02.380670 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m00:33:02.381091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8702a2fd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8703157f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8703157fd0>]}
[0m00:33:02.381431 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 00:33:13.883267 | 861f7d2b-87c9-422b-8e32-24149ce43d22 ==============================
[0m00:33:13.883267 [info ] [MainThread]: Running with dbt=1.4.1
[0m00:33:13.886339 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m00:33:13.886680 [debug] [MainThread]: Tracking: tracking
[0m00:33:13.906800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943bd4cf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943be56610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943be56190>]}
[0m00:33:14.025238 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:33:14.025918 [debug] [MainThread]: Partial parsing: updated file: taxi_rides_ny://models/core/fact_trips.sql
[0m00:33:14.040436 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m00:33:14.070984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943c0a13a0>]}
[0m00:33:14.082904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943bfd8430>]}
[0m00:33:14.083373 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m00:33:14.083771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943bfd8490>]}
[0m00:33:14.085619 [info ] [MainThread]: 
[0m00:33:14.087346 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:33:14.088927 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m00:33:14.101422 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:33:14.569023 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m00:33:14.584444 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:14.592543 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m00:33:14.593262 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m00:33:14.648202 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m00:33:14.662999 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:14.667664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943bf804c0>]}
[0m00:33:14.668540 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:33:14.668912 [info ] [MainThread]: 
[0m00:33:14.675570 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m00:33:14.676053 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:33:14.676439 [info ] [Thread-1  ]: 1 of 7 START sql table model sandbox.dim_zones ................................. [RUN]
[0m00:33:14.676968 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m00:33:14.677369 [info ] [Thread-2  ]: 2 of 7 START sql view model sandbox.stg_fhv_tripdata ........................... [RUN]
[0m00:33:14.677826 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:33:14.681235 [info ] [Thread-4  ]: 4 of 7 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m00:33:14.678432 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m00:33:14.682865 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m00:33:14.683239 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m00:33:14.680112 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m00:33:14.686966 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m00:33:14.687511 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:33:14.678867 [info ] [Thread-3  ]: 3 of 7 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m00:33:14.695641 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m00:33:14.696050 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m00:33:14.702242 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:33:14.682165 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m00:33:14.704811 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:33:14.709537 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:33:14.714105 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-20 00:33:14.683538 => 2023-02-20 00:33:14.713969
[0m00:33:14.714565 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m00:33:14.691777 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:33:14.743533 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-20 00:33:14.696295 => 2023-02-20 00:33:14.743415
[0m00:33:14.743928 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m00:33:14.770728 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-20 00:33:14.705072 => 2023-02-20 00:33:14.770604
[0m00:33:14.771076 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:33:14.796634 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-20 00:33:14.687999 => 2023-02-20 00:33:14.796507
[0m00:33:14.801783 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m00:33:14.810888 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m00:33:14.811217 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:33:14.823184 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        ...
[0m00:33:14.827499 [debug] [Thread-2  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m00:33:14.829035 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m00:33:14.829454 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m00:33:14.833259 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m00:33:14.860175 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:33:14.876941 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

    select name, type from system.columns where table = 'dim_zones__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:33:14.891790 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:14.895593 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.dim_zones"
[0m00:33:14.896978 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

  
    
    
        
        insert into sandbox.dim_zones__dbt_backup ("locationid", "borough", "zone", "service_zone")
  

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
  ...
[0m00:33:14.934607 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m00:33:14.938867 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */
EXCHANGE TABLES sandbox.dim_zones__dbt_backup AND sandbox.dim_zones 
  
  ...
[0m00:33:14.954499 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:33:14.990559 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */
drop table if exists sandbox.dim_zones__dbt_backup 
  ...
[0m00:33:15.008417 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:33:15.010516 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-20 00:33:14.714813 => 2023-02-20 00:33:15.010434
[0m00:33:15.011920 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943c12c0d0>]}
[0m00:33:15.013622 [info ] [Thread-1  ]: 1 of 7 OK created sql table model sandbox.dim_zones ............................ [[32mOK[0m in 0.33s]
[0m00:33:15.015786 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m00:33:15.130456 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    toString(-- case payment_type
    --     when 1 then 'Credit card'
    --     when 2 then 'Cash'
    --     when 3 then 'No charge'
    --     when 4 then 'Dispute'
    --     when 5 then 'Unknown'
    --     when 6 then 'Voided trip'
    --     else 'Unknown'
    -- end

    multiIf(
        payment_type = 1, 'Credit card',
        payment_type = 2, 'Cash',
        payment_type = 3, 'No charge',
        payment_type = 4, 'Dispute',
        payment_type = 5, 'Unknown',
        payment_type = 6, 'Voided trip',
        'Unknown'
    )) as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:33:15.165485 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:33:15.180024 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:33:15.181236 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    toString(-- case payment_type
    --     when 1 then 'Credit card'
    --     when 2 then 'Cash'
    --     when 3 then 'No charge'
    --     when 4 then 'Dispute'
    --     when 5 then 'Unknown'
    --     when 6 then 'Voided trip'
    --     else 'Unknown'
    -- end

    multiIf(
        payment_type = 1, 'Credit card',
        payment_type = 2, 'Cash',
        payment_type = 3, 'No charge',
        payment_type = 4, 'Dispute',
        payment_type = 5, 'Unknown',
        payment_type = 6, 'Voided trip',
        'Unknown'
    )) as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:33:15.182609 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata__dbt_tmp 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_Flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'


  limit 100


  )...
[0m00:33:15.196336 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.200405 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m00:33:15.208060 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:33:15.214067 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:33:15.214687 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:33:15.216105 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:33:15.220799 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m00:33:15.225043 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m00:33:15.230769 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:33:15.232516 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m00:33:15.239700 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.241773 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata to sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m00:33:15.244023 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:33:15.244785 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.246489 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m00:33:15.250924 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m00:33:15.255618 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.259544 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata 
  
  ...
[0m00:33:15.264077 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.264604 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.266069 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m00:33:15.270921 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m00:33:15.272213 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.274495 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata__dbt_tmp to sandbox.stg_fhv_tripdata 
  
  ...
[0m00:33:15.283625 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.290707 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m00:33:15.292171 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:33:15.296687 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */
drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  ...
[0m00:33:15.303659 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:33:15.304183 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.305870 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-20 00:33:14.771251 => 2023-02-20 00:33:15.305794
[0m00:33:15.307437 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-20 00:33:14.744179 => 2023-02-20 00:33:15.307375
[0m00:33:15.308265 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943c12ceb0>]}
[0m00:33:15.308998 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943c12c550>]}
[0m00:33:15.310128 [info ] [Thread-4  ]: 4 of 7 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.63s]
[0m00:33:15.310574 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.311155 [info ] [Thread-3  ]: 3 of 7 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.61s]
[0m00:33:15.311637 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m00:33:15.313281 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-20 00:33:14.823769 => 2023-02-20 00:33:15.313211
[0m00:33:15.313754 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m00:33:15.314720 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943cb58eb0>]}
[0m00:33:15.315358 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m00:33:15.316057 [info ] [Thread-2  ]: 2 of 7 OK created sql view model sandbox.stg_fhv_tripdata ...................... [[32mOK[0m in 0.64s]
[0m00:33:15.317506 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m00:33:15.316760 [info ] [Thread-1  ]: 5 of 7 START sql table model sandbox.fact_trips ................................ [RUN]
[0m00:33:15.318769 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m00:33:15.319402 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m00:33:15.319871 [info ] [Thread-3  ]: 6 of 7 START sql table model sandbox.fact_trips_fhv ............................ [RUN]
[0m00:33:15.320376 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m00:33:15.320993 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m00:33:15.321271 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m00:33:15.321446 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips_fhv)
[0m00:33:15.325587 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m00:33:15.325920 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m00:33:15.329545 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:33:15.330189 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 00:33:15.321606 => 2023-02-20 00:33:15.330100
[0m00:33:15.330560 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m00:33:15.336616 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
drop table if exists sandbox.fact_trips__dbt_backup 
  ...
[0m00:33:15.337063 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-20 00:33:15.326316 => 2023-02-20 00:33:15.336953
[0m00:33:15.338224 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m00:33:15.345181 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:33:15.355602 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m00:33:15.358234 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m00:33:15.379110 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:33:15.382214 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

    select name, type from system.columns where table = 'fact_trips_fhv__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:33:15.390670 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m00:33:15.393856 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m00:33:15.395147 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.397342 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips_fhv"
[0m00:33:15.398502 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

  
    
    
        
        insert into sandbox.fact_trips_fhv__dbt_backup ("fhv_data.tripid", "fhv_data.vendorid", "fhv_data.pickup_locationid", "pickup_borough", "pickup_zone", "fhv_data.dropoff_locationid", "dropoff_borough", "dropoff_zone", "fhv_data.pickup_datetime", "fhv_data.dropoff_datetime", "fhv_data.sr_flag")
  

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:33:15.406742 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:15.408769 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m00:33:15.409965 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.payment_type_description", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m00:33:16.259367 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.86 seconds
[0m00:33:16.262558 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */
EXCHANGE TABLES sandbox.fact_trips_fhv__dbt_backup AND sandbox.fact_trips_fhv 
  
  ...
[0m00:33:16.275775 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m00:33:16.283941 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */
drop table if exists sandbox.fact_trips_fhv__dbt_backup 
  ...
[0m00:33:16.399246 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m00:33:16.402965 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-20 00:33:15.338562 => 2023-02-20 00:33:16.402809
[0m00:33:16.404531 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943c084130>]}
[0m00:33:16.405596 [info ] [Thread-3  ]: 6 of 7 OK created sql table model sandbox.fact_trips_fhv ....................... [[32mOK[0m in 1.08s]
[0m00:33:16.406559 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m00:35:06.227463 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.payment_type_description", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  
[0m00:35:06.228838 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 00:33:15.330828 => 2023-02-20 00:35:06.228551
[0m00:35:06.240690 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.00 GiB (attempt to allocate chunk of 4253802 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker.: (while reading column
  compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:35:06.241688 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '861f7d2b-87c9-422b-8e32-24149ce43d22', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943ce88460>]}
[0m00:35:06.242483 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 110.92s]
[0m00:35:06.243053 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m00:35:06.244176 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:35:06.244774 [info ] [Thread-2  ]: 7 of 7 SKIP relation sandbox.dm_monthly_zone_revenue ........................... [[33mSKIP[0m]
[0m00:35:06.245383 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m00:35:06.247729 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m00:35:06.248537 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:35:06.248944 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m00:35:06.249278 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m00:35:06.251682 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_fhv_tripdata' was left open.
[0m00:35:06.251988 [debug] [MainThread]: On model.taxi_rides_ny.stg_fhv_tripdata: Close
[0m00:35:06.254532 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m00:35:06.254791 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m00:35:06.257116 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was left open.
[0m00:35:06.257413 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips_fhv: Close
[0m00:35:06.260801 [info ] [MainThread]: 
[0m00:35:06.261170 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 1 minutes and 52.17 seconds (112.17s).
[0m00:35:06.261800 [debug] [MainThread]: Command end result
[0m00:35:06.272993 [info ] [MainThread]: 
[0m00:35:06.273454 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m00:35:06.273868 [info ] [MainThread]: 
[0m00:35:06.274127 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m00:35:06.274429 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m00:35:06.274738 [error] [MainThread]:    Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.00 GiB (attempt to allocate chunk of 4253802 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker.: (while reading column
[0m00:35:06.275040 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m00:35:06.275300 [info ] [MainThread]: 
[0m00:35:06.275574 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m00:35:06.276089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943c0a18b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943c1227c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f943ca7cb80>]}
[0m00:35:06.276402 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 01:00:59.635201 | 8fc65cbe-85fc-4418-9e7c-281b38b91439 ==============================
[0m01:00:59.635201 [info ] [MainThread]: Running with dbt=1.4.1
[0m01:00:59.639483 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'vars': 'is_test_run: false', 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m01:00:59.639914 [debug] [MainThread]: Tracking: tracking
[0m01:00:59.663433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cad3e070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cad3e640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cad3e3d0>]}
[0m01:00:59.704502 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m01:00:59.704988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cacfa7f0>]}
[0m01:01:00.832332 [debug] [MainThread]: 1603: static parser failed on staging/stg_yellow_tripdata.sql
[0m01:01:00.847162 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_yellow_tripdata.sql
[0m01:01:00.848829 [debug] [MainThread]: 1603: static parser failed on staging/stg_green_tripdata.sql
[0m01:01:00.854055 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_green_tripdata.sql
[0m01:01:00.855369 [debug] [MainThread]: 1603: static parser failed on staging/stg_fhv_tripdata.sql
[0m01:01:00.861229 [debug] [MainThread]: 1602: parser fallback to jinja rendering on staging/stg_fhv_tripdata.sql
[0m01:01:00.863995 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips.sql
[0m01:01:00.867041 [debug] [MainThread]: 1699: static parser successfully parsed core/fact_trips_fhv.sql
[0m01:01:00.870263 [debug] [MainThread]: 1699: static parser successfully parsed core/dim_zones.sql
[0m01:01:00.872973 [debug] [MainThread]: 1699: static parser successfully parsed core/dm_monthly_zone_revenue.sql
[0m01:01:01.051805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cb2b9940>]}
[0m01:01:01.064647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cb0acee0>]}
[0m01:01:01.065050 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m01:01:01.065312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cae63850>]}
[0m01:01:01.066940 [info ] [MainThread]: 
[0m01:01:01.068507 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m01:01:01.069993 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m01:01:01.086358 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:01:01.737807 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m01:01:01.753232 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:01.761114 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m01:01:01.761856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m01:01:01.772642 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m01:01:01.790009 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:01:01.797974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cb26b280>]}
[0m01:01:01.799301 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:01:01.799867 [info ] [MainThread]: 
[0m01:01:01.810870 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.dim_zones
[0m01:01:01.811434 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.stg_fhv_tripdata
[0m01:01:01.811931 [info ] [Thread-1  ]: 1 of 7 START sql table model sandbox.dim_zones ................................. [RUN]
[0m01:01:01.812702 [info ] [Thread-2  ]: 2 of 7 START sql view model sandbox.stg_fhv_tripdata ........................... [RUN]
[0m01:01:01.814242 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.dim_zones'
[0m01:01:01.814842 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.stg_green_tripdata
[0m01:01:01.815973 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_fhv_tripdata'
[0m01:01:01.816704 [debug] [Thread-4  ]: Began running node model.taxi_rides_ny.stg_yellow_tripdata
[0m01:01:01.817116 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.dim_zones)
[0m01:01:01.817950 [info ] [Thread-3  ]: 3 of 7 START sql view model sandbox.stg_green_tripdata ......................... [RUN]
[0m01:01:01.818455 [debug] [Thread-2  ]: Began compiling node model.taxi_rides_ny.stg_fhv_tripdata
[0m01:01:01.819018 [info ] [Thread-4  ]: 4 of 7 START sql view model sandbox.stg_yellow_tripdata ........................ [RUN]
[0m01:01:01.819519 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.dim_zones
[0m01:01:01.820424 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_green_tripdata'
[0m01:01:01.825449 [debug] [Thread-2  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m01:01:01.827101 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.stg_yellow_tripdata'
[0m01:01:01.830826 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.dim_zones"
[0m01:01:01.831311 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.stg_green_tripdata
[0m01:01:01.831747 [debug] [Thread-4  ]: Began compiling node model.taxi_rides_ny.stg_yellow_tripdata
[0m01:01:01.836921 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_green_tripdata"
[0m01:01:01.844083 [debug] [Thread-4  ]: Writing injected SQL for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m01:01:01.844828 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (compile): 2023-02-20 01:01:01.820763 => 2023-02-20 01:01:01.844716
[0m01:01:01.845067 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (compile): 2023-02-20 01:01:01.827439 => 2023-02-20 01:01:01.845016
[0m01:01:01.845530 [debug] [Thread-2  ]: Began executing node model.taxi_rides_ny.stg_fhv_tripdata
[0m01:01:01.845803 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.dim_zones
[0m01:01:01.864499 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (compile): 2023-02-20 01:01:01.837331 => 2023-02-20 01:01:01.864404
[0m01:01:01.871271 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (compile): 2023-02-20 01:01:01.832036 => 2023-02-20 01:01:01.871160
[0m01:01:01.892719 [debug] [Thread-2  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_fhv_tripdata"
[0m01:01:01.901721 [debug] [Thread-4  ]: Began executing node model.taxi_rides_ny.stg_yellow_tripdata
[0m01:01:01.917865 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.stg_green_tripdata
[0m01:01:01.924940 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

            

    
        create table sandbox.dim_zones__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
    )
        ...
[0m01:01:01.929239 [debug] [Thread-4  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_yellow_tripdata"
[0m01:01:01.934435 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.stg_green_tripdata"
[0m01:01:01.935825 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m01:01:01.937895 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m01:01:01.939742 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m01:01:01.988742 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m01:01:02.017492 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

    select name, type from system.columns where table = 'dim_zones__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m01:01:02.033787 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:01:02.037753 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.dim_zones"
[0m01:01:02.039711 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */

  
    
    
        
        insert into sandbox.dim_zones__dbt_backup ("locationid", "borough", "zone", "service_zone")
  

select 
    locationid, 
    borough, 
    zone, 
    replace(service_zone, 'Boro', 'Green') as service_zone
from sandbox.taxi_zone_lookup
  ...
[0m01:01:02.058687 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:01:02.061688 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */
EXCHANGE TABLES sandbox.dim_zones__dbt_backup AND sandbox.dim_zones 
  
  ...
[0m01:01:02.075924 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.102735 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.dim_zones: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.dim_zones"} */
drop table if exists sandbox.dim_zones__dbt_backup 
  ...
[0m01:01:02.125090 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:01:02.127023 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.dim_zones (execute): 2023-02-20 01:01:01.864736 => 2023-02-20 01:01:02.126945
[0m01:01:02.127866 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cbc3fee0>]}
[0m01:01:02.128492 [info ] [Thread-1  ]: 1 of 7 OK created sql table model sandbox.dim_zones ............................ [[32mOK[0m in 0.31s]
[0m01:01:02.130146 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.dim_zones
[0m01:01:02.242309 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */


  create view sandbox.stg_yellow_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, tpep_pickup_datetime) as rn
  from default.yellow_taxi_data
  where `VendorID` is not null 
)
select
   -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse 
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as  pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    tpep_pickup_datetime as pickup_datetime,
    tpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    -- yellow cabs are always street-hail
    1 as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(0.0) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    toString(multiIf(
        payment_type = 1, 'Credit card',
        payment_type = 2, 'Cash',
        payment_type = 3, 'No charge',
        payment_type = 4, 'Dispute',
        payment_type = 5, 'Unknown',
        payment_type = 6, 'Voided trip',
        'Unknown'
    )) as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1

-- dbt build --m <model.sql> --var 'is_test_run: false'

  )...
[0m01:01:02.272820 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m01:01:02.288403 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m01:01:02.304221 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.306519 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata to sandbox.stg_yellow_tripdata__dbt_backup 
  
  ...
[0m01:01:02.319208 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.327177 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    drop table if exists sandbox.stg_yellow_tripdata 
  
  ...
[0m01:01:02.341566 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */


  create view sandbox.stg_green_tripdata__dbt_tmp 
  
  as (
    

with tripdata as 
(
  select *,
    row_number() over(partition by `VendorID`, lpep_pickup_datetime) as rn
  from default.green_taxi_data
  where `VendorID` is not null 
)
select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    toUInt32(`VendorID`) as vendorid,
    toUInt32(`RatecodeID`) as ratecodeid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,
    
    -- timestamps
    lpep_pickup_datetime as pickup_datetime,
    lpep_dropoff_datetime as dropoff_datetime,
    
    -- trip info
    store_and_fwd_flag,
    toInt32(passenger_count) as passenger_count,
    toFloat32(trip_distance) as trip_distance,
    toInt32(trip_type) as trip_type,
    
    -- payment info
    toFloat32(fare_amount) as fare_amount,
    toFloat32(extra) as extra,
    toFloat32(mta_tax) as mta_tax,
    toFloat32(tip_amount) as tip_amount,
    toFloat32(tolls_amount) as tolls_amount,
    toFloat32(ehail_fee) as ehail_fee,
    toFloat32(improvement_surcharge) as improvement_surcharge,
    toFloat32(total_amount) as total_amount,
    toInt32(payment_type) as payment_type,
    toString(multiIf(
        payment_type = 1, 'Credit card',
        payment_type = 2, 'Cash',
        payment_type = 3, 'No charge',
        payment_type = 4, 'Dispute',
        payment_type = 5, 'Unknown',
        payment_type = 6, 'Voided trip',
        'Unknown'
    )) as payment_type_description, 
    toFloat32(congestion_surcharge) as congestion_surcharge
from tripdata
where rn = 1


-- dbt build --m <model.sql> --var 'is_test_run: false'

  )...
[0m01:01:02.347226 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.349516 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */

    rename table sandbox.stg_yellow_tripdata__dbt_tmp to sandbox.stg_yellow_tripdata 
  
  ...
[0m01:01:02.365184 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.371622 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_yellow_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_yellow_tripdata"} */
drop table if exists sandbox.stg_yellow_tripdata__dbt_backup 
  ...
[0m01:01:02.378292 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m01:01:02.382991 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m01:01:02.394046 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.395479 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata to sandbox.stg_green_tripdata__dbt_backup 
  
  ...
[0m01:01:02.408208 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.411909 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    drop table if exists sandbox.stg_green_tripdata 
  
  ...
[0m01:01:02.422566 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.423885 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */

    rename table sandbox.stg_green_tripdata__dbt_tmp to sandbox.stg_green_tripdata 
  
  ...
[0m01:01:02.435720 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.439509 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_green_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_green_tripdata"} */
drop table if exists sandbox.stg_green_tripdata__dbt_backup 
  ...
[0m01:01:02.441531 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m01:01:02.442887 [debug] [Thread-4  ]: Timing info for model.taxi_rides_ny.stg_yellow_tripdata (execute): 2023-02-20 01:01:01.925450 => 2023-02-20 01:01:02.442827
[0m01:01:02.443535 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cbc49fd0>]}
[0m01:01:02.443980 [info ] [Thread-4  ]: 4 of 7 OK created sql view model sandbox.stg_yellow_tripdata ................... [[32mOK[0m in 0.62s]
[0m01:01:02.444308 [debug] [Thread-4  ]: Finished running node model.taxi_rides_ny.stg_yellow_tripdata
[0m01:01:02.464522 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:01:02.464927 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */


  create view sandbox.stg_fhv_tripdata__dbt_tmp 
  
  as (
    

select
    -- identifiers
    -- dbt_utils.surrogate_key doesn't for clickhouse
    lower(hex(MD5(concat(
      ifNull(toString(vendorid), ''),
      '-',
      ifNull(toString(pickup_datetime), '')
    )))) as tripid,

    dispatching_base_num as vendorid,
    toUInt32(`PULocationID`) as pickup_locationid,
    toUInt32(`PULocationID`) as dropoff_locationid,

    --timestamps
    toDateTime(pickup_datetime) as pickup_datetime,
    toDateTime(dropoff_datetime) as dropoff_datetime,

    --trip info
    `SR_Flag` as sr_flag
from default.fhv_taxi_data


-- dbt build --m <model.sql> --var 'is_test_run: false'

  )...
[0m01:01:02.466138 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.stg_green_tripdata (execute): 2023-02-20 01:01:01.929604 => 2023-02-20 01:01:02.466083
[0m01:01:02.467530 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cb200340>]}
[0m01:01:02.468120 [info ] [Thread-3  ]: 3 of 7 OK created sql view model sandbox.stg_green_tripdata .................... [[32mOK[0m in 0.65s]
[0m01:01:02.468500 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.stg_green_tripdata
[0m01:01:02.469055 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m01:01:02.469440 [info ] [Thread-1  ]: 5 of 7 START sql table model sandbox.fact_trips ................................ [RUN]
[0m01:01:02.470063 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m01:01:02.470290 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m01:01:02.470508 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m01:01:02.474786 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m01:01:02.477676 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 01:01:02.470654 => 2023-02-20 01:01:02.477507
[0m01:01:02.478148 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m01:01:02.485211 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
drop table if exists sandbox.fact_trips__dbt_backup 
  ...
[0m01:01:02.488638 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:01:02.492795 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m01:01:02.496774 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.498730 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m01:01:02.504435 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.505697 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata to sandbox.stg_fhv_tripdata__dbt_backup 
  
  ...
[0m01:01:02.517472 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.520910 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    drop table if exists sandbox.stg_fhv_tripdata 
  
  ...
[0m01:01:02.533531 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.535459 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */

    rename table sandbox.stg_fhv_tripdata__dbt_tmp to sandbox.stg_fhv_tripdata 
  
  ...
[0m01:01:02.547379 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.554915 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.stg_fhv_tripdata: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.stg_fhv_tripdata"} */
drop table if exists sandbox.stg_fhv_tripdata__dbt_backup 
  ...
[0m01:01:02.556735 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m01:01:02.561157 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m01:01:02.574262 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:01:02.575066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.576527 [debug] [Thread-2  ]: Timing info for model.taxi_rides_ny.stg_fhv_tripdata (execute): 2023-02-20 01:01:01.845987 => 2023-02-20 01:01:02.576465
[0m01:01:02.577476 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cbc49310>]}
[0m01:01:02.578041 [info ] [Thread-2  ]: 2 of 7 OK created sql view model sandbox.stg_fhv_tripdata ...................... [[32mOK[0m in 0.76s]
[0m01:01:02.578499 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.stg_fhv_tripdata
[0m01:01:02.580888 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m01:01:02.581527 [debug] [Thread-3  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m01:01:02.582063 [info ] [Thread-3  ]: 6 of 7 START sql table model sandbox.fact_trips_fhv ............................ [RUN]
[0m01:01:02.583266 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m01:01:02.583518 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips_fhv)
[0m01:01:02.583763 [debug] [Thread-3  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m01:01:02.588511 [debug] [Thread-3  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m01:01:02.589843 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.payment_type_description", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m01:01:02.591150 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-20 01:01:02.583922 => 2023-02-20 01:01:02.591027
[0m01:01:02.591588 [debug] [Thread-3  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m01:01:02.599374 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m01:01:02.634913 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m01:01:02.638070 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

    select name, type from system.columns where table = 'fact_trips_fhv__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m01:01:02.650118 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:01:02.651958 [debug] [Thread-3  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips_fhv"
[0m01:01:02.654240 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

  
    
    
        
        insert into sandbox.fact_trips_fhv__dbt_backup ("fhv_data.tripid", "fhv_data.vendorid", "fhv_data.pickup_locationid", "pickup_borough", "pickup_zone", "fhv_data.dropoff_locationid", "dropoff_borough", "dropoff_zone", "fhv_data.pickup_datetime", "fhv_data.dropoff_datetime", "fhv_data.sr_flag")
  

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
  ...
[0m01:03:11.808708 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 129.15 seconds
[0m01:03:11.812280 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */
EXCHANGE TABLES sandbox.fact_trips_fhv__dbt_backup AND sandbox.fact_trips_fhv 
  
  ...
[0m01:03:11.826178 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:03:11.835182 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */
drop table if exists sandbox.fact_trips_fhv__dbt_backup 
  ...
[0m01:03:11.849339 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:03:11.852452 [debug] [Thread-3  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (execute): 2023-02-20 01:01:02.591921 => 2023-02-20 01:03:11.852308
[0m01:03:11.853989 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cb095370>]}
[0m01:03:11.855058 [info ] [Thread-3  ]: 6 of 7 OK created sql table model sandbox.fact_trips_fhv ....................... [[32mOK[0m in 129.27s]
[0m01:03:11.855718 [debug] [Thread-3  ]: Finished running node model.taxi_rides_ny.fact_trips_fhv
[0m01:05:47.054404 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.payment_type_description", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  
[0m01:05:47.055763 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 01:01:02.478513 => 2023-02-20 01:05:47.055572
[0m01:05:47.081716 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
   Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.00 GiB (attempt to allocate chunk of 4220369 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker.: (while reading column
  compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m01:05:47.082530 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8fc65cbe-85fc-4418-9e7c-281b38b91439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cb03a9a0>]}
[0m01:05:47.083487 [error] [Thread-1  ]: 5 of 7 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 284.61s]
[0m01:05:47.084292 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m01:05:47.085796 [debug] [Thread-2  ]: Began running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m01:05:47.086671 [info ] [Thread-2  ]: 7 of 7 SKIP relation sandbox.dm_monthly_zone_revenue ........................... [[33mSKIP[0m]
[0m01:05:47.087555 [debug] [Thread-2  ]: Finished running node model.taxi_rides_ny.dm_monthly_zone_revenue
[0m01:05:47.089837 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m01:05:47.090787 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:05:47.091183 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m01:05:47.091577 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m01:05:47.094620 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_fhv_tripdata' was left open.
[0m01:05:47.095072 [debug] [MainThread]: On model.taxi_rides_ny.stg_fhv_tripdata: Close
[0m01:05:47.098254 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips_fhv' was left open.
[0m01:05:47.098696 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips_fhv: Close
[0m01:05:47.101833 [debug] [MainThread]: Connection 'model.taxi_rides_ny.stg_yellow_tripdata' was left open.
[0m01:05:47.102126 [debug] [MainThread]: On model.taxi_rides_ny.stg_yellow_tripdata: Close
[0m01:05:47.104443 [info ] [MainThread]: 
[0m01:05:47.104878 [info ] [MainThread]: Finished running 4 table models, 3 view models in 0 hours 4 minutes and 46.04 seconds (286.04s).
[0m01:05:47.105569 [debug] [MainThread]: Command end result
[0m01:05:47.117359 [info ] [MainThread]: 
[0m01:05:47.117857 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:05:47.118200 [info ] [MainThread]: 
[0m01:05:47.118672 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m01:05:47.119141 [error] [MainThread]:   :HTTPDriver for https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443 returned response code 500)
[0m01:05:47.119513 [error] [MainThread]:    Code: 241. DB::Exception: Memory limit (total) exceeded: would use 7.00 GiB (attempt to allocate chunk of 4220369 bytes), maximum: 7.00 GiB. OvercommitTracker decision: Query was selected to stop by OvercommitTracker.: (while reading column
[0m01:05:47.119899 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m01:05:47.120328 [info ] [MainThread]: 
[0m01:05:47.120707 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=1 TOTAL=7
[0m01:05:47.121163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cbc67d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cae63850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f84cb25f550>]}
[0m01:05:47.121550 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 01:10:11.071167 | d685c1d5-3bab-4a48-a614-f6cbd2e19a74 ==============================
[0m01:10:11.071167 [info ] [MainThread]: Running with dbt=1.4.1
[0m01:10:11.074145 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'vars': 'is_test_run: false', 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m01:10:11.074507 [debug] [MainThread]: Tracking: tracking
[0m01:10:11.095453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9c48e63b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9c48f6c5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9c48f6c160>]}
[0m01:10:11.224320 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:10:11.224626 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:10:11.233021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd685c1d5-3bab-4a48-a614-f6cbd2e19a74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9c491a8970>]}
[0m01:10:11.245471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd685c1d5-3bab-4a48-a614-f6cbd2e19a74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9c491871c0>]}
[0m01:10:11.245908 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m01:10:11.246221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd685c1d5-3bab-4a48-a614-f6cbd2e19a74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9c491872e0>]}
[0m01:10:11.248001 [info ] [MainThread]: 
[0m01:10:11.249823 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m01:10:11.251185 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m01:10:11.274533 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:10:27.124332 [debug] [ThreadPool]: dbt_clickhouse adapter: Got a retryable error when attempting to open a clickhouse connection.
1 attempts remaining. Retrying in 1 seconds.
Error:
Error HTTPSConnectionPool(host='c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net', port=8443): Max retries exceeded with url: /? (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f9c498ed880>: Failed to establish a new connection: [Errno 60] Operation timed out')) executing HTTP request https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443
[0m01:10:43.781986 [debug] [ThreadPool]: dbt_clickhouse adapter: Error running SQL: macro list_schemas
[0m01:10:43.784326 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:10:43.784846 [debug] [MainThread]: Connection 'list_schemas' was left open.
[0m01:10:43.785359 [debug] [MainThread]: On list_schemas: No close available on handle
[0m01:10:43.785797 [info ] [MainThread]: 
[0m01:10:43.786738 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 32.54 seconds (32.54s).
[0m01:10:43.787554 [error] [MainThread]: Encountered an error:
Database Error
  Error HTTPSConnectionPool(host='c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net', port=8443): Max retries exceeded with url: /? (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f9c498edee0>: Failed to establish a new connection: [Errno 60] Operation timed out')) executing HTTP request https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443
[0m01:10:43.788286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9c491e73a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9c491872e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9c49949100>]}
[0m01:10:43.788911 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 01:17:05.545268 | befd8fb2-9e98-4cdd-9217-0f430245730b ==============================
[0m01:17:05.545268 [info ] [MainThread]: Running with dbt=1.4.1
[0m01:17:05.547983 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'vars': 'is_test_run: false', 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m01:17:05.548433 [debug] [MainThread]: Tracking: tracking
[0m01:17:05.566074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa43469a040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa43469a610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa43469a3a0>]}
[0m01:17:05.689790 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:17:05.690143 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:17:05.698293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'befd8fb2-9e98-4cdd-9217-0f430245730b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4349e8a00>]}
[0m01:17:05.711596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'befd8fb2-9e98-4cdd-9217-0f430245730b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4348d5250>]}
[0m01:17:05.711994 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m01:17:05.712327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'befd8fb2-9e98-4cdd-9217-0f430245730b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4348d5370>]}
[0m01:17:05.714009 [info ] [MainThread]: 
[0m01:17:05.715953 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m01:17:05.717129 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m01:17:05.727775 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:17:06.083246 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m01:17:06.097938 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:17:06.106304 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m01:17:06.106948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m01:17:06.117404 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m01:17:06.132977 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:17:06.138090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'befd8fb2-9e98-4cdd-9217-0f430245730b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4349e8ac0>]}
[0m01:17:06.139083 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:17:06.139486 [info ] [MainThread]: 
[0m01:17:06.145927 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m01:17:06.146600 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m01:17:06.147479 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m01:17:06.147778 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m01:17:06.148065 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m01:17:06.154057 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m01:17:06.156663 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 01:17:06.148281 => 2023-02-20 01:17:06.156520
[0m01:17:06.157048 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m01:17:06.192542 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
drop table if exists sandbox.fact_trips__dbt_backup 
  ...
[0m01:17:06.231164 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m01:17:06.262684 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m01:17:06.299052 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m01:17:06.309968 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m01:17:06.323979 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:17:06.330818 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m01:17:06.333888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.payment_type_description", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m01:22:06.328532 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.payment_type_description", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  
[0m01:22:06.329318 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 01:17:06.157313 => 2023-02-20 01:22:06.329173
[0m01:22:06.337108 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  Error HTTPSConnectionPool(host='c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net', port=8443): Read timed out. (read timeout=300) executing HTTP request https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443
  compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m01:22:06.337577 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'befd8fb2-9e98-4cdd-9217-0f430245730b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa4351da820>]}
[0m01:22:06.338121 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 300.19s]
[0m01:22:06.339678 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m01:22:06.341123 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m01:22:06.341719 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:22:06.341951 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m01:22:06.342152 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m01:22:06.342416 [info ] [MainThread]: 
[0m01:22:06.342754 [info ] [MainThread]: Finished running 1 table model in 0 hours 5 minutes and 0.63 seconds (300.63s).
[0m01:22:06.343169 [debug] [MainThread]: Command end result
[0m01:22:06.403481 [info ] [MainThread]: 
[0m01:22:06.403969 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:22:06.404255 [info ] [MainThread]: 
[0m01:22:06.404510 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m01:22:06.404794 [error] [MainThread]:   Error HTTPSConnectionPool(host='c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net', port=8443): Read timed out. (read timeout=300) executing HTTP request https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443
[0m01:22:06.405045 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m01:22:06.405293 [info ] [MainThread]: 
[0m01:22:06.405544 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:22:06.405941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa433993f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa433e20340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa43385b070>]}
[0m01:22:06.406304 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 01:46:51.975874 | 6b796f46-7788-42bc-bba7-c422a3f34694 ==============================
[0m01:46:51.975874 [info ] [MainThread]: Running with dbt=1.4.1
[0m01:46:51.979690 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'vars': 'is_test_run: false', 'select': ['fact_trips'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m01:46:51.980045 [debug] [MainThread]: Tracking: tracking
[0m01:46:52.006576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f814853e070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f814853e640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f814853e3d0>]}
[0m01:46:52.189846 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:46:52.190410 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:46:52.199906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b796f46-7788-42bc-bba7-c422a3f34694', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f81488a1a30>]}
[0m01:46:52.213735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b796f46-7788-42bc-bba7-c422a3f34694', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8148682280>]}
[0m01:46:52.214211 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m01:46:52.214516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b796f46-7788-42bc-bba7-c422a3f34694', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f81486823a0>]}
[0m01:46:52.216632 [info ] [MainThread]: 
[0m01:46:52.218533 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m01:46:52.219613 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m01:46:52.232804 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:46:52.952586 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m01:46:52.965927 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:46:52.969855 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m01:46:52.970233 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m01:46:52.977038 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m01:46:52.999921 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:46:53.005331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b796f46-7788-42bc-bba7-c422a3f34694', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f81488a1af0>]}
[0m01:46:53.006549 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:46:53.006979 [info ] [MainThread]: 
[0m01:46:53.016428 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips
[0m01:46:53.017054 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips ................................ [RUN]
[0m01:46:53.017911 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips'
[0m01:46:53.018186 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips)
[0m01:46:53.018469 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips
[0m01:46:53.025199 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips"
[0m01:46:53.038297 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (compile): 2023-02-20 01:46:53.018676 => 2023-02-20 01:46:53.038162
[0m01:46:53.038682 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips
[0m01:46:53.084197 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */
drop table if exists sandbox.fact_trips__dbt_backup 
  ...
[0m01:46:53.479624 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.39 seconds
[0m01:46:53.519574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

            

    
        create table sandbox.fact_trips__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m01:46:53.556807 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m01:46:53.574289 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

    select name, type from system.columns where table = 'fact_trips__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m01:46:53.589512 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:46:53.598075 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips"
[0m01:46:53.600093 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.payment_type_description", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  ...
[0m01:51:53.640462 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips"} */

  
    
    
        
        insert into sandbox.fact_trips__dbt_backup ("trips_unioned.tripid", "trips_unioned.vendorid", "trips_unioned.service_type", "trips_unioned.ratecodeid", "trips_unioned.pickup_locationid", "pickup_borough", "pickup_zone", "trips_unioned.dropoff_locationid", "dropoff_borough", "dropoff_zone", "trips_unioned.pickup_datetime", "trips_unioned.dropoff_datetime", "trips_unioned.store_and_fwd_flag", "trips_unioned.passenger_count", "trips_unioned.trip_distance", "trips_unioned.trip_type", "trips_unioned.fare_amount", "trips_unioned.extra", "trips_unioned.mta_tax", "trips_unioned.tip_amount", "trips_unioned.tolls_amount", "trips_unioned.ehail_fee", "trips_unioned.improvement_surcharge", "trips_unioned.total_amount", "trips_unioned.payment_type", "trips_unioned.payment_type_description", "trips_unioned.congestion_surcharge")
  

with green_data as (
    select *, 
        'Green' as service_type 
    from sandbox.stg_green_tripdata
), 

yellow_data as (
    select *, 
        'Yellow' as service_type
    from sandbox.stg_yellow_tripdata
), 

trips_unioned as (
    select * from green_data
    union all
    select * from yellow_data
), 

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    trips_unioned.tripid, 
    trips_unioned.vendorid, 
    trips_unioned.service_type,
    trips_unioned.ratecodeid, 
    trips_unioned.pickup_locationid, 
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone, 
    trips_unioned.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,  
    trips_unioned.pickup_datetime, 
    trips_unioned.dropoff_datetime, 
    trips_unioned.store_and_fwd_flag, 
    trips_unioned.passenger_count, 
    trips_unioned.trip_distance, 
    trips_unioned.trip_type, 
    trips_unioned.fare_amount, 
    trips_unioned.extra, 
    trips_unioned.mta_tax, 
    trips_unioned.tip_amount, 
    trips_unioned.tolls_amount, 
    trips_unioned.ehail_fee, 
    trips_unioned.improvement_surcharge, 
    trips_unioned.total_amount, 
    trips_unioned.payment_type, 
    trips_unioned.payment_type_description, 
    trips_unioned.congestion_surcharge
from trips_unioned
inner join dim_zones as pickup_zone
on trips_unioned.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on trips_unioned.dropoff_locationid = dropoff_zone.locationid
  
[0m01:51:53.641853 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips (execute): 2023-02-20 01:46:53.038890 => 2023-02-20 01:51:53.641697
[0m01:51:53.660790 [debug] [Thread-1  ]: Database Error in model fact_trips (models/core/fact_trips.sql)
  Error HTTPSConnectionPool(host='c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net', port=8443): Read timed out. (read timeout=300) executing HTTP request https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443
  compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m01:51:53.661354 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b796f46-7788-42bc-bba7-c422a3f34694', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f814927c820>]}
[0m01:51:53.661987 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model sandbox.fact_trips ....................... [[31mERROR[0m in 300.64s]
[0m01:51:53.663503 [debug] [Thread-1  ]: Finished running node model.taxi_rides_ny.fact_trips
[0m01:51:53.665632 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m01:51:53.666581 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:51:53.666946 [debug] [MainThread]: Connection 'model.taxi_rides_ny.fact_trips' was left open.
[0m01:51:53.667637 [debug] [MainThread]: On model.taxi_rides_ny.fact_trips: Close
[0m01:51:53.668005 [info ] [MainThread]: 
[0m01:51:53.668329 [info ] [MainThread]: Finished running 1 table model in 0 hours 5 minutes and 1.45 seconds (301.45s).
[0m01:51:53.668954 [debug] [MainThread]: Command end result
[0m01:51:53.732235 [info ] [MainThread]: 
[0m01:51:53.732724 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m01:51:53.733034 [info ] [MainThread]: 
[0m01:51:53.733285 [error] [MainThread]: [33mDatabase Error in model fact_trips (models/core/fact_trips.sql)[0m
[0m01:51:53.733537 [error] [MainThread]:   Error HTTPSConnectionPool(host='c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net', port=8443): Read timed out. (read timeout=300) executing HTTP request https://c-c9q6ehs6vakp4i8udnu4.rw.mdb.yandexcloud.net:8443
[0m01:51:53.733784 [error] [MainThread]:   compiled Code at target/run/taxi_rides_ny/models/core/fact_trips.sql
[0m01:51:53.734082 [info ] [MainThread]: 
[0m01:51:53.734372 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m01:51:53.734711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8147857fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8147dfb370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f814772d1f0>]}
[0m01:51:53.735017 [debug] [MainThread]: Flushing usage events


============================== 2023-02-20 01:54:51.386487 | cdc8f947-12b0-48dd-98ce-d74c2ec7fca8 ==============================
[0m01:54:51.386487 [info ] [MainThread]: Running with dbt=1.4.1
[0m01:54:51.389578 [debug] [MainThread]: running dbt with arguments {'write_json': True, 'use_colors': True, 'printer_width': 80, 'version_check': True, 'partial_parse': True, 'static_parser': True, 'profiles_dir': '/Users/vladimir/Documents/data-engineering-zoomcamp-cohort2023/cohorts/2023/week_4_analytics_engineering/taxi_rides_ny', 'send_anonymous_usage_stats': True, 'quiet': False, 'no_print': False, 'cache_selected_only': False, 'vars': 'is_test_run: false', 'select': ['fact_trips_fhv'], 'which': 'run', 'rpc_method': 'run', 'indirect_selection': 'eager'}
[0m01:54:51.390005 [debug] [MainThread]: Tracking: tracking
[0m01:54:51.428226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a8e57100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a8e57670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a8e57400>]}
[0m01:54:51.627783 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:54:51.628112 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:54:51.637015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cdc8f947-12b0-48dd-98ce-d74c2ec7fca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a90a5a60>]}
[0m01:54:51.648844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cdc8f947-12b0-48dd-98ce-d74c2ec7fca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a8f952b0>]}
[0m01:54:51.649298 [info ] [MainThread]: Found 7 models, 11 tests, 0 snapshots, 0 analyses, 503 macros, 0 operations, 1 seed file, 3 sources, 0 exposures, 0 metrics
[0m01:54:51.649678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cdc8f947-12b0-48dd-98ce-d74c2ec7fca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a8f953d0>]}
[0m01:54:51.651845 [info ] [MainThread]: 
[0m01:54:51.653873 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m01:54:51.655527 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_schemas'
[0m01:54:51.668506 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:56:18.480833 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_schemas: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_schemas"} */

    select name from system.databases
  ...
[0m01:56:18.499725 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:56:18.506123 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_None_sandbox'
[0m01:56:18.506635 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_None_sandbox)
[0m01:56:18.516274 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_None_sandbox: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "connection_name": "list_None_sandbox"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine
    from system.tables as t JOIN system.databases as db on t.database = db.name
    where schema = 'sandbox'
  ...
[0m01:56:18.532420 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m01:56:18.538209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cdc8f947-12b0-48dd-98ce-d74c2ec7fca8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f97a90a5b50>]}
[0m01:56:18.539292 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:56:18.539728 [info ] [MainThread]: 
[0m01:56:18.552731 [debug] [Thread-1  ]: Began running node model.taxi_rides_ny.fact_trips_fhv
[0m01:56:18.553287 [info ] [Thread-1  ]: 1 of 1 START sql table model sandbox.fact_trips_fhv ............................ [RUN]
[0m01:56:18.554130 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.taxi_rides_ny.fact_trips_fhv'
[0m01:56:18.554454 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.taxi_rides_ny.fact_trips_fhv)
[0m01:56:18.554732 [debug] [Thread-1  ]: Began compiling node model.taxi_rides_ny.fact_trips_fhv
[0m01:56:18.560051 [debug] [Thread-1  ]: Writing injected SQL for node "model.taxi_rides_ny.fact_trips_fhv"
[0m01:56:18.563164 [debug] [Thread-1  ]: Timing info for model.taxi_rides_ny.fact_trips_fhv (compile): 2023-02-20 01:56:18.554936 => 2023-02-20 01:56:18.562914
[0m01:56:18.563682 [debug] [Thread-1  ]: Began executing node model.taxi_rides_ny.fact_trips_fhv
[0m01:56:18.624300 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

            

    
        create table sandbox.fact_trips_fhv__dbt_backup
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        empty
    as (
        

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
    )
        ...
[0m01:56:34.155799 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 15.53 seconds
[0m01:56:34.172709 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

    select name, type from system.columns where table = 'fact_trips_fhv__dbt_backup'
    
      and database = 'sandbox'
    
    order by position
  ...
[0m01:56:34.186832 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m01:56:34.193668 [debug] [Thread-1  ]: Writing runtime sql for node "model.taxi_rides_ny.fact_trips_fhv"
[0m01:56:34.196889 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.taxi_rides_ny.fact_trips_fhv: /* {"app": "dbt", "dbt_version": "1.4.1", "profile_name": "yandex-cloud-clickhouse", "target_name": "dev", "node_id": "model.taxi_rides_ny.fact_trips_fhv"} */

  
    
    
        
        insert into sandbox.fact_trips_fhv__dbt_backup ("fhv_data.tripid", "fhv_data.vendorid", "fhv_data.pickup_locationid", "pickup_borough", "pickup_zone", "fhv_data.dropoff_locationid", "dropoff_borough", "dropoff_zone", "fhv_data.pickup_datetime", "fhv_data.dropoff_datetime", "fhv_data.sr_flag")
  

with fhv_data as (
    select * from sandbox.stg_fhv_tripdata
),

dim_zones as (
    select * from sandbox.dim_zones
    where borough != 'Unknown'
)

select 
    fhv_data.tripid,
    fhv_data.vendorid,
    fhv_data.pickup_locationid,
    pickup_zone.borough as pickup_borough, 
    pickup_zone.zone as pickup_zone,
    fhv_data.dropoff_locationid,
    dropoff_zone.borough as dropoff_borough, 
    dropoff_zone.zone as dropoff_zone,
    fhv_data.pickup_datetime, 
    fhv_data.dropoff_datetime,
    fhv_data.sr_flag 
from fhv_data
inner join dim_zones as pickup_zone
on fhv_data.pickup_locationid = pickup_zone.locationid
inner join dim_zones as dropoff_zone
on fhv_data.dropoff_locationid = dropoff_zone.locationid
  ...
